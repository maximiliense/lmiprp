
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Les attaques adversaires â˜•ï¸ &#8212; Machine Learning</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Une analyse de la rÃ©gularisation Ridge â˜•ï¸â˜•ï¸â˜•ï¸" href="5_ridge.html" />
    <link rel="prev" title="Lâ€™apprentissage multi-tÃ¢ches â˜•ï¸â˜•ï¸" href="3_multitask.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/logo.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Machine Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Machine Learning
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../0_requisite/rappels_python.html">
   Rappels de Python et Numpy
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../1_what_is_ml/0_propos_liminaire.html">
   Le
   <em>
    Machine Learning
   </em>
   , câ€™est quoi ?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_what_is_ml/1_introduction_ml.html">
     <em>
      Machine learning
     </em>
     et malÃ©diction de la dimension
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_what_is_ml/2_regression_and_classification_trees.html">
     Les arbres de rÃ©gression et de classification
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2_linear_regression/0_propos_liminaire.html">
   La
   <em>
    rÃ©gression
   </em>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_linear_regression/1_linear_regression.html">
     La rÃ©gression linÃ©aire â˜•ï¸
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_linear_regression/2_optimization.html">
     Lâ€™optimisation â˜•ï¸â˜•ï¸
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_linear_regression/3_interpolation.html">
     Interpolation â˜•ï¸â˜•ï¸
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_linear_regression/4_algo_proximal_lasso.html">
     Sous-diffÃ©rentiel et le cas du Lasso â˜•ï¸â˜•ï¸â˜•ï¸
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../3_logistic_regression/0_propos_liminaire.html">
   La
   <em>
    classification
   </em>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_logistic_regression/1_logistic_regression.html">
     La RÃ©gression Logistique â˜•ï¸
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_logistic_regression/2_fonctions_proxy.html">
     Les fonctions proxy â˜•ï¸â˜•ï¸â˜•ï¸
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_logistic_regression/3_bayes_classifier.html">
     Le classifieur de Bayes â˜•ï¸
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_logistic_regression/4_VC_theory.html">
     La thÃ©orie de Vapnik et Chervonenkis â˜•ï¸â˜•ï¸â˜•ï¸â˜•ï¸ (ğŸ’†â€â™‚ï¸)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../4_max_margin/0_propos_liminaire.html">
   Les modÃ¨les
   <em>
    max-margin
   </em>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../4_max_margin/1_max_margin.html">
     Les modÃ¨les max-margin â˜•ï¸â˜•ï¸
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../5_ensembles/0_propos_liminaire.html">
   Les mÃ©thodes
   <em>
    ensemblistes
   </em>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../5_ensembles/1_ensembles.html">
     Les mÃ©thodes ensemblistes â˜•ï¸â˜•ï¸
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../6_autodiff/0_propos_liminaire.html">
   La diffÃ©rentiation automatique
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../6_autodiff/1_autodiff.html">
     La diffÃ©rentiation automatique et un dÃ©but de
     <em>
      deep learning
     </em>
     â˜•ï¸
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../6_autodiff/2_filters_representation.html">
     Filtres et espace de reprÃ©sentation des rÃ©seaux de neurones â˜•ï¸â˜•ï¸
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="0_propos_liminaire.html">
   La rÃ©gularisation
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="1_regularization_deep.html">
     RÃ©gularisation en deep learning â˜•ï¸â˜•ï¸
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2_unsupervised_representation_learning.html">
     Unsupervised representation learning â˜•ï¸â˜•ï¸â˜•ï¸
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3_multitask.html">
     Lâ€™apprentissage multi-tÃ¢ches â˜•ï¸â˜•ï¸
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Les attaques adversaires â˜•ï¸
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="5_ridge.html">
     Une analyse de la rÃ©gularisation Ridge â˜•ï¸â˜•ï¸â˜•ï¸
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../content.html">
   Content in Jupyter Book
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../markdown.html">
     Markdown Files
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks.html">
     Content with notebooks
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/7_regularization/4_adversarial.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/maximiliense/lmiprp"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/maximiliense/lmiprp/issues/new?title=Issue%20on%20page%20%2F7_regularization/4_adversarial.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/maximiliense/lmiprp/master?urlpath=tree/7_regularization/4_adversarial.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#i-introduction-qu-est-ce-qu-une-attaque-adversaire">
   I. Introduction, quâ€™est-ce quâ€™une attaque adversaire ?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ii-imports-et-construction-du-modele">
   II. Imports et construction du modÃ¨le
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#iii-la-donnee-a-attaquer">
   III. La donnÃ©e Ã  attaquer
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#iv-une-premiere-attaque">
   IV. Une premiÃ¨re attaque
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#quelques-rappels-d-optimisation">
     Quelques rappels dâ€™optimisation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#construction-d-une-attaque-adversaire">
     Construction dâ€™une attaque adversaire
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#v-un-deuxieme-essai">
   V. Un deuxiÃ¨me essai
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vi-une-attaque-un-petit-peu-plus-ciblee">
   VI. Une attaque un petit peu plus ciblÃ©e ?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vii-la-methode-fast-sign">
   VII. La mÃ©thode â€œfast-signâ€
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#viii-devenir-robuste-aux-attaques-adversaires">
   VIII. Devenir robuste aux attaques adversaires
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#construction-du-jeu-de-donnees">
     Construction du jeu de donnÃ©es
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#un-cas-simple-le-modele-lineaire-rappels">
     Un cas simple : le modÃ¨le linÃ©aire (Rappels)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#construction-du-modele">
     Construction du modÃ¨le
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#construction-de-la-loss">
     Construction de la loss
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#entrainement">
     EntraÃ®nement
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-des-performances">
     Test des performances
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#construction-d-une-attaque-adversaire-dans-le-cas-du-modele-lineaire">
     Construction dâ€™une attaque adversaire dans le cas du modÃ¨le linÃ©aire
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#apprentissage-robuste-aux-attaques-adversaires">
     Apprentissage robuste aux attaques adversaires
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#en-resume">
   En rÃ©sumÃ©
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="les-attaques-adversaires">
<h1>Les attaques adversaires â˜•ï¸<a class="headerlink" href="#les-attaques-adversaires" title="Permalink to this headline">Â¶</a></h1>
<div class="section" id="i-introduction-qu-est-ce-qu-une-attaque-adversaire">
<h2>I. Introduction, quâ€™est-ce quâ€™une attaque adversaire ?<a class="headerlink" href="#i-introduction-qu-est-ce-qu-une-attaque-adversaire" title="Permalink to this headline">Â¶</a></h2>
<p>Reprenons le problÃ¨me introduit prÃ©cÃ©demment. Soit <span class="math notranslate nohighlight">\(\mathcal{X}\subseteq\mathbb{R}^d\)</span> notre espace dâ€™entrÃ©e et <span class="math notranslate nohighlight">\(\mathcal{Y}=\{0, 1\}^C\)</span> notre espace de sortie oÃ¹ <span class="math notranslate nohighlight">\(C\in\mathbb{N}\)</span> est le nombre de classes de notre problÃ¨me de classification. ConsidÃ©rons une famille paramÃ©trique de fonctions :</p>
<div class="math notranslate nohighlight">
\[\mathcal{H}=\{h_\theta:\ \theta\in\mathbb{R}^p\},\]</div>
<p>oÃ¹ <span class="math notranslate nohighlight">\(p\in\mathbb{N}\)</span> est le nombre de paramÃ¨tres. Notons <span class="math notranslate nohighlight">\(S_n\)</span> notre jeu de donnÃ©es dâ€™apprentissage composÃ© de <span class="math notranslate nohighlight">\(n\)</span> exemples, <span class="math notranslate nohighlight">\(T_m\)</span> notre jeu de test et <span class="math notranslate nohighlight">\(\ell\)</span> la <em>loss</em> pour une unique prÃ©diction. Notons aussi <span class="math notranslate nohighlight">\(\text{Acc}(h_\theta, S)\)</span> le pourcentage de bonnes prÃ©dictions (i.e. <em>accuracy</em>) faites par <span class="math notranslate nohighlight">\(h_\theta\)</span> sur lâ€™ensemble de donnÃ©es <span class="math notranslate nohighlight">\(S\)</span>. Notre objectif est de trouver la paramÃ©trisation qui nous permet de minimiser notre <em>loss</em> sur le jeu de donnÃ©es :</p>
<div class="math notranslate nohighlight">
\[\theta^\star=\text{argmin}_{\theta\in\mathbb{R}^p}\frac{1}{n}\sum_i \ell(h_\theta(x_i), y_i)=\text{argmin}_{\theta\in\mathbb{R}^p}\mathcal{L}(h_\theta, S_n).\]</div>
<p>Cette minimisation nâ€™est cependant pas un critÃ¨re ultime et on souhaite que la fonction ainsi obtenue se comporte bien sur de nouvelles donnÃ©es jamais observÃ©es. Une maniÃ¨re dâ€™estimer ces performances consiste Ã  tester notre fonction sur un jeu de test :</p>
<div class="math notranslate nohighlight">
\[\text{Acc}(h_{\theta^\star}, T_m).\]</div>
<p>Et malheureusement, la paramÃ©trisation qui minimise notre <em>loss</em> nâ€™est pas toujours performante sur de nouvelles donnÃ©es, comme nous avons pu le voir. Pour cela, diverses techniques allant de la rÃ©duction du nombre de paramÃ¨tres aux techniques de rÃ©gularitation <span class="math notranslate nohighlight">\(\ell_1\)</span> ou <span class="math notranslate nohighlight">\(\ell_2\)</span> en passant par le <em>dropout</em>, etc. sont possibles.</p>
<p>Cependant, imaginons que notre jeu de test <span class="math notranslate nohighlight">\(T_m\)</span> au lieu dâ€™Ãªtre un tirage alÃ©atoire reprÃ©sentatif de la distribution de nos donnÃ©es soit choisi par un adversaire dont lâ€™objectif est de mettre en Ã©chec notre modÃ¨le dâ€™une maniÃ¨re telle quâ€™un Ãªtre humain nâ€™y verrait aucune diffÃ©rence. Est-il possible de faire croire Ã  un modÃ¨le que la photo dâ€™un STOP est en rÃ©alitÃ© une limitation de vitesse Ã  130km/h sans quâ€™un Ãªtre humain ne voit la diffÃ©rence. Câ€™est lÃ  lâ€™objectif des attaques adversaires.</p>
<img SRC="https://raw.githubusercontent.com/maximiliense/lmiprp/main/Travaux%20Pratiques/Machine%20Learning/Introduction/data/Adversarial/lemons_result.jpeg" style='width:700px' align="center" >
<p>Nous commencerons lâ€™Ã©tude de ces questions en utilisant un modÃ¨le de lâ€™Ã©tat de lâ€™art dÃ©jÃ  prÃ©-entraÃ®nÃ© sur la base de donnÃ©es ImagetNet. Lâ€™objectif sera dans un premier temps de construire ces attaques adversaires puis, dans un second temps, de construire une procÃ©dure dâ€™apprentissage robuste aux attaques adversaires.</p>
</div>
<div class="section" id="ii-imports-et-construction-du-modele">
<h2>II. Imports et construction du modÃ¨le<a class="headerlink" href="#ii-imports-et-construction-du-modele" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">transforms</span><span class="p">,</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">torch.nn.functional</span> <span class="kn">import</span> <span class="n">softmax</span>
<span class="kn">from</span> <span class="nn">torch.nn</span> <span class="kn">import</span> <span class="n">CrossEntropyLoss</span><span class="p">,</span> <span class="n">Linear</span><span class="p">,</span> <span class="n">BatchNorm1d</span><span class="p">,</span> <span class="n">ReLU</span><span class="p">,</span> <span class="n">Sequential</span><span class="p">,</span> <span class="n">Module</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span> <span class="k">as</span> <span class="n">TorchDataset</span><span class="p">,</span> <span class="n">DataLoader</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">optim</span><span class="p">,</span> <span class="n">zeros_like</span><span class="p">,</span> <span class="n">LongTensor</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ggplot&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">import</span> <span class="nn">ast</span><span class="o">,</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<p>Le modÃ¨le utilisÃ© est <span class="math notranslate nohighlight">\(\texttt{resnet50}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resnet</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">resnet50</span><span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resnet</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

<span class="c1"># https://pytorch.org/vision/stable/models.html</span>

<span class="n">normalize</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span>
    <span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">],</span>
    <span class="n">std</span><span class="o">=</span><span class="p">[</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">preprocessing_no_normalize</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
    <span class="n">transforms</span><span class="o">.</span><span class="n">Resize</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span>
    <span class="n">transforms</span><span class="o">.</span><span class="n">CenterCrop</span><span class="p">(</span><span class="mi">224</span><span class="p">),</span>
    <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Notre rÃ©seau de neurones fait ses prÃ©dictions au travers dâ€™un vecteur de dimension 1000 oÃ¹ chaque dimension est la probabilitÃ© (ou un score) associÃ©e Ã  la classe de mÃªme indice. Afin de pouvoir associer un nom Ã  chacune de ces classes, nous construisons le dictionnaire ci-dessous <span class="math notranslate nohighlight">\(\texttt{classes}\_\texttt{to}\_\texttt{labels}\)</span>.</p>
<p>Le fichier est tÃ©lÃ©chargeable Ã  lâ€™adresse suivante :
<a class="reference external" href="https://raw.githubusercontent.com/maximiliense/lmiprp/main/Travaux%20Pratiques/Machine%20Learning/Introduction/data/Adversarial/imagenet.json">imagenet.json</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;imagenet.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">classes_to_labels</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">):</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="iii-la-donnee-a-attaquer">
<h2>III. La donnÃ©e Ã  attaquer<a class="headerlink" href="#iii-la-donnee-a-attaquer" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;lemon.jpeg&#39;</span><span class="p">)</span>
<span class="n">tensor</span> <span class="o">=</span> <span class="n">preprocessing_no_normalize</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tensor</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4_adversarial_11_0.png" src="../_images/4_adversarial_11_0.png" />
</div>
</div>
<p><span class="math notranslate nohighlight">\(\texttt{Pytorch}\)</span> prend en entrÃ©e des donnÃ©es dont la premiÃ¨re dimension reprÃ©sente celle du batch. Sâ€™il nâ€™y a quâ€™une donnÃ©e alors cette premiÃ¨re dimension doit toujours exister et vaut <span class="math notranslate nohighlight">\(1\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">batch</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">tensor</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="c1"># we create a batch</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[batch size, channels, width, height]:&#39;</span><span class="p">,</span> <span class="n">batch</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[batch size, channels, width, height]: torch.Size([1, 3, 224, 224])
</pre></div>
</div>
</div>
</div>
<p>Lâ€™image est tÃ©lÃ©chargeable Ã  lâ€™adresse suivante :
<a class="reference external" href="https://raw.githubusercontent.com/maximiliense/lmiprp/main/Travaux%20Pratiques/Machine%20Learning/Introduction/data/Adversarial/lemon.jpeg">lemon.jpeg</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;lemon.jpeg&#39;</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">resnet</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># dim=1 indique qu&#39;on prÃ©dit image par image </span>
<span class="c1"># rappelez-vous que dim=0 correspond Ã  la dimension du batch</span>
<span class="n">true_index</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">probability</span> <span class="o">=</span> <span class="n">softmax</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">true_label</span> <span class="o">=</span> <span class="n">classes_to_labels</span><span class="p">[</span><span class="n">true_index</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">true_label</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">probability</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>lemon : 0.9656191468238831
</pre></div>
</div>
</div>
</div>
<p>On observe que notre modÃ¨le prÃ©dit le bon label avec une trÃ¨s bonne probabilitÃ© !</p>
</div>
<div class="section" id="iv-une-premiere-attaque">
<h2>IV. Une premiÃ¨re attaque<a class="headerlink" href="#iv-une-premiere-attaque" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="quelques-rappels-d-optimisation">
<h3>Quelques rappels dâ€™optimisation<a class="headerlink" href="#quelques-rappels-d-optimisation" title="Permalink to this headline">Â¶</a></h3>
<p>Revenons Ã  lâ€™apprentissage de notre rÃ©seau de neurones. Notre objectif est de trouver une solution Ã  la minimisation suivante :</p>
<div class="math notranslate nohighlight">
\[\theta^\star=\text{argmin}_{\theta\in\mathbb{R}^p}\frac{1}{n}\sum_i \ell(h_\theta(x_i), y_i)=\text{argmin}_{\theta\in\mathbb{R}^p}\mathcal{L}(h_\theta, S_n).\]</div>
<p>Pour cela, nous exploitons le fait que <span class="math notranslate nohighlight">\(\mathcal{L}(h_\theta, S_n)\)</span> est diffÃ©rentiable presque partout en tant que fonction de <span class="math notranslate nohighlight">\(\theta\)</span> et cela afin dâ€™utiliser lâ€™algorithme de descente de gradient. Ce dernier rÃ©alise des pas successifs afin de se rapprocher toujours plus du minimum de notre fonction (ou du moins dâ€™une valeur qui minimise). Chacun des pas se construit de la maniÃ¨re suivante :</p>
<div class="math notranslate nohighlight">
\[\theta^{(t+1)}=\theta^{(t)}-\eta \nabla_\theta\mathcal{L}(h_{\theta^{(t)}}, S_n)\]</div>
<p>La valeur du gradient <span class="math notranslate nohighlight">\(\nabla_\theta\mathcal{L}(h_{\theta^{(t)}}, S_n)\)</span> est elle obtenue au travers de lâ€™algorithme de <em>backpropagration</em>. Le paramÃ¨tre <span class="math notranslate nohighlight">\(\eta&gt;0\)</span> est ce quâ€™on appelle le pas dâ€™apprentissage ou <em>learning rate</em> et permet de controler la stabilitÃ© de lâ€™optimisation mais a aussi un effet de rÃ©gularisation.</p>
</div>
<div class="section" id="construction-d-une-attaque-adversaire">
<h3>Construction dâ€™une attaque adversaire<a class="headerlink" href="#construction-d-une-attaque-adversaire" title="Permalink to this headline">Â¶</a></h3>
<p>Lâ€™idÃ©e dâ€™une attaque adversaire est de sâ€™appuyer sur le mÃªme raisonnement mais dans lâ€™espace des donnÃ©es <span class="math notranslate nohighlight">\(\mathbb{R}^d\)</span>. Soit une donnÃ©e et son label <span class="math notranslate nohighlight">\((x, y)\)</span>. Notre objectif est ainsi de trouver une perturbation <span class="math notranslate nohighlight">\(\delta\in\mathbb{R}^d\)</span> telle que la nouvelle donnÃ©e <span class="math notranslate nohighlight">\(x+\delta\)</span> ne soit plus associÃ©e au label <span class="math notranslate nohighlight">\(y\)</span>. Rappelons que notre loss <span class="math notranslate nohighlight">\(\ell\)</span> est une mesure des performances de notre rÃ©seau de neurones pour la donnÃ©e <span class="math notranslate nohighlight">\((x, y)\)</span>. Ainsi, <span class="math notranslate nohighlight">\(\ell(h_\theta(x), y)\)</span> est dâ€™autant plus faible que notre modÃ¨le est bon et dâ€™autant plus forte que notre modÃ¨le est mauvais. Nous allons omettre lâ€™indice <span class="math notranslate nohighlight">\(\theta\)</span> de notre modÃ¨le puisquâ€™on le considÃ¨re maintenant comme une constante.</p>
<p>Lâ€™objectif dâ€™une attaque adversaire est donc de trouver un bruit <span class="math notranslate nohighlight">\(\delta\in\mathbb{R}^d\)</span> de telle maniÃ¨re Ã  ce que <span class="math notranslate nohighlight">\(\ell(h_\theta(x+\delta), y)\)</span> ait la plus grande valeur possible. Ainsi, on peut reformuler lâ€™attaque adversaire via le problÃ¨me de minimisation suivant :</p>
<div class="math notranslate nohighlight">
\[\delta^\star=\text{argmin}_{\delta\in\mathbb{R}^d}-\ell(h_{\theta}(x+\delta), y).\]</div>
<p>Observez quâ€™on minimise bien lâ€™opposÃ© de notre <em>loss</em> puisquâ€™on est en rÃ©alitÃ© intÃ©ressÃ© par une maximisation.</p>
<hr class="docutils" />
<p><span style="color:blue"><strong>Exercice :</strong></span> ComplÃ©tez lâ€™algorithme suivant permettant de construire notre attaque adversaire.</p>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we initialize delta with 0</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># we construct our optimizer and loss</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">([</span><span class="n">delta</span><span class="p">],</span> <span class="n">lr</span><span class="o">=</span><span class="mf">2e-1</span><span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">CrossEntropyLoss</span><span class="p">()</span>

<span class="c1"># we construct the target</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">LongTensor</span><span class="p">([</span><span class="n">true_index</span><span class="p">])</span>

<span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">60</span><span class="p">):</span>
    <span class="c1">############### COMPLETE HERE ###############</span>
    <span class="c1"># we construct the batch</span>
    <span class="n">batch</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">tensor</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">resnet</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="o">-</span><span class="n">criterion</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">iteration</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">[</span><span class="si">%d</span><span class="s1">] loss: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
    <span class="c1">#############################################</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0] loss: -0.035
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[5] loss: -11.315
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10] loss: -21.591
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[15] loss: -31.978
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[20] loss: -36.733
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[25] loss: -42.057
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[30] loss: -47.970
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[35] loss: -56.601
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[40] loss: -56.621
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[45] loss: -62.715
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[50] loss: -65.907
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[55] loss: -69.178
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">batch</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">tensor</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="n">logit</span> <span class="o">=</span> <span class="n">resnet</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">True class probability:&#39;</span><span class="p">,</span> <span class="n">softmax</span><span class="p">(</span><span class="n">logit</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="n">true_index</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>

<span class="n">new_index</span> <span class="o">=</span> <span class="n">logit</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">new_label</span> <span class="o">=</span> <span class="n">classes_to_labels</span><span class="p">[</span><span class="n">new_index</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New class:&#39;</span><span class="p">,</span> <span class="n">new_label</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True class probability: 1.1802157973507622e-33
New class: orange
</pre></div>
</div>
</div>
</div>
<p>Excellent, nous avons rÃ©ussi Ã  transformer notre image <span class="math notranslate nohighlight">\(x\)</span> via un bruit <span class="math notranslate nohighlight">\(\delta\)</span> de maniÃ¨re Ã  piÃ©ger notre modÃ¨le ! On observe de plus que la probabilitÃ© de la bonne classe est maintenant ridiculement faible et se retrouve trÃ¨s probablement parmi les classes les moins probables. Observons le rÃ©sultat de notre attaque adversaire.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">18</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Notre image transformÃ©e $x+\delta$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="n">tensor</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Le bruit $\delta$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="n">delta</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Le bruit $\delta$ amplifiÃ©&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="mi">50</span><span class="o">*</span><span class="n">delta</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
</pre></div>
</div>
<img alt="../_images/4_adversarial_28_3.png" src="../_images/4_adversarial_28_3.png" />
</div>
</div>
<p>Oups ! Notre image ne ressemble plus Ã  rien. Le bruit ajoutÃ© est clairement visible. On pourrait mÃªme, si nous ne savions pas quâ€™il sâ€™agit de citrons, douter et penser quâ€™il sâ€™agit rÃ©ellement dâ€™orangesâ€¦</p>
</div>
</div>
<div class="section" id="v-un-deuxieme-essai">
<h2>V. Un deuxiÃ¨me essai<a class="headerlink" href="#v-un-deuxieme-essai" title="Permalink to this headline">Â¶</a></h2>
<p>La stratÃ©gie va Ãªtre de contraindre les dÃ©formations Ã  rester Ã  lâ€™intÃ©rieur dâ€™une boule dont nous pourrons contrÃ´ler le rayon et le fixer Ã  de petites valeurs :</p>
<div class="math notranslate nohighlight">
\[\mathcal{B}_\epsilon=\{x\in\mathbb{R}^d:\ \lVert x\rVert\leq \epsilon\}\]</div>
<p>ConsidÃ©rons le cas simple de la norme <span class="math notranslate nohighlight">\(\ell_\infty\)</span> :</p>
<div class="math notranslate nohighlight">
\[\lVert x\rVert_\infty=\text{max}_i|x_i|.\]</div>
<p>Contraindre un vecteur Ã  rester au sein dâ€™une boule de rayon <span class="math notranslate nohighlight">\(\epsilon\)</span> revient pour la norme <span class="math notranslate nohighlight">\(\ell_\infty\)</span> Ã  tronquer chaque coordonnÃ©e de maniÃ¨re Ã  ce que sa valeur absolue ne dÃ©passe pas <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p>
<hr class="docutils" />
<p><span style="color:blue"><strong>Exercice :</strong></span> ComplÃ©tez lâ€™algorithme suivant permettant de construire notre attaque adversaire en contraignant le vecteur <span class="math notranslate nohighlight">\(\delta\)</span> Ã  rester dans une boule de rayon <span class="math notranslate nohighlight">\(\epsilon\)</span>. Utilisez la mÃ©thode <span class="math notranslate nohighlight">\(\texttt{delta.data.clamp}\_\texttt{(min, max)}\)</span> qui permet de tronquer la valeur.</p>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">/</span><span class="mi">255</span>

<span class="c1"># we initialize delta with 0</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># we construct our optimizer and loss</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">([</span><span class="n">delta</span><span class="p">],</span> <span class="n">lr</span><span class="o">=</span><span class="mf">2e-1</span><span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">CrossEntropyLoss</span><span class="p">()</span>

<span class="c1"># we construct the target</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">LongTensor</span><span class="p">([</span><span class="n">true_index</span><span class="p">])</span>

<span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">60</span><span class="p">):</span>
    <span class="c1">############### COMPLETE HERE ###############</span>
    <span class="c1"># we construct the batch</span>
    <span class="n">batch</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">tensor</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">resnet</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="o">-</span><span class="n">criterion</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">iteration</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">[</span><span class="si">%d</span><span class="s1">] loss: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
    <span class="n">delta</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">clamp_</span><span class="p">(</span><span class="o">-</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>
    <span class="c1">#############################################</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0] loss: -0.035
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[5] loss: -9.162
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10] loss: -10.251
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[15] loss: -11.255
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[20] loss: -11.710
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[25] loss: -10.968
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[30] loss: -10.418
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[35] loss: -11.473
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[40] loss: -12.274
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[45] loss: -12.471
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[50] loss: -10.997
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[55] loss: -12.261
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">batch</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">tensor</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="n">logit</span> <span class="o">=</span> <span class="n">resnet</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">True class probability:&#39;</span><span class="p">,</span> <span class="n">softmax</span><span class="p">(</span><span class="n">logit</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="n">true_index</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>

<span class="n">new_index</span> <span class="o">=</span> <span class="n">logit</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">new_label</span> <span class="o">=</span> <span class="n">classes_to_labels</span><span class="p">[</span><span class="n">new_index</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New class:&#39;</span><span class="p">,</span> <span class="n">new_label</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True class probability: 5.315194357535802e-06
New class: orange
</pre></div>
</div>
</div>
</div>
<p>Affichons maintenant lâ€™image ainsi obtenue et le bruit qui lui est associÃ© :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">18</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Notre image transformÃ©e $x+\delta$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="n">tensor</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Le bruit $\delta$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="n">delta</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Le bruit $\delta$ amplifiÃ©&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="mi">50</span><span class="o">*</span><span class="n">delta</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
</pre></div>
</div>
<img alt="../_images/4_adversarial_35_1.png" src="../_images/4_adversarial_35_1.png" />
</div>
</div>
<p>Câ€™est beaucoup mieux ! Cependant, ce nâ€™est pas en transformant des citrons en oranges que nous arriverons Ã  prendre le contrÃ´le de lâ€™univers ! Ce que nous souhaiterions, câ€™est tromper le rÃ©seau de neurones avec une classe qui nâ€™a RIEN Ã€ VOIR !!</p>
<p>Avant dâ€™aller plus loin, il convient de comprendre un peu mieux pourquoi le rÃ©seau de neurones a choisi la classe orange Ã  la place de citron. En minimisant lâ€™opposÃ© de lâ€™entropie croisÃ©e afin de trouver notre bruit <span class="math notranslate nohighlight">\(\delta\)</span> nous avons en rÃ©alitÃ© principalement rÃ©duit lâ€™amplitude des logits (i.e. le vecteur de score associÃ© Ã  chaque classe) pour la classe citronâ€¦ Celle-ci en perdant de lâ€™importance a laissÃ© la place Ã  la deuxiÃ¨me classe la plus probable pour cette image : les oranges.</p>
</div>
<div class="section" id="vi-une-attaque-un-petit-peu-plus-ciblee">
<h2>VI. Une attaque un petit peu plus ciblÃ©e ?<a class="headerlink" href="#vi-une-attaque-un-petit-peu-plus-ciblee" title="Permalink to this headline">Â¶</a></h2>
<p>Ce que nous voulons ici, câ€™est minimiser lâ€™importance dâ€™une classe <span class="math notranslate nohighlight">\(A\)</span> tout en augmentant lâ€™importance dâ€™une classe <span class="math notranslate nohighlight">\(B\)</span>. Le problÃ¨me qui nous intÃ©resse est donc :</p>
<div class="math notranslate nohighlight">
\[\delta^\star=\text{argmin}_{\delta\in\mathcal{B}_\epsilon}-\ell(h_{\theta}(x+\delta), y)+\ell(h_{\theta}(x+\delta), y_{\text{target}}),\]</div>
<p>oÃ¹ <span class="math notranslate nohighlight">\(y_{\text{target}}\)</span> est la classe que nous aimerions voir prÃ©dite. Choisissons maintenant la classe que nous visons :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_index</span> <span class="o">=</span> <span class="mi">589</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Selected target:&#39;</span><span class="p">,</span> <span class="n">classes_to_labels</span><span class="p">[</span><span class="n">target_index</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Selected target: hand blower, blow dryer, blow drier, hair dryer, hair drier
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p><span style="color:blue"><strong>Exercice :</strong></span> ComplÃ©tez lâ€™algorithme suivant permettant de construire notre attaque adversaire en contraignant le vecteur <span class="math notranslate nohighlight">\(\delta\)</span> Ã  rester dans une boule de rayon <span class="math notranslate nohighlight">\(\epsilon\)</span> et en ciblant une classe objectif.</p>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">/</span><span class="mi">255</span>

<span class="c1"># we initialize delta with 0</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># we construct our optimizer and loss</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">([</span><span class="n">delta</span><span class="p">],</span> <span class="n">lr</span><span class="o">=</span><span class="mf">5e-3</span><span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">CrossEntropyLoss</span><span class="p">()</span>

<span class="c1"># we construct the targets</span>
<span class="n">true_target</span> <span class="o">=</span> <span class="n">LongTensor</span><span class="p">([</span><span class="n">true_index</span><span class="p">])</span>
<span class="n">target_target</span> <span class="o">=</span> <span class="n">LongTensor</span><span class="p">([</span><span class="n">target_index</span><span class="p">])</span>

<span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="c1">############### COMPLETE HERE ###############</span>
    <span class="c1"># we construct the batch</span>
    <span class="n">batch</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">tensor</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">resnet</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="o">-</span><span class="n">criterion</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">true_target</span><span class="p">)</span> <span class="o">+</span> <span class="n">criterion</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">target_target</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">iteration</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">[</span><span class="si">%d</span><span class="s1">] loss: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    
    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
    <span class="n">delta</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">clamp_</span><span class="p">(</span><span class="o">-</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>
    <span class="c1">#############################################</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0] loss: 18.440
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[5] loss: 11.775
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10] loss: 9.746
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[15] loss: 8.210
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[20] loss: 6.879
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[25] loss: 5.667
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[30] loss: 4.497
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[35] loss: 3.177
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[40] loss: 1.442
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[45] loss: -2.225
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[50] loss: -7.591
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[55] loss: -12.936
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[60] loss: -18.174
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[65] loss: -21.664
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[70] loss: -24.085
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[75] loss: -28.187
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[80] loss: -29.117
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[85] loss: -31.689
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[90] loss: -33.206
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[95] loss: -35.661
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">batch</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">tensor</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="n">logit</span> <span class="o">=</span> <span class="n">resnet</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">True class probability:&#39;</span><span class="p">,</span> <span class="n">softmax</span><span class="p">(</span><span class="n">logit</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="n">true_index</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>

<span class="n">new_index</span> <span class="o">=</span> <span class="n">logit</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">new_label</span> <span class="o">=</span> <span class="n">classes_to_labels</span><span class="p">[</span><span class="n">new_index</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New class:&#39;</span><span class="p">,</span> <span class="n">new_label</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True class probability: 3.0753880343007024e-17
New class: hand blower, blow dryer, blow drier, hair dryer, hair drier
</pre></div>
</div>
</div>
</div>
<p>Victoire ! Observons maintenant lâ€™image bruitÃ©e ainsi que le bruit associÃ©.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">18</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Notre image transformÃ©e $x+\delta$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="n">tensor</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Le bruit $\delta$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="n">delta</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Le bruit $\delta$ amplifiÃ©&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="mi">50</span><span class="o">*</span><span class="n">delta</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
</pre></div>
</div>
<img alt="../_images/4_adversarial_45_1.png" src="../_images/4_adversarial_45_1.png" />
</div>
</div>
<p>Nous avons ainsi rÃ©ussi Ã  choisir notre classe objectif et Ã  perturber notre rÃ©seau de neurones avec un bruit invisible Ã  lâ€™oeil nu.</p>
</div>
<div class="section" id="vii-la-methode-fast-sign">
<h2>VII. La mÃ©thode â€œfast-signâ€<a class="headerlink" href="#vii-la-methode-fast-sign" title="Permalink to this headline">Â¶</a></h2>
<p>Nous avons pu constater dans lâ€™exemple prÃ©cÃ©dent que la construction dâ€™un exemple adversaire demandait de minimiser une fonction de coÃ»t (i.e. lâ€™opposÃ© de ce quâ€™on souhaiterait minimiser en temps normal). Cette minimisation prend un certain temps pour une unique image.</p>
<p>Il existe une mÃ©thode alternative, moins performante en terme dâ€™attaque mais plus efficaces computationnellement. Il sâ€™agit de la mÃ©thode â€œfast-signâ€. Rappelons que lâ€™objectif dâ€™une attaque adversaire est de construire le bruit suivant :</p>
<div class="math notranslate nohighlight">
\[\delta^\star=\text{argmin}_{\delta\in\mathcal{B}_\epsilon}-\ell(h_{\theta}(x+\delta), y).\]</div>
<p>Lâ€™intuition derriÃ¨re la mÃ©thode â€œfast-signâ€ est de supposer que la direction du gradient au cours de la minimisation ne changera pas trÃ¨s significativement. Ainsi, au lieu de rÃ©aliser plusieurs petits pas successifs, nous pouvons rÃ©aliser un grand pas dans la direction du gradient au point de dÃ©part. Notons que nous souhaitons que notre vecteur de bruit reste dans une boule en norme infini <span class="math notranslate nohighlight">\(\ell_\infty\)</span>. Cela revient Ã  dire que pour chaque coordonnÃ©e positive de notre gradient nous voulons que <span class="math notranslate nohighlight">\(\delta_j=-\epsilon\)</span> et pour chaque coordonnÃ©e nÃ©gative, nous voulons <span class="math notranslate nohighlight">\(\delta_j=\epsilon\)</span> (nous voulons aller le plus loin possible). Notre bruit devient donc :</p>
<div class="math notranslate nohighlight">
\[\hat{\delta}=-\epsilon\cdot\text{sign}(\nabla_\delta\ell(h_{\theta}(x+\delta), y)).\]</div>
<hr class="docutils" />
<p><span style="color:blue"><strong>Exercice :</strong></span> Ã€ vous dâ€™implÃ©menter la mÃ©thode <em>fast-sign</em> dans le cas dâ€™une attaque non ciblÃ©e.</p>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">/</span><span class="mi">255</span>

<span class="c1"># we initialize delta with 0</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># we construct our loss</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">CrossEntropyLoss</span><span class="p">()</span>

<span class="c1"># we construct the target</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">LongTensor</span><span class="p">([</span><span class="n">true_index</span><span class="p">])</span>

<span class="n">batch</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">tensor</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>

<span class="n">pred</span> <span class="o">=</span> <span class="n">resnet</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>

<span class="c1">############### COMPLETE HERE ###############</span>
<span class="n">loss</span> <span class="o">=</span> <span class="o">-</span><span class="n">criterion</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
<span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>

<span class="n">delta</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">grad</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">*</span><span class="n">epsilon</span>
<span class="c1">#############################################</span>

<span class="n">batch</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">tensor</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">resnet</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">True class probability:&#39;</span><span class="p">,</span> <span class="n">softmax</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="n">true_index</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>

<span class="n">new_index</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">new_label</span> <span class="o">=</span> <span class="n">classes_to_labels</span><span class="p">[</span><span class="n">new_index</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New class:&#39;</span><span class="p">,</span> <span class="n">new_label</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True class probability: 0.1027536690235138
New class: orange
</pre></div>
</div>
</div>
</div>
<p>La performance de lâ€™attaque est grandement rÃ©duite, mais fonctionne ! Visualisons le rÃ©sultat :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">18</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Notre image transformÃ©e $x+\delta$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="n">tensor</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Le bruit $\delta$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="n">delta</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Le bruit $\delta$ amplifiÃ©&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="mi">50</span><span class="o">*</span><span class="n">delta</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
</pre></div>
</div>
<img alt="../_images/4_adversarial_52_1.png" src="../_images/4_adversarial_52_1.png" />
</div>
</div>
<hr class="docutils" />
<p><span style="color:blue"><strong>Exercice :</strong></span> Ã€ vous dâ€™implÃ©menter la mÃ©thode <em>fast-sign</em> dans le cas dâ€™une attaque ciblÃ©e.</p>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">50.</span><span class="o">/</span><span class="mi">255</span>

<span class="n">target_index</span> <span class="o">=</span> <span class="mi">589</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Selected target:&#39;</span><span class="p">,</span> <span class="n">classes_to_labels</span><span class="p">[</span><span class="n">target_index</span><span class="p">])</span>

<span class="c1"># we initialize delta with 0</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># we construct our loss</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">CrossEntropyLoss</span><span class="p">()</span>

<span class="c1"># we construct the target</span>
<span class="n">true_target</span> <span class="o">=</span> <span class="n">LongTensor</span><span class="p">([</span><span class="n">true_index</span><span class="p">])</span>
<span class="n">target_target</span> <span class="o">=</span> <span class="n">LongTensor</span><span class="p">([</span><span class="n">target_index</span><span class="p">])</span>

<span class="n">batch</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">tensor</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>

<span class="n">pred</span> <span class="o">=</span> <span class="n">resnet</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>

<span class="c1">############### COMPLETE HERE ###############</span>
<span class="n">loss</span> <span class="o">=</span> <span class="o">-</span><span class="n">criterion</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">true_target</span><span class="p">)</span> <span class="o">+</span> <span class="n">criterion</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">target_target</span><span class="p">)</span>
<span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="c1">#############################################</span>

<span class="n">delta</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">grad</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">*</span><span class="n">epsilon</span>

<span class="n">batch</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">tensor</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">resnet</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">True class probability:&#39;</span><span class="p">,</span> <span class="n">softmax</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="n">true_index</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>

<span class="n">new_index</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">new_label</span> <span class="o">=</span> <span class="n">classes_to_labels</span><span class="p">[</span><span class="n">new_index</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New class:&#39;</span><span class="p">,</span> <span class="n">new_label</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Selected target: hand blower, blow dryer, blow drier, hair dryer, hair drier
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True class probability: 0.24176709353923798
New class: jackfruit, jak, jack
</pre></div>
</div>
</div>
</div>
<p>Il est probable que cette attaque ait Ã©chouÃ©. En effet, nous avons dÃ©jÃ  pu observer que dans le cas non ciblÃ©, notre attaque avait eu beaucoup moins dâ€™effet. Lâ€™effet sur les logits de la bonne classe est encore plus rÃ©duit lorsque lâ€™attaque devient ciblÃ©e. Pour que lâ€™attaque fonctionne, nous devons considÃ©rer un dÃ©placement plus significatif qui risque dâ€™Ãªtre visible Ã  lâ€™Ã©cranâ€¦</p>
<p>Testez plusieurs valeurs de <span class="math notranslate nohighlight">\(\epsilon\)</span> et observez le rÃ©sultat Ã  la fois en termes de prÃ©diction que visuellement avec le code ci-dessous.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">18</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Notre image transformÃ©e $x+\delta$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="n">tensor</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Le bruit $\delta$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="n">delta</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Le bruit $\delta$ amplifiÃ©&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="mi">50</span><span class="o">*</span><span class="n">delta</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
</pre></div>
</div>
<img alt="../_images/4_adversarial_56_2.png" src="../_images/4_adversarial_56_2.png" />
</div>
</div>
</div>
<div class="section" id="viii-devenir-robuste-aux-attaques-adversaires">
<h2>VIII. Devenir robuste aux attaques adversaires<a class="headerlink" href="#viii-devenir-robuste-aux-attaques-adversaires" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">Â¶</a></h3>
<p>Comme indiquÃ© plus haut, lâ€™objectif de notre apprentissage est de trouver la solution :</p>
<div class="math notranslate nohighlight">
\[\theta^\star=\text{argmin}_{\theta\in\mathbb{R}^p}\frac{1}{n}\sum_i \ell(h_\theta(x_i), y_i)=\text{argmin}_{\theta\in\mathbb{R}^p}\mathcal{L}(h_\theta, S_n).\]</div>
<p>Câ€™est la paramÃ©trisation qui fait le moins dâ€™erreur (au sens de la loss <span class="math notranslate nohighlight">\(\ell\)</span>) sur notre jeu de donnÃ©es dâ€™apprentissage. Si le choix de notre classe de fonctions et de nos hyperparamÃ¨tres est bon, alors cette mÃªme paramÃ©trisation fonctionnera Ã©galement sur des donnÃ©es que nous nâ€™avons pas encore vu. Cependant, cette derniÃ¨re peut Ãªtre trÃ¨s sensible aux attaques adversaires comme nous avons pu le voir ci-dessus. Une solution consiste Ã  ne pas minimiser notre loss sur le jeu dâ€™apprentissage, mais notre loss dans le pire des cas :</p>
<div class="math notranslate nohighlight">
\[\theta^\star=\text{argmin}_{\theta\in\mathbb{R}^p}\frac{1}{n}\sum_i \text{max}_{\delta\in\mathcal{B}_\epsilon}\ell(h_\theta(x_i+\delta), y_i).\]</div>
<p>Rappelons nous que lâ€™algorithme de descente de gradient a besoin de ce dernier. Il nous faut donc calculer le gradient du maximum. Il se trouve que la solution est assez simple et revient Ã  calculer le gradient au point <span class="math notranslate nohighlight">\(\delta^\star\)</span>, solution du maximum :</p>
<div class="math notranslate nohighlight">
\[\nabla_\theta \text{max}_{\delta\in\mathcal{B}_\epsilon}\ell(h_\theta(x_i+\delta), y_i)=\nabla_\theta \ell(h_\theta(x_i+\delta^\star), y_i).\]</div>
</div>
<div class="section" id="construction-du-jeu-de-donnees">
<h3>Construction du jeu de donnÃ©es<a class="headerlink" href="#construction-du-jeu-de-donnees" title="Permalink to this headline">Â¶</a></h3>
<p>Nous utiliserons ici le jeu de donnÃ©es MNIST restreint aux chiffres 0 et 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mnist_train</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">MNIST</span><span class="p">(</span><span class="s2">&quot;./data&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">())</span>
<span class="n">mnist_test</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">MNIST</span><span class="p">(</span><span class="s2">&quot;./data&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_idx</span> <span class="o">=</span> <span class="n">mnist_train</span><span class="o">.</span><span class="n">targets</span> <span class="o">&lt;=</span> <span class="mi">1</span>
<span class="n">mnist_train</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">mnist_train</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">train_idx</span><span class="p">]</span>
<span class="n">mnist_train</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">mnist_train</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">train_idx</span><span class="p">]</span>

<span class="n">test_idx</span> <span class="o">=</span> <span class="n">mnist_test</span><span class="o">.</span><span class="n">targets</span> <span class="o">&lt;=</span> <span class="mi">1</span>
<span class="n">mnist_test</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">mnist_test</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>
<span class="n">mnist_test</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">mnist_test</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>

<span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">mnist_train</span><span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">mnist_test</span><span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Visualisons la tÃªte de ces donnÃ©es.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
<span class="n">images</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">())</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4_adversarial_63_0.png" src="../_images/4_adversarial_63_0.png" />
</div>
</div>
</div>
<div class="section" id="un-cas-simple-le-modele-lineaire-rappels">
<h3>Un cas simple : le modÃ¨le linÃ©aire (Rappels)<a class="headerlink" href="#un-cas-simple-le-modele-lineaire-rappels" title="Permalink to this headline">Â¶</a></h3>
<p>La mÃ©thode â€œfast-signâ€ permet dâ€™obtenir efficacement un adversaire mais le rÃ©sultat nâ€™est quâ€™approximatif. Le cas du modÃ¨le linÃ©aire est intÃ©ressant car il est possible de trouver analytiquement les solutions de la maximisation (lâ€™adversaire). Comme nous lâ€™avons vu, un modÃ¨le linÃ©aire cherche Ã  sÃ©parer les classes par un ou plusieurs (multi-classes) hyperplans. Supposons que nous soyons dans <span class="math notranslate nohighlight">\(\mathbb{R}^d\)</span>, un hyper-plan est dÃ©crit par un vecteur <span class="math notranslate nohighlight">\(\omega\in\mathbb{R}^d\)</span> et un scalaire <span class="math notranslate nohighlight">\(b\in\mathbb{R}\)</span>. Le vecteur <span class="math notranslate nohighlight">\(\omega\)</span> donne lâ€™orientation de lâ€™hyperplan et <span class="math notranslate nohighlight">\(b\)</span> sa â€œdistanceâ€ Ã  â€œlâ€™origineâ€. Ainsi, un hyperplan est reprÃ©sentÃ© par lâ€™ensemble des points suivants :</p>
<div class="math notranslate nohighlight">
\[\{x\in\mathbb{R}^d:\ \langle \omega, x\rangle+b=0\}.\]</div>
<p>Au-delÃ  des points de lâ€™hyperplan, la quantitÃ© <span class="math notranslate nohighlight">\(\langle \omega, x,\rangle+b\)</span> est positive si on est dâ€™un cÃ´tÃ© de lâ€™hyperplan et nÃ©gative de lâ€™autre. ConsidÃ©rons le cas binaire et notons nos classes <span class="math notranslate nohighlight">\(\mathcal{Y}=\{-1,+1\}\)</span>. On souhaiterait que le cÃ´tÃ© nÃ©gatif de lâ€™hyperplan soit associÃ© aux donnÃ©es dont le label est -1 et de la mÃªme maniÃ¨re que le cÃ´tÃ© positif soit associÃ© aux donnÃ©es dont le label est +1.</p>
<p>Soit la fonction <span class="math notranslate nohighlight">\(\text{sign}(z)\)</span> qui retourne <span class="math notranslate nohighlight">\(+1\)</span> si <span class="math notranslate nohighlight">\(z&gt;0\)</span> et <span class="math notranslate nohighlight">\(-1\)</span> si <span class="math notranslate nohighlight">\(z\leq 0\)</span>. Le classifieur associÃ© Ã  notre hyperplan se construit donc de la maniÃ¨re suivante :</p>
<div class="math notranslate nohighlight">
\[h_\theta(x)=\text{sign}(\langle \omega, x\rangle + b),\ \theta=\{\omega\in\mathbb{R}^d,b\in\mathbb{R}\}.\]</div>
<p>Par simplicitÃ© de notation nous ommettrons Ã  partir de maintenant le biais <span class="math notranslate nohighlight">\(b\)</span>. Notons <span class="math notranslate nohighlight">\(g(x)=\langle \omega, x\rangle\)</span>. Il sâ€™agit dâ€™une fonction qui donne le score de classification. On remarque que la fonction <span class="math notranslate nohighlight">\(g\)</span> prÃ©dit le bon label si <span class="math notranslate nohighlight">\(g(x)\)</span> a le mÃªme signe que <span class="math notranslate nohighlight">\(y\)</span>. Dit autrement, nos prÃ©dictions sont correctes si <span class="math notranslate nohighlight">\(g(x)y&gt;0\)</span>.</p>
<p>Intuitivement, nous aimerions minimiser la loss 0/1 :
$<span class="math notranslate nohighlight">\(\ell_{0/1}(z)=1\{z\leq 0\}.\)</span><span class="math notranslate nohighlight">\(
Cette loss retourne \)</span>1<span class="math notranslate nohighlight">\( si \)</span>z<span class="math notranslate nohighlight">\( est nÃ©gatif et \)</span>0<span class="math notranslate nohighlight">\( sinon. AppliquÃ© Ã  notre modÃ¨le, cela donnÃ©e \)</span>\ell(g(x)y)<span class="math notranslate nohighlight">\( qui vaut \)</span>1<span class="math notranslate nohighlight">\( si \)</span>g(x)<span class="math notranslate nohighlight">\( n'a pas le mÃªme signe que \)</span>y<span class="math notranslate nohighlight">\(. C'est exactement ce qu'on veut. Cependant, cette loss n'est pas diffÃ©rentiable en \)</span>0<span class="math notranslate nohighlight">\( et son gradient vaut \)</span>0$ partout ailleurs. Cela nous complique la tÃ¢che lorsquâ€™on cherche Ã  optimiser notre modÃ¨le. Utilisons donc une loss possÃ©dant de meilleures propriÃ©tÃ©s mathÃ©matiques ainsi que certaines garanties pour la classification. Il sâ€™agit de la fonction de perte logistique :</p>
<div class="math notranslate nohighlight">
\[\ell(z)=\text{log}(1+e^{-z}).\]</div>
<p>On remarque que si <span class="math notranslate nohighlight">\(z\)</span> est trÃ¨s grand (<span class="math notranslate nohighlight">\(g\)</span> et <span class="math notranslate nohighlight">\(y\)</span> sont de mÃªme signe et le score prÃ©dit est grand) alors la fonction est trÃ¨s proche de <span class="math notranslate nohighlight">\(0\)</span>. Si <span class="math notranslate nohighlight">\(z\)</span> est trÃ¨s petit (<span class="math notranslate nohighlight">\(g\)</span> et <span class="math notranslate nohighlight">\(y\)</span> sont de signe diffÃ©rent et le score prÃ©dit est grand) alors la fonction diverge vers <span class="math notranslate nohighlight">\(+\infty\)</span>. Il sâ€™agit en rÃ©alitÃ© exactement de lâ€™entropie croisÃ©e composÃ©e avec la sigmoid que nous avons dÃ©jÃ  vu !</p>
<p>Finalement, le problÃ¨me Ã  rÃ©soudre dans le cadre dâ€™un classifieur linÃ©aire est le suivant :</p>
<div class="math notranslate nohighlight">
\[\theta^\star=\text{argmin}_{\theta=\omega\in\mathbb{R}^d}\frac{1}{n}\sum_i \ell(y\langle \omega, x\rangle).\]</div>
</div>
<div class="section" id="construction-du-modele">
<h3>Construction du modÃ¨le<a class="headerlink" href="#construction-du-modele" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LinearClassifier</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim_input</span><span class="o">=</span><span class="mi">784</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LinearClassifier</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">Linear</span><span class="p">(</span><span class="n">dim_input</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_input</span> <span class="o">=</span> <span class="n">dim_input</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># we flatten the image into a vector</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_input</span><span class="p">)</span>
        <span class="c1"># we apply our linear model</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="construction-de-la-loss">
<h3>Construction de la loss<a class="headerlink" href="#construction-de-la-loss" title="Permalink to this headline">Â¶</a></h3>
<p>La logistic loss nâ€™est rien dâ€™autre que la sigmoid composÃ©e avec lâ€™entropie croisÃ©e.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LogisticLoss</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LogisticLoss</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="c1"># we flatten the image into a vector</span>
        <span class="n">y_hat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">y_hat</span><span class="p">)</span>
        <span class="n">batch_size</span> <span class="o">=</span> <span class="n">y_hat</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span>  <span class="c1"># on met les labels entre -1 (anciennement 0) et 1</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">y_hat</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">z</span><span class="p">)))</span> <span class="o">/</span> <span class="n">batch_size</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="entrainement">
<h3>EntraÃ®nement<a class="headerlink" href="#entrainement" title="Permalink to this headline">Â¶</a></h3>
<p>Notez quâ€™il sâ€™agit encore et toujours ici de lâ€™entraÃ®nement classique oÃ¹ nous ne tenons pas compte des attaques adversaires.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">train_and_plot</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">logs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="n">LogisticLoss</span><span class="p">()):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">LinearClassifier</span><span class="p">()</span>
    <span class="c1"># model.cuda()</span>
    
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    
    <span class="n">loss_history</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">running_loss</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_loader</span><span class="p">):</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">data</span>
            <span class="c1"># labels = labels.cuda()</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
            
            <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
            <span class="n">running_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">%</span> <span class="n">logs</span> <span class="o">==</span> <span class="n">logs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># print every 2000 mini-batches</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">[</span><span class="si">%d</span><span class="s1">, </span><span class="si">%5d</span><span class="s1">] loss: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">running_loss</span> <span class="o">/</span> <span class="n">logs</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">loss_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">running_loss</span> <span class="o">/</span> <span class="n">logs</span><span class="p">)</span>
                <span class="n">running_loss</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span> <span class="c1"># on calcule le gradient</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span> <span class="c1"># on fait un pas d&#39;optimisation</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">************* Training done! *************&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loss_history</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Loss&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">train_and_plot</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">logs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1,     1] loss: 0.758
[1,     2] loss: 0.748
[1,     3] loss: 0.747
[1,     4] loss: 0.741
[1,     5] loss: 0.735
[1,     6] loss: 0.736
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1,     7] loss: 0.734
[1,     8] loss: 0.726
[1,     9] loss: 0.725
[1,    10] loss: 0.717
[1,    11] loss: 0.717
[1,    12] loss: 0.712
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1,    13] loss: 0.710
[1,    14] loss: 0.704
[1,    15] loss: 0.707
[1,    16] loss: 0.697
[1,    17] loss: 0.695
[1,    18] loss: 0.696
[1,    19] loss: 0.690
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1,    20] loss: 0.684
[1,    21] loss: 0.683
[1,    22] loss: 0.683
[1,    23] loss: 0.679
[1,    24] loss: 0.671
[1,    25] loss: 0.667
[2,     1] loss: 0.663
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2,     2] loss: 0.666
[2,     3] loss: 0.657
[2,     4] loss: 0.658
[2,     5] loss: 0.658
[2,     6] loss: 0.655
[2,     7] loss: 0.651
[2,     8] loss: 0.650
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2,     9] loss: 0.644
[2,    10] loss: 0.639
[2,    11] loss: 0.634
[2,    12] loss: 0.635
[2,    13] loss: 0.634
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2,    14] loss: 0.629
[2,    15] loss: 0.626
[2,    16] loss: 0.625
[2,    17] loss: 0.623
[2,    18] loss: 0.619
[2,    19] loss: 0.619
[2,    20] loss: 0.616
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2,    21] loss: 0.612
[2,    22] loss: 0.613
[2,    23] loss: 0.607
[2,    24] loss: 0.611
[2,    25] loss: 0.599
[3,     1] loss: 0.600
[3,     2] loss: 0.596
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3,     3] loss: 0.605
[3,     4] loss: 0.589
[3,     5] loss: 0.590
[3,     6] loss: 0.586
[3,     7] loss: 0.585
[3,     8] loss: 0.581
[3,     9] loss: 0.585
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3,    10] loss: 0.580
[3,    11] loss: 0.575
[3,    12] loss: 0.571
[3,    13] loss: 0.568
[3,    14] loss: 0.570
[3,    15] loss: 0.566
[3,    16] loss: 0.569
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3,    17] loss: 0.562
[3,    18] loss: 0.561
[3,    19] loss: 0.556
[3,    20] loss: 0.560
[3,    21] loss: 0.553
[3,    22] loss: 0.559
[3,    23] loss: 0.545
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3,    24] loss: 0.544
[3,    25] loss: 0.543
[4,     1] loss: 0.550
[4,     2] loss: 0.540
[4,     3] loss: 0.535
[4,     4] loss: 0.539
[4,     5] loss: 0.538
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[4,     6] loss: 0.535
[4,     7] loss: 0.531
[4,     8] loss: 0.535
[4,     9] loss: 0.534
[4,    10] loss: 0.521
[4,    11] loss: 0.527
[4,    12] loss: 0.526
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[4,    13] loss: 0.513
[4,    14] loss: 0.515
[4,    15] loss: 0.509
[4,    16] loss: 0.518
[4,    17] loss: 0.514
[4,    18] loss: 0.514
[4,    19] loss: 0.510
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[4,    20] loss: 0.497
[4,    21] loss: 0.508
[4,    22] loss: 0.514
[4,    23] loss: 0.502
[4,    24] loss: 0.495
[4,    25] loss: 0.503
[5,     1] loss: 0.500
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[5,     2] loss: 0.496
[5,     3] loss: 0.491
[5,     4] loss: 0.496
[5,     5] loss: 0.495
[5,     6] loss: 0.486
[5,     7] loss: 0.484
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[5,     8] loss: 0.487
[5,     9] loss: 0.489
[5,    10] loss: 0.490
[5,    11] loss: 0.485
[5,    12] loss: 0.475
[5,    13] loss: 0.480
[5,    14] loss: 0.479
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[5,    15] loss: 0.472
[5,    16] loss: 0.469
[5,    17] loss: 0.466
[5,    18] loss: 0.469
[5,    19] loss: 0.465
[5,    20] loss: 0.470
[5,    21] loss: 0.465
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[5,    22] loss: 0.453
[5,    23] loss: 0.462
[5,    24] loss: 0.462
[5,    25] loss: 0.467
[6,     1] loss: 0.461
[6,     2] loss: 0.463
[6,     3] loss: 0.455
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[6,     4] loss: 0.454
[6,     5] loss: 0.457
[6,     6] loss: 0.451
[6,     7] loss: 0.445
[6,     8] loss: 0.448
[6,     9] loss: 0.456
[6,    10] loss: 0.438
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[6,    11] loss: 0.448
[6,    12] loss: 0.447
[6,    13] loss: 0.436
[6,    14] loss: 0.424
[6,    15] loss: 0.434
[6,    16] loss: 0.431
[6,    17] loss: 0.438
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[6,    18] loss: 0.435
[6,    19] loss: 0.440
[6,    20] loss: 0.434
[6,    21] loss: 0.432
[6,    22] loss: 0.420
[6,    23] loss: 0.428
[6,    24] loss: 0.434
[6,    25] loss: 0.424
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7,     1] loss: 0.433
[7,     2] loss: 0.428
[7,     3] loss: 0.422
[7,     4] loss: 0.418
[7,     5] loss: 0.421
[7,     6] loss: 0.421
[7,     7] loss: 0.419
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7,     8] loss: 0.415
[7,     9] loss: 0.411
[7,    10] loss: 0.414
[7,    11] loss: 0.413
[7,    12] loss: 0.411
[7,    13] loss: 0.412
[7,    14] loss: 0.404
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7,    15] loss: 0.406
[7,    16] loss: 0.409
[7,    17] loss: 0.404
[7,    18] loss: 0.398
[7,    19] loss: 0.409
[7,    20] loss: 0.397
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7,    21] loss: 0.398
[7,    22] loss: 0.398
[7,    23] loss: 0.395
[7,    24] loss: 0.393
[7,    25] loss: 0.391
[8,     1] loss: 0.383
[8,     2] loss: 0.389
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[8,     3] loss: 0.398
[8,     4] loss: 0.393
[8,     5] loss: 0.386
[8,     6] loss: 0.387
[8,     7] loss: 0.388
[8,     8] loss: 0.385
[8,     9] loss: 0.385
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[8,    10] loss: 0.392
[8,    11] loss: 0.379
[8,    12] loss: 0.386
[8,    13] loss: 0.383
[8,    14] loss: 0.383
[8,    15] loss: 0.385
[8,    16] loss: 0.381
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[8,    17] loss: 0.385
[8,    18] loss: 0.383
[8,    19] loss: 0.385
[8,    20] loss: 0.375
[8,    21] loss: 0.376
[8,    22] loss: 0.359
[8,    23] loss: 0.371
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[8,    24] loss: 0.374
[8,    25] loss: 0.358
[9,     1] loss: 0.361
[9,     2] loss: 0.373
[9,     3] loss: 0.358
[9,     4] loss: 0.357
[9,     5] loss: 0.369
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[9,     6] loss: 0.358
[9,     7] loss: 0.359
[9,     8] loss: 0.371
[9,     9] loss: 0.359
[9,    10] loss: 0.362
[9,    11] loss: 0.360
[9,    12] loss: 0.358
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[9,    13] loss: 0.360
[9,    14] loss: 0.357
[9,    15] loss: 0.360
[9,    16] loss: 0.354
[9,    17] loss: 0.359
[9,    18] loss: 0.356
[9,    19] loss: 0.355
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[9,    20] loss: 0.351
[9,    21] loss: 0.353
[9,    22] loss: 0.358
[9,    23] loss: 0.349
[9,    24] loss: 0.338
[9,    25] loss: 0.351
[10,     1] loss: 0.351
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10,     2] loss: 0.346
[10,     3] loss: 0.343
[10,     4] loss: 0.346
[10,     5] loss: 0.346
[10,     6] loss: 0.348
[10,     7] loss: 0.342
[10,     8] loss: 0.339
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10,     9] loss: 0.338
[10,    10] loss: 0.337
[10,    11] loss: 0.332
[10,    12] loss: 0.343
[10,    13] loss: 0.331
[10,    14] loss: 0.325
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10,    15] loss: 0.331
[10,    16] loss: 0.321
[10,    17] loss: 0.331
[10,    18] loss: 0.339
[10,    19] loss: 0.338
[10,    20] loss: 0.329
[10,    21] loss: 0.338
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10,    22] loss: 0.331
[10,    23] loss: 0.331
[10,    24] loss: 0.329
[10,    25] loss: 0.323
[11,     1] loss: 0.330
[11,     2] loss: 0.327
[11,     3] loss: 0.328
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[11,     4] loss: 0.322
[11,     5] loss: 0.323
[11,     6] loss: 0.316
[11,     7] loss: 0.312
[11,     8] loss: 0.319
[11,     9] loss: 0.316
[11,    10] loss: 0.326
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[11,    11] loss: 0.312
[11,    12] loss: 0.317
[11,    13] loss: 0.316
[11,    14] loss: 0.320
[11,    15] loss: 0.320
[11,    16] loss: 0.316
[11,    17] loss: 0.322
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[11,    18] loss: 0.310
[11,    19] loss: 0.306
[11,    20] loss: 0.313
[11,    21] loss: 0.316
[11,    22] loss: 0.319
[11,    23] loss: 0.307
[11,    24] loss: 0.313
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[11,    25] loss: 0.305
[12,     1] loss: 0.311
[12,     2] loss: 0.318
[12,     3] loss: 0.311
[12,     4] loss: 0.300
[12,     5] loss: 0.311
[12,     6] loss: 0.311
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[12,     7] loss: 0.305
[12,     8] loss: 0.305
[12,     9] loss: 0.303
[12,    10] loss: 0.301
[12,    11] loss: 0.303
[12,    12] loss: 0.309
[12,    13] loss: 0.295
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[12,    14] loss: 0.298
[12,    15] loss: 0.297
[12,    16] loss: 0.291
[12,    17] loss: 0.293
[12,    18] loss: 0.291
[12,    19] loss: 0.296
[12,    20] loss: 0.301
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[12,    21] loss: 0.301
[12,    22] loss: 0.287
[12,    23] loss: 0.283
[12,    24] loss: 0.291
[12,    25] loss: 0.297
[13,     1] loss: 0.293
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[13,     2] loss: 0.287
[13,     3] loss: 0.290
[13,     4] loss: 0.295
[13,     5] loss: 0.289
[13,     6] loss: 0.290
[13,     7] loss: 0.286
[13,     8] loss: 0.284
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[13,     9] loss: 0.287
[13,    10] loss: 0.283
[13,    11] loss: 0.283
[13,    12] loss: 0.285
[13,    13] loss: 0.286
[13,    14] loss: 0.283
[13,    15] loss: 0.292
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[13,    16] loss: 0.283
[13,    17] loss: 0.279
[13,    18] loss: 0.289
[13,    19] loss: 0.278
[13,    20] loss: 0.272
[13,    21] loss: 0.283
[13,    22] loss: 0.277
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[13,    23] loss: 0.282
[13,    24] loss: 0.283
[13,    25] loss: 0.285
[14,     1] loss: 0.277
[14,     2] loss: 0.283
[14,     3] loss: 0.270
[14,     4] loss: 0.270
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[14,     5] loss: 0.281
[14,     6] loss: 0.273
[14,     7] loss: 0.272
[14,     8] loss: 0.276
[14,     9] loss: 0.284
[14,    10] loss: 0.276
[14,    11] loss: 0.266
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[14,    12] loss: 0.272
[14,    13] loss: 0.273
[14,    14] loss: 0.271
[14,    15] loss: 0.268
[14,    16] loss: 0.266
[14,    17] loss: 0.265
[14,    18] loss: 0.275
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[14,    19] loss: 0.266
[14,    20] loss: 0.265
[14,    21] loss: 0.260
[14,    22] loss: 0.274
[14,    23] loss: 0.266
[14,    24] loss: 0.262
[14,    25] loss: 0.266
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[15,     1] loss: 0.264
[15,     2] loss: 0.262
[15,     3] loss: 0.259
[15,     4] loss: 0.261
[15,     5] loss: 0.259
[15,     6] loss: 0.271
[15,     7] loss: 0.264
[15,     8] loss: 0.258
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[15,     9] loss: 0.263
[15,    10] loss: 0.256
[15,    11] loss: 0.258
[15,    12] loss: 0.267
[15,    13] loss: 0.262
[15,    14] loss: 0.255
[15,    15] loss: 0.249
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[15,    16] loss: 0.259
[15,    17] loss: 0.257
[15,    18] loss: 0.259
[15,    19] loss: 0.256
[15,    20] loss: 0.257
[15,    21] loss: 0.249
[15,    22] loss: 0.249
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[15,    23] loss: 0.250
[15,    24] loss: 0.259
[15,    25] loss: 0.262
[16,     1] loss: 0.255
[16,     2] loss: 0.257
[16,     3] loss: 0.253
[16,     4] loss: 0.255
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[16,     5] loss: 0.254
[16,     6] loss: 0.252
[16,     7] loss: 0.243
[16,     8] loss: 0.245
[16,     9] loss: 0.247
[16,    10] loss: 0.251
[16,    11] loss: 0.247
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[16,    12] loss: 0.254
[16,    13] loss: 0.253
[16,    14] loss: 0.246
[16,    15] loss: 0.243
[16,    16] loss: 0.242
[16,    17] loss: 0.238
[16,    18] loss: 0.240
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[16,    19] loss: 0.256
[16,    20] loss: 0.242
[16,    21] loss: 0.235
[16,    22] loss: 0.245
[16,    23] loss: 0.242
[16,    24] loss: 0.237
[16,    25] loss: 0.241
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17,     1] loss: 0.244
[17,     2] loss: 0.249
[17,     3] loss: 0.242
[17,     4] loss: 0.241
[17,     5] loss: 0.226
[17,     6] loss: 0.243
[17,     7] loss: 0.241
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17,     8] loss: 0.235
[17,     9] loss: 0.234
[17,    10] loss: 0.240
[17,    11] loss: 0.244
[17,    12] loss: 0.242
[17,    13] loss: 0.235
[17,    14] loss: 0.238
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17,    15] loss: 0.229
[17,    16] loss: 0.239
[17,    17] loss: 0.234
[17,    18] loss: 0.233
[17,    19] loss: 0.226
[17,    20] loss: 0.230
[17,    21] loss: 0.236
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17,    22] loss: 0.230
[17,    23] loss: 0.242
[17,    24] loss: 0.232
[17,    25] loss: 0.229
[18,     1] loss: 0.228
[18,     2] loss: 0.226
[18,     3] loss: 0.229
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[18,     4] loss: 0.229
[18,     5] loss: 0.226
[18,     6] loss: 0.230
[18,     7] loss: 0.240
[18,     8] loss: 0.227
[18,     9] loss: 0.224
[18,    10] loss: 0.230
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[18,    11] loss: 0.229
[18,    12] loss: 0.231
[18,    13] loss: 0.231
[18,    14] loss: 0.239
[18,    15] loss: 0.227
[18,    16] loss: 0.226
[18,    17] loss: 0.214
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[18,    18] loss: 0.232
[18,    19] loss: 0.216
[18,    20] loss: 0.223
[18,    21] loss: 0.219
[18,    22] loss: 0.224
[18,    23] loss: 0.219
[18,    24] loss: 0.228
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[18,    25] loss: 0.231
[19,     1] loss: 0.224
[19,     2] loss: 0.224
[19,     3] loss: 0.220
[19,     4] loss: 0.226
[19,     5] loss: 0.224
[19,     6] loss: 0.221
[19,     7] loss: 0.216
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[19,     8] loss: 0.211
[19,     9] loss: 0.224
[19,    10] loss: 0.222
[19,    11] loss: 0.213
[19,    12] loss: 0.216
[19,    13] loss: 0.217
[19,    14] loss: 0.213
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[19,    15] loss: 0.221
[19,    16] loss: 0.215
[19,    17] loss: 0.208
[19,    18] loss: 0.223
[19,    19] loss: 0.224
[19,    20] loss: 0.215
[19,    21] loss: 0.222
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[19,    22] loss: 0.221
[19,    23] loss: 0.215
[19,    24] loss: 0.211
[19,    25] loss: 0.209
[20,     1] loss: 0.216
[20,     2] loss: 0.217
[20,     3] loss: 0.218
[20,     4] loss: 0.213
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[20,     5] loss: 0.215
[20,     6] loss: 0.220
[20,     7] loss: 0.211
[20,     8] loss: 0.206
[20,     9] loss: 0.205
[20,    10] loss: 0.215
[20,    11] loss: 0.213
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[20,    12] loss: 0.211
[20,    13] loss: 0.209
[20,    14] loss: 0.201
[20,    15] loss: 0.207
[20,    16] loss: 0.208
[20,    17] loss: 0.209
[20,    18] loss: 0.205
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[20,    19] loss: 0.204
[20,    20] loss: 0.198
[20,    21] loss: 0.210
[20,    22] loss: 0.204
[20,    23] loss: 0.208
[20,    24] loss: 0.211
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[20,    25] loss: 0.222
[21,     1] loss: 0.211
[21,     2] loss: 0.210
[21,     3] loss: 0.200
[21,     4] loss: 0.208
[21,     5] loss: 0.203
[21,     6] loss: 0.201
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[21,     7] loss: 0.214
[21,     8] loss: 0.192
[21,     9] loss: 0.203
[21,    10] loss: 0.198
[21,    11] loss: 0.215
[21,    12] loss: 0.202
[21,    13] loss: 0.202
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[21,    14] loss: 0.201
[21,    15] loss: 0.196
[21,    16] loss: 0.211
[21,    17] loss: 0.201
[21,    18] loss: 0.199
[21,    19] loss: 0.197
[21,    20] loss: 0.202
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[21,    21] loss: 0.202
[21,    22] loss: 0.206
[21,    23] loss: 0.191
[21,    24] loss: 0.201
[21,    25] loss: 0.196
[22,     1] loss: 0.201
[22,     2] loss: 0.200
[22,     3] loss: 0.203
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[22,     4] loss: 0.195
[22,     5] loss: 0.197
[22,     6] loss: 0.206
[22,     7] loss: 0.198
[22,     8] loss: 0.196
[22,     9] loss: 0.205
[22,    10] loss: 0.192
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[22,    11] loss: 0.187
[22,    12] loss: 0.197
[22,    13] loss: 0.192
[22,    14] loss: 0.199
[22,    15] loss: 0.192
[22,    16] loss: 0.189
[22,    17] loss: 0.200
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[22,    18] loss: 0.188
[22,    19] loss: 0.190
[22,    20] loss: 0.189
[22,    21] loss: 0.198
[22,    22] loss: 0.199
[22,    23] loss: 0.195
[22,    24] loss: 0.192
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[22,    25] loss: 0.193
[23,     1] loss: 0.197
[23,     2] loss: 0.195
[23,     3] loss: 0.190
[23,     4] loss: 0.188
[23,     5] loss: 0.190
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[23,     6] loss: 0.187
[23,     7] loss: 0.193
[23,     8] loss: 0.185
[23,     9] loss: 0.194
[23,    10] loss: 0.181
[23,    11] loss: 0.188
[23,    12] loss: 0.183
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[23,    13] loss: 0.190
[23,    14] loss: 0.188
[23,    15] loss: 0.189
[23,    16] loss: 0.195
[23,    17] loss: 0.180
[23,    18] loss: 0.196
[23,    19] loss: 0.192
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[23,    20] loss: 0.195
[23,    21] loss: 0.184
[23,    22] loss: 0.191
[23,    23] loss: 0.187
[23,    24] loss: 0.188
[23,    25] loss: 0.180
[24,     1] loss: 0.184
[24,     2] loss: 0.185
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[24,     3] loss: 0.191
[24,     4] loss: 0.193
[24,     5] loss: 0.182
[24,     6] loss: 0.185
[24,     7] loss: 0.185
[24,     8] loss: 0.184
[24,     9] loss: 0.186
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[24,    10] loss: 0.178
[24,    11] loss: 0.181
[24,    12] loss: 0.184
[24,    13] loss: 0.185
[24,    14] loss: 0.183
[24,    15] loss: 0.182
[24,    16] loss: 0.175
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[24,    17] loss: 0.181
[24,    18] loss: 0.187
[24,    19] loss: 0.186
[24,    20] loss: 0.176
[24,    21] loss: 0.180
[24,    22] loss: 0.189
[24,    23] loss: 0.182
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[24,    24] loss: 0.172
[24,    25] loss: 0.182
[25,     1] loss: 0.171
[25,     2] loss: 0.184
[25,     3] loss: 0.179
[25,     4] loss: 0.176
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[25,     5] loss: 0.178
[25,     6] loss: 0.181
[25,     7] loss: 0.176
[25,     8] loss: 0.180
[25,     9] loss: 0.184
[25,    10] loss: 0.181
[25,    11] loss: 0.189
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[25,    12] loss: 0.175
[25,    13] loss: 0.172
[25,    14] loss: 0.175
[25,    15] loss: 0.177
[25,    16] loss: 0.174
[25,    17] loss: 0.171
[25,    18] loss: 0.180
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[25,    19] loss: 0.182
[25,    20] loss: 0.169
[25,    21] loss: 0.175
[25,    22] loss: 0.181
[25,    23] loss: 0.177
[25,    24] loss: 0.180
[25,    25] loss: 0.167
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[26,     1] loss: 0.174
[26,     2] loss: 0.169
[26,     3] loss: 0.178
[26,     4] loss: 0.176
[26,     5] loss: 0.174
[26,     6] loss: 0.170
[26,     7] loss: 0.180
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[26,     8] loss: 0.176
[26,     9] loss: 0.170
[26,    10] loss: 0.176
[26,    11] loss: 0.174
[26,    12] loss: 0.177
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[26,    13] loss: 0.172
[26,    14] loss: 0.171
[26,    15] loss: 0.171
[26,    16] loss: 0.169
[26,    17] loss: 0.173
[26,    18] loss: 0.175
[26,    19] loss: 0.169
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[26,    20] loss: 0.173
[26,    21] loss: 0.168
[26,    22] loss: 0.172
[26,    23] loss: 0.164
[26,    24] loss: 0.168
[26,    25] loss: 0.165
[27,     1] loss: 0.167
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[27,     2] loss: 0.166
[27,     3] loss: 0.165
[27,     4] loss: 0.173
[27,     5] loss: 0.165
[27,     6] loss: 0.170
[27,     7] loss: 0.163
[27,     8] loss: 0.167
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[27,     9] loss: 0.166
[27,    10] loss: 0.168
[27,    11] loss: 0.176
[27,    12] loss: 0.161
[27,    13] loss: 0.161
[27,    14] loss: 0.170
[27,    15] loss: 0.159
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[27,    16] loss: 0.166
[27,    17] loss: 0.173
[27,    18] loss: 0.163
[27,    19] loss: 0.169
[27,    20] loss: 0.165
[27,    21] loss: 0.168
[27,    22] loss: 0.175
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[27,    23] loss: 0.176
[27,    24] loss: 0.164
[27,    25] loss: 0.162
[28,     1] loss: 0.168
[28,     2] loss: 0.167
[28,     3] loss: 0.171
[28,     4] loss: 0.171
[28,     5] loss: 0.164
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[28,     6] loss: 0.161
[28,     7] loss: 0.164
[28,     8] loss: 0.166
[28,     9] loss: 0.164
[28,    10] loss: 0.159
[28,    11] loss: 0.163
[28,    12] loss: 0.170
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[28,    13] loss: 0.153
[28,    14] loss: 0.168
[28,    15] loss: 0.164
[28,    16] loss: 0.164
[28,    17] loss: 0.165
[28,    18] loss: 0.162
[28,    19] loss: 0.159
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[28,    20] loss: 0.161
[28,    21] loss: 0.156
[28,    22] loss: 0.155
[28,    23] loss: 0.161
[28,    24] loss: 0.162
[28,    25] loss: 0.147
[29,     1] loss: 0.158
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[29,     2] loss: 0.162
[29,     3] loss: 0.155
[29,     4] loss: 0.161
[29,     5] loss: 0.155
[29,     6] loss: 0.160
[29,     7] loss: 0.166
[29,     8] loss: 0.158
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[29,     9] loss: 0.154
[29,    10] loss: 0.158
[29,    11] loss: 0.174
[29,    12] loss: 0.158
[29,    13] loss: 0.165
[29,    14] loss: 0.162
[29,    15] loss: 0.159
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[29,    16] loss: 0.156
[29,    17] loss: 0.155
[29,    18] loss: 0.149
[29,    19] loss: 0.158
[29,    20] loss: 0.169
[29,    21] loss: 0.151
[29,    22] loss: 0.149
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[29,    23] loss: 0.159
[29,    24] loss: 0.151
[29,    25] loss: 0.157
[30,     1] loss: 0.161
[30,     2] loss: 0.157
[30,     3] loss: 0.147
[30,     4] loss: 0.158
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[30,     5] loss: 0.164
[30,     6] loss: 0.144
[30,     7] loss: 0.155
[30,     8] loss: 0.151
[30,     9] loss: 0.150
[30,    10] loss: 0.160
[30,    11] loss: 0.148
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[30,    12] loss: 0.157
[30,    13] loss: 0.159
[30,    14] loss: 0.163
[30,    15] loss: 0.153
[30,    16] loss: 0.155
[30,    17] loss: 0.155
[30,    18] loss: 0.154
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[30,    19] loss: 0.150
[30,    20] loss: 0.149
[30,    21] loss: 0.149
[30,    22] loss: 0.157
[30,    23] loss: 0.153
[30,    24] loss: 0.152
[30,    25] loss: 0.154
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[31,     1] loss: 0.153
[31,     2] loss: 0.147
[31,     3] loss: 0.150
[31,     4] loss: 0.152
[31,     5] loss: 0.150
[31,     6] loss: 0.155
[31,     7] loss: 0.147
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[31,     8] loss: 0.148
[31,     9] loss: 0.149
[31,    10] loss: 0.149
[31,    11] loss: 0.148
[31,    12] loss: 0.157
[31,    13] loss: 0.148
[31,    14] loss: 0.147
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[31,    15] loss: 0.151
[31,    16] loss: 0.157
[31,    17] loss: 0.153
[31,    18] loss: 0.147
[31,    19] loss: 0.153
[31,    20] loss: 0.146
[31,    21] loss: 0.144
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[31,    22] loss: 0.150
[31,    23] loss: 0.151
[31,    24] loss: 0.155
[31,    25] loss: 0.151
[32,     1] loss: 0.154
[32,     2] loss: 0.148
[32,     3] loss: 0.147
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[32,     4] loss: 0.149
[32,     5] loss: 0.148
[32,     6] loss: 0.148
[32,     7] loss: 0.145
[32,     8] loss: 0.155
[32,     9] loss: 0.151
[32,    10] loss: 0.145
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[32,    11] loss: 0.146
[32,    12] loss: 0.142
[32,    13] loss: 0.142
[32,    14] loss: 0.156
[32,    15] loss: 0.150
[32,    16] loss: 0.141
[32,    17] loss: 0.154
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[32,    18] loss: 0.141
[32,    19] loss: 0.149
[32,    20] loss: 0.148
[32,    21] loss: 0.143
[32,    22] loss: 0.141
[32,    23] loss: 0.140
[32,    24] loss: 0.139
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[32,    25] loss: 0.139
[33,     1] loss: 0.137
[33,     2] loss: 0.145
[33,     3] loss: 0.139
[33,     4] loss: 0.141
[33,     5] loss: 0.151
[33,     6] loss: 0.151
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[33,     7] loss: 0.147
[33,     8] loss: 0.150
[33,     9] loss: 0.142
[33,    10] loss: 0.147
[33,    11] loss: 0.144
[33,    12] loss: 0.141
[33,    13] loss: 0.137
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[33,    14] loss: 0.138
[33,    15] loss: 0.146
[33,    16] loss: 0.141
[33,    17] loss: 0.145
[33,    18] loss: 0.137
[33,    19] loss: 0.132
[33,    20] loss: 0.147
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[33,    21] loss: 0.153
[33,    22] loss: 0.148
[33,    23] loss: 0.141
[33,    24] loss: 0.137
[33,    25] loss: 0.139
[34,     1] loss: 0.140
[34,     2] loss: 0.142
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[34,     3] loss: 0.143
[34,     4] loss: 0.140
[34,     5] loss: 0.136
[34,     6] loss: 0.141
[34,     7] loss: 0.141
[34,     8] loss: 0.136
[34,     9] loss: 0.141
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[34,    10] loss: 0.144
[34,    11] loss: 0.146
[34,    12] loss: 0.134
[34,    13] loss: 0.134
[34,    14] loss: 0.135
[34,    15] loss: 0.138
[34,    16] loss: 0.134
[34,    17] loss: 0.144
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[34,    18] loss: 0.140
[34,    19] loss: 0.149
[34,    20] loss: 0.140
[34,    21] loss: 0.139
[34,    22] loss: 0.141
[34,    23] loss: 0.139
[34,    24] loss: 0.138
[34,    25] loss: 0.141
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[35,     1] loss: 0.136
[35,     2] loss: 0.135
[35,     3] loss: 0.139
[35,     4] loss: 0.136
[35,     5] loss: 0.137
[35,     6] loss: 0.143
[35,     7] loss: 0.135
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[35,     8] loss: 0.137
[35,     9] loss: 0.135
[35,    10] loss: 0.140
[35,    11] loss: 0.140
[35,    12] loss: 0.139
[35,    13] loss: 0.132
[35,    14] loss: 0.139
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[35,    15] loss: 0.140
[35,    16] loss: 0.134
[35,    17] loss: 0.131
[35,    18] loss: 0.138
[35,    19] loss: 0.131
[35,    20] loss: 0.136
[35,    21] loss: 0.131
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[35,    22] loss: 0.131
[35,    23] loss: 0.133
[35,    24] loss: 0.140
[35,    25] loss: 0.151
[36,     1] loss: 0.127
[36,     2] loss: 0.134
[36,     3] loss: 0.138
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[36,     4] loss: 0.139
[36,     5] loss: 0.132
[36,     6] loss: 0.129
[36,     7] loss: 0.131
[36,     8] loss: 0.131
[36,     9] loss: 0.133
[36,    10] loss: 0.127
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[36,    11] loss: 0.128
[36,    12] loss: 0.139
[36,    13] loss: 0.131
[36,    14] loss: 0.134
[36,    15] loss: 0.133
[36,    16] loss: 0.141
[36,    17] loss: 0.134
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[36,    18] loss: 0.139
[36,    19] loss: 0.135
[36,    20] loss: 0.130
[36,    21] loss: 0.132
[36,    22] loss: 0.137
[36,    23] loss: 0.129
[36,    24] loss: 0.140
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[36,    25] loss: 0.136
[37,     1] loss: 0.133
[37,     2] loss: 0.133
[37,     3] loss: 0.138
[37,     4] loss: 0.133
[37,     5] loss: 0.128
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[37,     6] loss: 0.128
[37,     7] loss: 0.124
[37,     8] loss: 0.134
[37,     9] loss: 0.131
[37,    10] loss: 0.132
[37,    11] loss: 0.132
[37,    12] loss: 0.139
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[37,    13] loss: 0.133
[37,    14] loss: 0.130
[37,    15] loss: 0.125
[37,    16] loss: 0.135
[37,    17] loss: 0.124
[37,    18] loss: 0.135
[37,    19] loss: 0.130
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[37,    20] loss: 0.129
[37,    21] loss: 0.129
[37,    22] loss: 0.128
[37,    23] loss: 0.127
[37,    24] loss: 0.131
[37,    25] loss: 0.128
[38,     1] loss: 0.129
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[38,     2] loss: 0.134
[38,     3] loss: 0.125
[38,     4] loss: 0.133
[38,     5] loss: 0.130
[38,     6] loss: 0.119
[38,     7] loss: 0.127
[38,     8] loss: 0.126
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[38,     9] loss: 0.128
[38,    10] loss: 0.129
[38,    11] loss: 0.123
[38,    12] loss: 0.128
[38,    13] loss: 0.126
[38,    14] loss: 0.129
[38,    15] loss: 0.127
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[38,    16] loss: 0.135
[38,    17] loss: 0.125
[38,    18] loss: 0.123
[38,    19] loss: 0.131
[38,    20] loss: 0.133
[38,    21] loss: 0.128
[38,    22] loss: 0.128
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[38,    23] loss: 0.135
[38,    24] loss: 0.126
[38,    25] loss: 0.124
[39,     1] loss: 0.119
[39,     2] loss: 0.122
[39,     3] loss: 0.124
[39,     4] loss: 0.123
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[39,     5] loss: 0.126
[39,     6] loss: 0.124
[39,     7] loss: 0.123
[39,     8] loss: 0.121
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[39,     9] loss: 0.138
[39,    10] loss: 0.126
[39,    11] loss: 0.133
[39,    12] loss: 0.129
[39,    13] loss: 0.132
[39,    14] loss: 0.124
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[39,    15] loss: 0.122
[39,    16] loss: 0.132
[39,    17] loss: 0.129
[39,    18] loss: 0.128
[39,    19] loss: 0.125
[39,    20] loss: 0.116
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[39,    21] loss: 0.118
[39,    22] loss: 0.130
[39,    23] loss: 0.121
[39,    24] loss: 0.125
[39,    25] loss: 0.126
[40,     1] loss: 0.124
[40,     2] loss: 0.131
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[40,     3] loss: 0.127
[40,     4] loss: 0.121
[40,     5] loss: 0.133
[40,     6] loss: 0.126
[40,     7] loss: 0.122
[40,     8] loss: 0.134
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[40,     9] loss: 0.118
[40,    10] loss: 0.126
[40,    11] loss: 0.122
[40,    12] loss: 0.116
[40,    13] loss: 0.123
[40,    14] loss: 0.125
[40,    15] loss: 0.127
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[40,    16] loss: 0.114
[40,    17] loss: 0.120
[40,    18] loss: 0.119
[40,    19] loss: 0.128
[40,    20] loss: 0.109
[40,    21] loss: 0.123
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[40,    22] loss: 0.122
[40,    23] loss: 0.121
[40,    24] loss: 0.119
[40,    25] loss: 0.123
[41,     1] loss: 0.118
[41,     2] loss: 0.118
[41,     3] loss: 0.121
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[41,     4] loss: 0.117
[41,     5] loss: 0.120
[41,     6] loss: 0.125
[41,     7] loss: 0.124
[41,     8] loss: 0.119
[41,     9] loss: 0.129
[41,    10] loss: 0.122
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[41,    11] loss: 0.122
[41,    12] loss: 0.120
[41,    13] loss: 0.115
[41,    14] loss: 0.124
[41,    15] loss: 0.120
[41,    16] loss: 0.121
[41,    17] loss: 0.121
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[41,    18] loss: 0.118
[41,    19] loss: 0.121
[41,    20] loss: 0.118
[41,    21] loss: 0.114
[41,    22] loss: 0.126
[41,    23] loss: 0.122
[41,    24] loss: 0.122
[41,    25] loss: 0.115
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[42,     1] loss: 0.118
[42,     2] loss: 0.119
[42,     3] loss: 0.124
[42,     4] loss: 0.121
[42,     5] loss: 0.114
[42,     6] loss: 0.129
[42,     7] loss: 0.117
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[42,     8] loss: 0.119
[42,     9] loss: 0.124
[42,    10] loss: 0.114
[42,    11] loss: 0.117
[42,    12] loss: 0.112
[42,    13] loss: 0.118
[42,    14] loss: 0.117
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[42,    15] loss: 0.114
[42,    16] loss: 0.123
[42,    17] loss: 0.113
[42,    18] loss: 0.120
[42,    19] loss: 0.120
[42,    20] loss: 0.121
[42,    21] loss: 0.114
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[42,    22] loss: 0.117
[42,    23] loss: 0.114
[42,    24] loss: 0.123
[42,    25] loss: 0.113
[43,     1] loss: 0.112
[43,     2] loss: 0.120
[43,     3] loss: 0.126
[43,     4] loss: 0.117
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[43,     5] loss: 0.114
[43,     6] loss: 0.113
[43,     7] loss: 0.112
[43,     8] loss: 0.115
[43,     9] loss: 0.131
[43,    10] loss: 0.110
[43,    11] loss: 0.117
[43,    12] loss: 0.120
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[43,    13] loss: 0.120
[43,    14] loss: 0.116
[43,    15] loss: 0.111
[43,    16] loss: 0.119
[43,    17] loss: 0.117
[43,    18] loss: 0.117
[43,    19] loss: 0.114
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[43,    20] loss: 0.113
[43,    21] loss: 0.118
[43,    22] loss: 0.112
[43,    23] loss: 0.117
[43,    24] loss: 0.117
[43,    25] loss: 0.101
[44,     1] loss: 0.112
[44,     2] loss: 0.109
[44,     3] loss: 0.116
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[44,     4] loss: 0.110
[44,     5] loss: 0.106
[44,     6] loss: 0.122
[44,     7] loss: 0.118
[44,     8] loss: 0.113
[44,     9] loss: 0.122
[44,    10] loss: 0.112
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[44,    11] loss: 0.113
[44,    12] loss: 0.117
[44,    13] loss: 0.114
[44,    14] loss: 0.112
[44,    15] loss: 0.114
[44,    16] loss: 0.109
[44,    17] loss: 0.117
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[44,    18] loss: 0.114
[44,    19] loss: 0.115
[44,    20] loss: 0.113
[44,    21] loss: 0.113
[44,    22] loss: 0.115
[44,    23] loss: 0.115
[44,    24] loss: 0.112
[44,    25] loss: 0.118
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[45,     1] loss: 0.113
[45,     2] loss: 0.110
[45,     3] loss: 0.113
[45,     4] loss: 0.115
[45,     5] loss: 0.112
[45,     6] loss: 0.113
[45,     7] loss: 0.111
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[45,     8] loss: 0.106
[45,     9] loss: 0.114
[45,    10] loss: 0.109
[45,    11] loss: 0.112
[45,    12] loss: 0.112
[45,    13] loss: 0.112
[45,    14] loss: 0.117
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[45,    15] loss: 0.111
[45,    16] loss: 0.117
[45,    17] loss: 0.112
[45,    18] loss: 0.112
[45,    19] loss: 0.110
[45,    20] loss: 0.114
[45,    21] loss: 0.111
[45,    22] loss: 0.114
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[45,    23] loss: 0.114
[45,    24] loss: 0.109
[45,    25] loss: 0.106
[46,     1] loss: 0.118
[46,     2] loss: 0.110
[46,     3] loss: 0.113
[46,     4] loss: 0.112
[46,     5] loss: 0.115
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[46,     6] loss: 0.107
[46,     7] loss: 0.108
[46,     8] loss: 0.113
[46,     9] loss: 0.107
[46,    10] loss: 0.114
[46,    11] loss: 0.102
[46,    12] loss: 0.105
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[46,    13] loss: 0.111
[46,    14] loss: 0.103
[46,    15] loss: 0.108
[46,    16] loss: 0.124
[46,    17] loss: 0.105
[46,    18] loss: 0.102
[46,    19] loss: 0.119
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[46,    20] loss: 0.110
[46,    21] loss: 0.108
[46,    22] loss: 0.100
[46,    23] loss: 0.110
[46,    24] loss: 0.116
[46,    25] loss: 0.113
[47,     1] loss: 0.105
[47,     2] loss: 0.102
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[47,     3] loss: 0.107
[47,     4] loss: 0.104
[47,     5] loss: 0.112
[47,     6] loss: 0.106
[47,     7] loss: 0.108
[47,     8] loss: 0.116
[47,     9] loss: 0.114
[47,    10] loss: 0.107
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[47,    11] loss: 0.112
[47,    12] loss: 0.104
[47,    13] loss: 0.111
[47,    14] loss: 0.100
[47,    15] loss: 0.115
[47,    16] loss: 0.114
[47,    17] loss: 0.112
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[47,    18] loss: 0.105
[47,    19] loss: 0.111
[47,    20] loss: 0.109
[47,    21] loss: 0.109
[47,    22] loss: 0.103
[47,    23] loss: 0.108
[47,    24] loss: 0.107
[47,    25] loss: 0.106
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[48,     1] loss: 0.110
[48,     2] loss: 0.105
[48,     3] loss: 0.109
[48,     4] loss: 0.108
[48,     5] loss: 0.099
[48,     6] loss: 0.103
[48,     7] loss: 0.103
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[48,     8] loss: 0.107
[48,     9] loss: 0.102
[48,    10] loss: 0.111
[48,    11] loss: 0.106
[48,    12] loss: 0.107
[48,    13] loss: 0.109
[48,    14] loss: 0.112
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[48,    15] loss: 0.105
[48,    16] loss: 0.108
[48,    17] loss: 0.105
[48,    18] loss: 0.116
[48,    19] loss: 0.112
[48,    20] loss: 0.112
[48,    21] loss: 0.100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[48,    22] loss: 0.105
[48,    23] loss: 0.105
[48,    24] loss: 0.100
[48,    25] loss: 0.102
[49,     1] loss: 0.113
[49,     2] loss: 0.116
[49,     3] loss: 0.104
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[49,     4] loss: 0.104
[49,     5] loss: 0.098
[49,     6] loss: 0.099
[49,     7] loss: 0.107
[49,     8] loss: 0.103
[49,     9] loss: 0.105
[49,    10] loss: 0.103
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[49,    11] loss: 0.099
[49,    12] loss: 0.109
[49,    13] loss: 0.104
[49,    14] loss: 0.102
[49,    15] loss: 0.102
[49,    16] loss: 0.101
[49,    17] loss: 0.110
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[49,    18] loss: 0.100
[49,    19] loss: 0.103
[49,    20] loss: 0.101
[49,    21] loss: 0.105
[49,    22] loss: 0.103
[49,    23] loss: 0.112
[49,    24] loss: 0.109
[49,    25] loss: 0.104
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[50,     1] loss: 0.101
[50,     2] loss: 0.111
[50,     3] loss: 0.102
[50,     4] loss: 0.100
[50,     5] loss: 0.108
[50,     6] loss: 0.103
[50,     7] loss: 0.110
[50,     8] loss: 0.105
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[50,     9] loss: 0.107
[50,    10] loss: 0.101
[50,    11] loss: 0.103
[50,    12] loss: 0.098
[50,    13] loss: 0.100
[50,    14] loss: 0.105
[50,    15] loss: 0.106
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[50,    16] loss: 0.096
[50,    17] loss: 0.104
[50,    18] loss: 0.101
[50,    19] loss: 0.107
[50,    20] loss: 0.100
[50,    21] loss: 0.100
[50,    22] loss: 0.096
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[50,    23] loss: 0.107
[50,    24] loss: 0.095
[50,    25] loss: 0.109
[51,     1] loss: 0.098
[51,     2] loss: 0.096
[51,     3] loss: 0.108
[51,     4] loss: 0.105
[51,     5] loss: 0.102
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[51,     6] loss: 0.098
[51,     7] loss: 0.100
[51,     8] loss: 0.103
[51,     9] loss: 0.098
[51,    10] loss: 0.099
[51,    11] loss: 0.098
[51,    12] loss: 0.105
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[51,    13] loss: 0.103
[51,    14] loss: 0.104
[51,    15] loss: 0.100
[51,    16] loss: 0.099
[51,    17] loss: 0.103
[51,    18] loss: 0.102
[51,    19] loss: 0.101
[51,    20] loss: 0.106
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[51,    21] loss: 0.102
[51,    22] loss: 0.103
[51,    23] loss: 0.104
[51,    24] loss: 0.100
[51,    25] loss: 0.101
[52,     1] loss: 0.100
[52,     2] loss: 0.104
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[52,     3] loss: 0.103
[52,     4] loss: 0.098
[52,     5] loss: 0.097
[52,     6] loss: 0.099
[52,     7] loss: 0.097
[52,     8] loss: 0.101
[52,     9] loss: 0.095
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[52,    10] loss: 0.096
[52,    11] loss: 0.102
[52,    12] loss: 0.110
[52,    13] loss: 0.100
[52,    14] loss: 0.095
[52,    15] loss: 0.104
[52,    16] loss: 0.106
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[52,    17] loss: 0.097
[52,    18] loss: 0.091
[52,    19] loss: 0.098
[52,    20] loss: 0.098
[52,    21] loss: 0.095
[52,    22] loss: 0.090
[52,    23] loss: 0.111
[52,    24] loss: 0.108
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[52,    25] loss: 0.101
[53,     1] loss: 0.097
[53,     2] loss: 0.095
[53,     3] loss: 0.104
[53,     4] loss: 0.105
[53,     5] loss: 0.095
[53,     6] loss: 0.094
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[53,     7] loss: 0.097
[53,     8] loss: 0.105
[53,     9] loss: 0.100
[53,    10] loss: 0.101
[53,    11] loss: 0.101
[53,    12] loss: 0.102
[53,    13] loss: 0.104
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[53,    14] loss: 0.098
[53,    15] loss: 0.093
[53,    16] loss: 0.102
[53,    17] loss: 0.100
[53,    18] loss: 0.096
[53,    19] loss: 0.089
[53,    20] loss: 0.095
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[53,    21] loss: 0.099
[53,    22] loss: 0.096
[53,    23] loss: 0.093
[53,    24] loss: 0.094
[53,    25] loss: 0.104
[54,     1] loss: 0.102
[54,     2] loss: 0.098
[54,     3] loss: 0.091
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[54,     4] loss: 0.102
[54,     5] loss: 0.097
[54,     6] loss: 0.093
[54,     7] loss: 0.104
[54,     8] loss: 0.097
[54,     9] loss: 0.095
[54,    10] loss: 0.092
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[54,    11] loss: 0.094
[54,    12] loss: 0.102
[54,    13] loss: 0.111
[54,    14] loss: 0.091
[54,    15] loss: 0.101
[54,    16] loss: 0.088
[54,    17] loss: 0.090
[54,    18] loss: 0.094
[54,    19] loss: 0.090
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[54,    20] loss: 0.098
[54,    21] loss: 0.091
[54,    22] loss: 0.096
[54,    23] loss: 0.102
[54,    24] loss: 0.095
[54,    25] loss: 0.111
[55,     1] loss: 0.098
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[55,     2] loss: 0.091
[55,     3] loss: 0.102
[55,     4] loss: 0.087
[55,     5] loss: 0.100
[55,     6] loss: 0.099
[55,     7] loss: 0.097
[55,     8] loss: 0.100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[55,     9] loss: 0.097
[55,    10] loss: 0.096
[55,    11] loss: 0.107
[55,    12] loss: 0.085
[55,    13] loss: 0.092
[55,    14] loss: 0.089
[55,    15] loss: 0.098
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[55,    16] loss: 0.094
[55,    17] loss: 0.091
[55,    18] loss: 0.092
[55,    19] loss: 0.102
[55,    20] loss: 0.096
[55,    21] loss: 0.089
[55,    22] loss: 0.098
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[55,    23] loss: 0.099
[55,    24] loss: 0.096
[55,    25] loss: 0.093
[56,     1] loss: 0.090
[56,     2] loss: 0.095
[56,     3] loss: 0.091
[56,     4] loss: 0.091
[56,     5] loss: 0.096
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[56,     6] loss: 0.095
[56,     7] loss: 0.090
[56,     8] loss: 0.094
[56,     9] loss: 0.093
[56,    10] loss: 0.090
[56,    11] loss: 0.102
[56,    12] loss: 0.093
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[56,    13] loss: 0.096
[56,    14] loss: 0.101
[56,    15] loss: 0.090
[56,    16] loss: 0.092
[56,    17] loss: 0.098
[56,    18] loss: 0.099
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[56,    19] loss: 0.093
[56,    20] loss: 0.104
[56,    21] loss: 0.094
[56,    22] loss: 0.094
[56,    23] loss: 0.087
[56,    24] loss: 0.097
[56,    25] loss: 0.095
[57,     1] loss: 0.100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[57,     2] loss: 0.085
[57,     3] loss: 0.093
[57,     4] loss: 0.089
[57,     5] loss: 0.090
[57,     6] loss: 0.088
[57,     7] loss: 0.099
[57,     8] loss: 0.095
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[57,     9] loss: 0.095
[57,    10] loss: 0.085
[57,    11] loss: 0.098
[57,    12] loss: 0.098
[57,    13] loss: 0.101
[57,    14] loss: 0.094
[57,    15] loss: 0.095
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[57,    16] loss: 0.093
[57,    17] loss: 0.090
[57,    18] loss: 0.087
[57,    19] loss: 0.092
[57,    20] loss: 0.089
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[57,    21] loss: 0.095
[57,    22] loss: 0.090
[57,    23] loss: 0.088
[57,    24] loss: 0.097
[57,    25] loss: 0.098
[58,     1] loss: 0.092
[58,     2] loss: 0.098
[58,     3] loss: 0.090
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[58,     4] loss: 0.096
[58,     5] loss: 0.094
[58,     6] loss: 0.093
[58,     7] loss: 0.090
[58,     8] loss: 0.092
[58,     9] loss: 0.085
[58,    10] loss: 0.090
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[58,    11] loss: 0.096
[58,    12] loss: 0.097
[58,    13] loss: 0.085
[58,    14] loss: 0.091
[58,    15] loss: 0.093
[58,    16] loss: 0.085
[58,    17] loss: 0.082
[58,    18] loss: 0.093
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[58,    19] loss: 0.097
[58,    20] loss: 0.096
[58,    21] loss: 0.095
[58,    22] loss: 0.093
[58,    23] loss: 0.088
[58,    24] loss: 0.085
[58,    25] loss: 0.096
[59,     1] loss: 0.098
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[59,     2] loss: 0.092
[59,     3] loss: 0.096
[59,     4] loss: 0.080
[59,     5] loss: 0.094
[59,     6] loss: 0.085
[59,     7] loss: 0.091
[59,     8] loss: 0.092
[59,     9] loss: 0.097
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[59,    10] loss: 0.079
[59,    11] loss: 0.095
[59,    12] loss: 0.093
[59,    13] loss: 0.088
[59,    14] loss: 0.086
[59,    15] loss: 0.099
[59,    16] loss: 0.093
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[59,    17] loss: 0.094
[59,    18] loss: 0.086
[59,    19] loss: 0.081
[59,    20] loss: 0.085
[59,    21] loss: 0.092
[59,    22] loss: 0.086
[59,    23] loss: 0.090
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[59,    24] loss: 0.096
[59,    25] loss: 0.092
[60,     1] loss: 0.087
[60,     2] loss: 0.093
[60,     3] loss: 0.094
[60,     4] loss: 0.092
[60,     5] loss: 0.095
[60,     6] loss: 0.086
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[60,     7] loss: 0.097
[60,     8] loss: 0.090
[60,     9] loss: 0.088
[60,    10] loss: 0.088
[60,    11] loss: 0.094
[60,    12] loss: 0.093
[60,    13] loss: 0.090
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[60,    14] loss: 0.081
[60,    15] loss: 0.084
[60,    16] loss: 0.089
[60,    17] loss: 0.090
[60,    18] loss: 0.094
[60,    19] loss: 0.087
[60,    20] loss: 0.087
[60,    21] loss: 0.089
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[60,    22] loss: 0.082
[60,    23] loss: 0.088
[60,    24] loss: 0.088
[60,    25] loss: 0.085
************* Training done! *************
</pre></div>
</div>
<img alt="../_images/4_adversarial_73_213.png" src="../_images/4_adversarial_73_213.png" />
</div>
</div>
</div>
<div class="section" id="test-des-performances">
<h3>Test des performances<a class="headerlink" href="#test-des-performances" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>  <span class="c1"># on passe le modele en mode evaluation</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">test_loader</span><span class="p">:</span>
            <span class="n">images</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">data</span>
            <span class="c1">#images = images.cuda()</span>
            <span class="c1">#labels = labels.cuda()</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
            <span class="n">predicted</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">squeeze</span><span class="p">((</span><span class="n">outputs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>
        
            <span class="n">total</span> <span class="o">+=</span> <span class="n">labels</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">correct</span> <span class="o">+=</span> <span class="p">(</span><span class="n">predicted</span> <span class="o">==</span> <span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            
    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>  <span class="c1"># on remet le modele en mode apprentissage</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy du modele sur le jeu de test: </span><span class="si">%d</span><span class="s1"> </span><span class="si">%%</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">total</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy du modele sur le jeu de test: 99 %
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="construction-d-une-attaque-adversaire-dans-le-cas-du-modele-lineaire">
<h3>Construction dâ€™une attaque adversaire dans le cas du modÃ¨le linÃ©aire<a class="headerlink" href="#construction-d-une-attaque-adversaire-dans-le-cas-du-modele-lineaire" title="Permalink to this headline">Â¶</a></h3>
<p>En reprenant le problÃ¨me de lâ€™apprentissage robuste aux attaques adversaires tel que dÃ©fini ci-dessus, notre loss nâ€™est plus directement <span class="math notranslate nohighlight">\(\ell\)</span>. En effet, comme indiquÃ©, nous devons non pas Ã©valuer <span class="math notranslate nohighlight">\(\ell\)</span> en <span class="math notranslate nohighlight">\(x\)</span> mais dans un voisinage de <span class="math notranslate nohighlight">\(x\)</span> tel que le score de notre modÃ¨le y est le plus mauvais possible. La <em>loss</em> dans le pire des cas est dÃ©crite par lâ€™Ã©quation suivante :</p>
<div class="math notranslate nohighlight">
\[\text{max}_{\delta\in\mathcal{B}_\epsilon}\ell(y\langle\omega, x+\delta\rangle)=\text{max}_{\delta\in\mathcal{B}_\epsilon}\text{log}(1+e^{-y\langle\omega, x+\delta\rangle}).\]</div>
<p>Avant dâ€™aller plus loin, observons notre fonction de perte logistique.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">z</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;La fonction de perte logistique&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4_adversarial_79_0.png" src="../_images/4_adversarial_79_0.png" />
</div>
</div>
<p>Celle-ci semble monotone et dÃ©croissante (et convexe). Pour nous en convaincre, calculons la dÃ©rivÃ©e :</p>
<div class="math notranslate nohighlight">
\[\ell^\prime(z)=-\frac{1}{e^z+1}&lt;0,\]</div>
<p>qui est bien toujours nÃ©gative confirmant Ã  la fois la monotonie et la dÃ©croissance. Pour le fun, constatons que notre fonction est bien Ã©galement convexe :</p>
<div class="math notranslate nohighlight">
\[\ell^{\prime\prime}(z)=\frac{e^z}{(e^z+1)^2}&gt;0.\]</div>
<p>La fonction de perte logistique est donc mÃªme strictement convexe.</p>
<hr class="docutils" />
<p>En constatant ainsi que la fonction de perte logistique est monotone ET dÃ©croissante et en exploitant la linÃ©aritÃ© du produit scalaire, on obtient donc :</p>
<div class="math notranslate nohighlight">
\[\text{max}_{\delta\in\mathcal{B}_\epsilon}\ell(y\langle\omega, x+\delta\rangle)=\ell(\text{min}y\langle\omega, x+\delta\rangle)=\ell(y\langle\omega, x\rangle+\text{min}y\langle \omega, \delta\rangle).\]</div>
<p>Il nous reste donc Ã  chercher la solution du problÃ¨me de minimisation <span class="math notranslate nohighlight">\(\text{min}_{\delta\in\mathcal{B}_\epsilon}y\langle \omega, \delta\rangle\)</span>
qui, heureusement pour nous, est convexe avec un domaine de dÃ©finition compact. Il y a donc un minimum local qui est le minimum global. La norme <span class="math notranslate nohighlight">\(\ell_\infty\)</span> nous permet de considÃ©rer chaque dimension sÃ©parÃ©ment (le problÃ¨me est sÃ©parable). Nous voulons donc calculer :</p>
<div class="math notranslate nohighlight">
\[\text{min}_{|\delta_j|\leq \epsilon}y\langle \omega_j, \delta_j\rangle.\]</div>
<p>Si <span class="math notranslate nohighlight">\(\omega_j=0\)</span>, toutes les solutions se valent. Si <span class="math notranslate nohighlight">\(\omega_j\neq 0\)</span> et <span class="math notranslate nohighlight">\(y=-1\)</span>, alors le minimum est atteint lorsque <span class="math notranslate nohighlight">\(\delta_j=\epsilon\cdot\text{sign}(\omega_j)\)</span>. Enfin, si <span class="math notranslate nohighlight">\(y=1\)</span>, alors le minimum est atteint lorsque <span class="math notranslate nohighlight">\(\delta_j=-\epsilon\cdot\text{sign}(\omega_j)\)</span>. De maniÃ¨re gÃ©nÃ©rale, nous avons :</p>
<div class="math notranslate nohighlight">
\[\delta^\star=-y \epsilon\cdot\text{sign}(\omega)\]</div>
<p>Nous avons ainsi :</p>
<div class="math notranslate nohighlight">
\[\text{min}_{\delta\in\mathcal{B}_\epsilon}y\langle \omega, \delta\rangle=y\langle\omega, -y \epsilon\cdot\text{sign}(\omega)\rangle=-y^2\epsilon\langle \omega, \text{sign}(\omega)\rangle=-\epsilon\lVert\omega\rVert_1.\]</div>
<p>Un apprentissage robuste aux attaques adversaires minimise donc la loss :</p>
<div class="math notranslate nohighlight">
\[\text{max}_{\delta\in\mathcal{B}_\epsilon}\text{log}(1+e^{-y\langle\omega, x\rangle+\epsilon\lVert\omega\rVert_1})=\ell(y\langle\omega, x\rangle-\epsilon\lVert\omega\rVert_1)\]</div>
<p>On retombe quasiment sur un problÃ¨me dâ€™optimisation avec une pÃ©nalitÃ© <span class="math notranslate nohighlight">\(\ell_1\)</span>. On cherche le vecteur <span class="math notranslate nohighlight">\(\omega\)</span> qui maximise les bonnes prÃ©dictions mais qui en mÃªme temps possÃ¨de une norme <span class="math notranslate nohighlight">\(\ell_1\)</span> faible.</p>
<hr class="docutils" />
<p><span style="color:blue"><strong>Exercice :</strong></span> En vous appuyant sur les â€œrÃ©sultats thÃ©oriquesâ€ prÃ©cÃ©dent, proposez un code permettant de gÃ©nÃ©rer un bruit adversaire.</p>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_adversarial_noise</span><span class="p">(</span><span class="n">image_and_label</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="n">imagesize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">image_and_label</span>
    <span class="n">label</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">label</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="n">label</span>
    <span class="c1">############### COMPLETE HERE ###############</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">imagesize</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span> <span class="o">*</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">label</span>
    <span class="c1">#############################################</span>
    
    <span class="k">return</span> <span class="n">noise</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_images_and_noise</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">noise</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">18</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Notre image $x$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">detach</span><span class="p">())</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Notre image transformÃ©e $x + \delta^\star$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">squeeze</span><span class="p">((</span><span class="n">image</span><span class="o">+</span><span class="n">noise</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">())</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Notre bruit $\delta^\star$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">noise</span><span class="o">.</span><span class="n">detach</span><span class="p">()))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">images</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">generate_adversarial_noise</span><span class="p">((</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_images_and_noise</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">noise</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4_adversarial_88_0.png" src="../_images/4_adversarial_88_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prediction</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PrÃ©diction:&#39;</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">noise</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PrÃ©diction avec du bruit:&#39;</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PrÃ©diction: 0
PrÃ©diction avec du bruit: 1
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="apprentissage-robuste-aux-attaques-adversaires">
<h3>Apprentissage robuste aux attaques adversaires<a class="headerlink" href="#apprentissage-robuste-aux-attaques-adversaires" title="Permalink to this headline">Â¶</a></h3>
<p>Un apprentissage robuste aux exemples adversaires cherche tout simplement Ã  minimiser le pire des scÃ©narios :</p>
<div class="math notranslate nohighlight">
\[\omega^\star=\text{argmin}_{\omega\in\mathbb{R}^d}\frac{1}{n}\sum_i\text{max}_{\delta\in\mathcal{B}_\epsilon}\ell(y_i\langle\omega, x_i +\delta\rangle)=\text{argmin}_{\omega\in\mathbb{R}^d}\frac{1}{n}\sum_i\ell(y_i\langle\omega, x_i\rangle-\epsilon\lVert\omega\rVert_1).\]</div>
<hr class="docutils" />
<p><span style="color:blue"><strong>Exercice :</strong></span> En vous appuyant sur les â€œrÃ©sultats thÃ©oriquesâ€ prÃ©cÃ©dent, proposez un code permettant de construire une loss robuste aux attaques adversaires.</p>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RobustLogisticLoss</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RobustLogisticLoss</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="c1"># we flatten the image into a vector</span>
        <span class="n">y_hat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">y_hat</span><span class="p">)</span>
        <span class="n">batch_size</span> <span class="o">=</span> <span class="n">y_hat</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span><span class="p">[</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c1">############### COMPLETE HERE ###############</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">y_hat</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
        <span class="c1">#############################################</span>
        
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">z</span><span class="p">)))</span> <span class="o">/</span> <span class="n">batch_size</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">train_and_plot</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">logs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="n">RobustLogisticLoss</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">weight</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1,     1] loss: 10.366
[1,     2] loss: 10.350
[1,     3] loss: 10.335
[1,     4] loss: 10.339
[1,     5] loss: 10.321
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1,     6] loss: 10.297
[1,     7] loss: 10.288
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1,     8] loss: 10.274
[1,     9] loss: 10.269
[1,    10] loss: 10.262
[1,    11] loss: 10.236
[1,    12] loss: 10.224
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1,    13] loss: 10.214
[1,    14] loss: 10.199
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1,    15] loss: 10.176
[1,    16] loss: 10.168
[1,    17] loss: 10.153
[1,    18] loss: 10.159
[1,    19] loss: 10.128
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1,    20] loss: 10.102
[1,    21] loss: 10.105
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1,    22] loss: 10.099
[1,    23] loss: 10.088
[1,    24] loss: 10.040
[1,    25] loss: 10.058
[2,     1] loss: 10.057
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2,     2] loss: 10.023
[2,     3] loss: 10.004
[2,     4] loss: 10.000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2,     5] loss: 10.010
[2,     6] loss: 9.966
[2,     7] loss: 9.954
[2,     8] loss: 9.956
[2,     9] loss: 9.907
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2,    10] loss: 9.928
[2,    11] loss: 9.892
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2,    12] loss: 9.895
[2,    13] loss: 9.893
[2,    14] loss: 9.852
[2,    15] loss: 9.848
[2,    16] loss: 9.837
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2,    17] loss: 9.828
[2,    18] loss: 9.781
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2,    19] loss: 9.793
[2,    20] loss: 9.821
[2,    21] loss: 9.788
[2,    22] loss: 9.776
[2,    23] loss: 9.745
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2,    24] loss: 9.760
[2,    25] loss: 9.697
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3,     1] loss: 9.699
[3,     2] loss: 9.668
[3,     3] loss: 9.672
[3,     4] loss: 9.640
[3,     5] loss: 9.648
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3,     6] loss: 9.641
[3,     7] loss: 9.593
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3,     8] loss: 9.690
[3,     9] loss: 9.589
[3,    10] loss: 9.614
[3,    11] loss: 9.549
[3,    12] loss: 9.586
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3,    13] loss: 9.522
[3,    14] loss: 9.567
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3,    15] loss: 9.568
[3,    16] loss: 9.534
[3,    17] loss: 9.481
[3,    18] loss: 9.505
[3,    19] loss: 9.498
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3,    20] loss: 9.424
[3,    21] loss: 9.481
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3,    22] loss: 9.412
[3,    23] loss: 9.355
[3,    24] loss: 9.447
[3,    25] loss: 9.411
[4,     1] loss: 9.357
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[4,     2] loss: 9.293
[4,     3] loss: 9.315
[4,     4] loss: 9.361
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[4,     5] loss: 9.336
[4,     6] loss: 9.336
[4,     7] loss: 9.363
[4,     8] loss: 9.233
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[4,     9] loss: 9.319
[4,    10] loss: 9.271
[4,    11] loss: 9.288
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[4,    12] loss: 9.260
[4,    13] loss: 9.232
[4,    14] loss: 9.141
[4,    15] loss: 9.235
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[4,    16] loss: 9.193
[4,    17] loss: 9.134
[4,    18] loss: 9.145
[4,    19] loss: 9.141
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[4,    20] loss: 9.124
[4,    21] loss: 9.113
[4,    22] loss: 9.100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[4,    23] loss: 9.133
[4,    24] loss: 9.084
[4,    25] loss: 9.054
[5,     1] loss: 9.101
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[5,     2] loss: 8.993
[5,     3] loss: 9.006
[5,     4] loss: 8.958
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[5,     5] loss: 8.916
[5,     6] loss: 8.941
[5,     7] loss: 8.971
[5,     8] loss: 8.973
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[5,     9] loss: 8.920
[5,    10] loss: 8.961
[5,    11] loss: 8.948
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[5,    12] loss: 8.948
[5,    13] loss: 8.915
[5,    14] loss: 8.881
[5,    15] loss: 8.987
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[5,    16] loss: 8.859
[5,    17] loss: 8.866
[5,    18] loss: 8.827
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[5,    19] loss: 8.799
[5,    20] loss: 8.839
[5,    21] loss: 8.859
[5,    22] loss: 8.710
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[5,    23] loss: 8.752
[5,    24] loss: 8.704
[5,    25] loss: 8.700
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[6,     1] loss: 8.737
[6,     2] loss: 8.770
[6,     3] loss: 8.696
[6,     4] loss: 8.638
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[6,     5] loss: 8.713
[6,     6] loss: 8.624
[6,     7] loss: 8.626
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[6,     8] loss: 8.558
[6,     9] loss: 8.721
[6,    10] loss: 8.607
[6,    11] loss: 8.582
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[6,    12] loss: 8.481
[6,    13] loss: 8.511
[6,    14] loss: 8.539
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[6,    15] loss: 8.509
[6,    16] loss: 8.539
[6,    17] loss: 8.507
[6,    18] loss: 8.527
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[6,    19] loss: 8.604
[6,    20] loss: 8.375
[6,    21] loss: 8.484
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[6,    22] loss: 8.489
[6,    23] loss: 8.365
[6,    24] loss: 8.543
[6,    25] loss: 8.371
[7,     1] loss: 8.384
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7,     2] loss: 8.414
[7,     3] loss: 8.475
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7,     4] loss: 8.300
[7,     5] loss: 8.402
[7,     6] loss: 8.396
[7,     7] loss: 8.225
[7,     8] loss: 8.229
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7,     9] loss: 8.332
[7,    10] loss: 8.378
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7,    11] loss: 8.163
[7,    12] loss: 8.254
[7,    13] loss: 8.177
[7,    14] loss: 8.305
[7,    15] loss: 8.171
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7,    16] loss: 8.169
[7,    17] loss: 8.124
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7,    18] loss: 8.063
[7,    19] loss: 8.176
[7,    20] loss: 8.153
[7,    21] loss: 8.164
[7,    22] loss: 8.049
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7,    23] loss: 8.067
[7,    24] loss: 8.158
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7,    25] loss: 8.220
[8,     1] loss: 8.066
[8,     2] loss: 8.163
[8,     3] loss: 7.969
[8,     4] loss: 8.163
[8,     5] loss: 8.068
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[8,     6] loss: 7.991
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[8,     7] loss: 7.962
[8,     8] loss: 7.975
[8,     9] loss: 7.917
[8,    10] loss: 7.881
[8,    11] loss: 8.009
[8,    12] loss: 7.940
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[8,    13] loss: 7.915
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[8,    14] loss: 7.832
[8,    15] loss: 7.870
[8,    16] loss: 7.943
[8,    17] loss: 7.718
[8,    18] loss: 7.908
[8,    19] loss: 7.873
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[8,    20] loss: 7.672
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[8,    21] loss: 7.881
[8,    22] loss: 7.737
[8,    23] loss: 7.824
[8,    24] loss: 7.734
[8,    25] loss: 7.701
[9,     1] loss: 7.686
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[9,     2] loss: 7.644
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[9,     3] loss: 7.608
[9,     4] loss: 7.645
[9,     5] loss: 7.730
[9,     6] loss: 7.729
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[9,     7] loss: 7.676
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[9,     8] loss: 7.619
[9,     9] loss: 7.571
[9,    10] loss: 7.697
[9,    11] loss: 7.660
[9,    12] loss: 7.514
[9,    13] loss: 7.636
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[9,    14] loss: 7.471
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[9,    15] loss: 7.648
[9,    16] loss: 7.653
[9,    17] loss: 7.529
[9,    18] loss: 7.578
[9,    19] loss: 7.607
[9,    20] loss: 7.472
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[9,    21] loss: 7.365
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[9,    22] loss: 7.505
[9,    23] loss: 7.401
[9,    24] loss: 7.391
[9,    25] loss: 7.575
[10,     1] loss: 7.515
[10,     2] loss: 7.543
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10,     3] loss: 7.364
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10,     4] loss: 7.323
[10,     5] loss: 7.404
[10,     6] loss: 7.454
[10,     7] loss: 7.324
[10,     8] loss: 7.217
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10,     9] loss: 7.414
[10,    10] loss: 7.162
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10,    11] loss: 7.293
[10,    12] loss: 7.177
[10,    13] loss: 7.290
[10,    14] loss: 7.216
[10,    15] loss: 7.390
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10,    16] loss: 7.199
[10,    17] loss: 7.142
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10,    18] loss: 7.149
[10,    19] loss: 7.101
[10,    20] loss: 7.196
[10,    21] loss: 7.260
[10,    22] loss: 7.072
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10,    23] loss: 6.956
[10,    24] loss: 7.067
[10,    25] loss: 7.317
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[11,     1] loss: 6.981
[11,     2] loss: 7.064
[11,     3] loss: 7.123
[11,     4] loss: 7.095
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[11,     5] loss: 7.154
[11,     6] loss: 6.936
[11,     7] loss: 6.932
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[11,     8] loss: 7.124
[11,     9] loss: 6.946
[11,    10] loss: 7.010
[11,    11] loss: 7.009
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[11,    12] loss: 6.950
[11,    13] loss: 6.843
[11,    14] loss: 6.808
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[11,    15] loss: 6.868
[11,    16] loss: 6.909
[11,    17] loss: 6.866
[11,    18] loss: 6.863
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[11,    19] loss: 6.885
[11,    20] loss: 6.908
[11,    21] loss: 6.917
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[11,    22] loss: 6.918
[11,    23] loss: 6.758
[11,    24] loss: 6.766
[11,    25] loss: 6.952
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[12,     1] loss: 6.783
[12,     2] loss: 6.727
[12,     3] loss: 6.727
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[12,     4] loss: 6.880
[12,     5] loss: 6.558
[12,     6] loss: 6.602
[12,     7] loss: 6.518
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[12,     8] loss: 6.761
[12,     9] loss: 6.527
[12,    10] loss: 6.907
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[12,    11] loss: 6.647
[12,    12] loss: 6.534
[12,    13] loss: 6.736
[12,    14] loss: 6.711
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[12,    15] loss: 6.439
[12,    16] loss: 6.778
[12,    17] loss: 6.429
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[12,    18] loss: 6.515
[12,    19] loss: 6.677
[12,    20] loss: 6.456
[12,    21] loss: 6.539
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[12,    22] loss: 6.615
[12,    23] loss: 6.535
[12,    24] loss: 6.584
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[12,    25] loss: 6.690
[13,     1] loss: 6.571
[13,     2] loss: 6.459
[13,     3] loss: 6.367
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[13,     4] loss: 6.621
[13,     5] loss: 6.409
[13,     6] loss: 6.402
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[13,     7] loss: 6.309
[13,     8] loss: 6.567
[13,     9] loss: 6.328
[13,    10] loss: 6.263
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[13,    11] loss: 6.257
[13,    12] loss: 6.239
[13,    13] loss: 6.498
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[13,    14] loss: 6.158
[13,    15] loss: 6.613
[13,    16] loss: 6.202
[13,    17] loss: 6.110
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[13,    18] loss: 6.245
[13,    19] loss: 6.078
[13,    20] loss: 6.312
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[13,    21] loss: 6.348
[13,    22] loss: 6.315
[13,    23] loss: 6.289
[13,    24] loss: 6.247
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[13,    25] loss: 6.236
[14,     1] loss: 6.083
[14,     2] loss: 6.333
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[14,     3] loss: 6.165
[14,     4] loss: 6.346
[14,     5] loss: 6.407
[14,     6] loss: 6.145
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[14,     7] loss: 6.094
[14,     8] loss: 6.109
[14,     9] loss: 6.038
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[14,    10] loss: 6.297
[14,    11] loss: 6.280
[14,    12] loss: 6.125
[14,    13] loss: 6.150
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[14,    14] loss: 5.908
[14,    15] loss: 6.128
[14,    16] loss: 5.940
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[14,    17] loss: 5.756
[14,    18] loss: 6.049
[14,    19] loss: 5.921
[14,    20] loss: 6.027
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[14,    21] loss: 5.603
[14,    22] loss: 5.959
[14,    23] loss: 5.840
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[14,    24] loss: 5.906
[14,    25] loss: 5.844
[15,     1] loss: 6.004
[15,     2] loss: 5.895
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[15,     3] loss: 5.866
[15,     4] loss: 6.024
[15,     5] loss: 5.863
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[15,     6] loss: 5.802
[15,     7] loss: 5.917
[15,     8] loss: 5.721
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[15,     9] loss: 5.992
[15,    10] loss: 5.797
[15,    11] loss: 5.876
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[15,    12] loss: 5.987
[15,    13] loss: 5.749
[15,    14] loss: 5.839
[15,    15] loss: 5.732
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[15,    16] loss: 5.693
[15,    17] loss: 5.889
[15,    18] loss: 5.654
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[15,    19] loss: 5.889
[15,    20] loss: 5.726
[15,    21] loss: 5.662
[15,    22] loss: 5.676
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[15,    23] loss: 5.547
[15,    24] loss: 5.634
[15,    25] loss: 5.537
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[16,     1] loss: 5.571
[16,     2] loss: 5.725
[16,     3] loss: 5.623
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[16,     4] loss: 5.835
[16,     5] loss: 5.777
[16,     6] loss: 5.594
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[16,     7] loss: 6.046
[16,     8] loss: 5.454
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[16,     9] loss: 5.513
[16,    10] loss: 5.494
[16,    11] loss: 5.701
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[16,    12] loss: 5.313
[16,    13] loss: 5.660
[16,    14] loss: 5.462
[16,    15] loss: 5.428
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[16,    16] loss: 5.366
[16,    17] loss: 5.495
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[16,    18] loss: 5.532
[16,    19] loss: 5.427
[16,    20] loss: 5.569
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[16,    21] loss: 5.204
[16,    22] loss: 5.485
[16,    23] loss: 5.341
[16,    24] loss: 5.734
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[16,    25] loss: 5.739
[17,     1] loss: 5.481
[17,     2] loss: 5.569
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17,     3] loss: 5.341
[17,     4] loss: 5.421
[17,     5] loss: 5.451
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17,     6] loss: 5.396
[17,     7] loss: 5.464
[17,     8] loss: 5.336
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17,     9] loss: 5.482
[17,    10] loss: 5.257
[17,    11] loss: 5.397
[17,    12] loss: 5.146
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17,    13] loss: 5.426
[17,    14] loss: 5.341
[17,    15] loss: 5.473
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17,    16] loss: 5.085
[17,    17] loss: 5.491
[17,    18] loss: 5.431
[17,    19] loss: 5.205
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17,    20] loss: 5.453
[17,    21] loss: 5.139
[17,    22] loss: 4.975
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17,    23] loss: 5.264
[17,    24] loss: 5.336
[17,    25] loss: 5.023
[18,     1] loss: 5.133
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[18,     2] loss: 5.070
[18,     3] loss: 5.034
[18,     4] loss: 5.136
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[18,     5] loss: 5.143
[18,     6] loss: 5.401
[18,     7] loss: 5.134
[18,     8] loss: 5.233
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[18,     9] loss: 5.134
[18,    10] loss: 5.211
[18,    11] loss: 5.213
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[18,    12] loss: 5.199
[18,    13] loss: 4.831
[18,    14] loss: 5.206
[18,    15] loss: 5.057
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[18,    16] loss: 4.890
[18,    17] loss: 5.244
[18,    18] loss: 5.068
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[18,    19] loss: 5.283
[18,    20] loss: 5.128
[18,    21] loss: 5.066
[18,    22] loss: 5.164
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[18,    23] loss: 5.229
[18,    24] loss: 5.080
[18,    25] loss: 4.892
[19,     1] loss: 5.021
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[19,     2] loss: 4.601
[19,     3] loss: 5.168
[19,     4] loss: 4.941
[19,     5] loss: 5.096
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[19,     6] loss: 5.121
[19,     7] loss: 5.093
[19,     8] loss: 4.957
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[19,     9] loss: 4.967
[19,    10] loss: 4.900
[19,    11] loss: 4.980
[19,    12] loss: 4.992
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[19,    13] loss: 4.713
[19,    14] loss: 4.822
[19,    15] loss: 5.032
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[19,    16] loss: 4.945
[19,    17] loss: 4.766
[19,    18] loss: 4.989
[19,    19] loss: 4.756
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[19,    20] loss: 5.121
[19,    21] loss: 4.834
[19,    22] loss: 4.872
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[19,    23] loss: 4.998
[19,    24] loss: 4.692
[19,    25] loss: 4.934
[20,     1] loss: 4.946
[20,     2] loss: 4.878
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[20,     3] loss: 4.605
[20,     4] loss: 4.761
[20,     5] loss: 4.618
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[20,     6] loss: 4.854
[20,     7] loss: 4.785
[20,     8] loss: 4.607
[20,     9] loss: 4.682
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[20,    10] loss: 4.665
[20,    11] loss: 4.844
[20,    12] loss: 4.730
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[20,    13] loss: 4.683
[20,    14] loss: 4.602
[20,    15] loss: 4.669
[20,    16] loss: 4.586
[20,    17] loss: 4.825
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[20,    18] loss: 4.906
[20,    19] loss: 4.880
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[20,    20] loss: 4.689
[20,    21] loss: 4.893
[20,    22] loss: 4.861
[20,    23] loss: 4.714
[20,    24] loss: 4.692
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[20,    25] loss: 4.587
[21,     1] loss: 4.528
[21,     2] loss: 4.608
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[21,     3] loss: 4.540
[21,     4] loss: 4.574
[21,     5] loss: 4.595
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[21,     6] loss: 4.601
[21,     7] loss: 4.522
[21,     8] loss: 4.472
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[21,     9] loss: 4.500
[21,    10] loss: 4.553
[21,    11] loss: 4.577
[21,    12] loss: 4.552
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[21,    13] loss: 4.767
[21,    14] loss: 4.766
[21,    15] loss: 4.819
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[21,    16] loss: 4.592
[21,    17] loss: 4.609
[21,    18] loss: 4.446
[21,    19] loss: 4.333
[21,    20] loss: 4.522
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[21,    21] loss: 4.628
[21,    22] loss: 4.625
[21,    23] loss: 4.405
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[21,    24] loss: 4.351
[21,    25] loss: 4.608
[22,     1] loss: 4.406
[22,     2] loss: 4.135
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[22,     3] loss: 4.420
[22,     4] loss: 4.570
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[22,     5] loss: 4.394
[22,     6] loss: 4.451
[22,     7] loss: 4.460
[22,     8] loss: 4.318
[22,     9] loss: 4.453
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[22,    10] loss: 4.250
[22,    11] loss: 4.566
[22,    12] loss: 4.371
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[22,    13] loss: 4.341
[22,    14] loss: 4.386
[22,    15] loss: 4.334
[22,    16] loss: 4.336
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[22,    17] loss: 4.152
[22,    18] loss: 4.407
[22,    19] loss: 4.194
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[22,    20] loss: 4.415
[22,    21] loss: 4.333
[22,    22] loss: 4.490
[22,    23] loss: 4.501
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[22,    24] loss: 4.507
[22,    25] loss: 4.551
[23,     1] loss: 4.253
[23,     2] loss: 4.285
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[23,     3] loss: 4.229
[23,     4] loss: 4.329
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[23,     5] loss: 4.371
[23,     6] loss: 4.193
[23,     7] loss: 4.528
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[23,     8] loss: 4.247
[23,     9] loss: 4.059
[23,    10] loss: 4.098
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[23,    11] loss: 4.374
[23,    12] loss: 4.317
[23,    13] loss: 4.240
[23,    14] loss: 4.232
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[23,    15] loss: 4.142
[23,    16] loss: 4.125
[23,    17] loss: 3.952
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[23,    18] loss: 4.213
[23,    19] loss: 4.241
[23,    20] loss: 4.209
[23,    21] loss: 4.137
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[23,    22] loss: 4.073
[23,    23] loss: 4.082
[23,    24] loss: 4.326
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[23,    25] loss: 4.157
[24,     1] loss: 4.003
[24,     2] loss: 4.171
[24,     3] loss: 3.997
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[24,     4] loss: 3.927
[24,     5] loss: 4.010
[24,     6] loss: 4.200
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[24,     7] loss: 4.199
[24,     8] loss: 4.103
[24,     9] loss: 4.039
[24,    10] loss: 4.179
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[24,    11] loss: 3.990
[24,    12] loss: 4.080
[24,    13] loss: 4.136
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[24,    14] loss: 4.033
[24,    15] loss: 4.063
[24,    16] loss: 3.917
[24,    17] loss: 3.912
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[24,    18] loss: 4.044
[24,    19] loss: 3.859
[24,    20] loss: 4.247
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[24,    21] loss: 3.964
[24,    22] loss: 4.003
[24,    23] loss: 3.910
[24,    24] loss: 4.064
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[24,    25] loss: 4.262
[25,     1] loss: 4.104
[25,     2] loss: 3.933
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[25,     3] loss: 3.988
[25,     4] loss: 4.131
[25,     5] loss: 3.686
[25,     6] loss: 3.781
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[25,     7] loss: 3.931
[25,     8] loss: 4.300
[25,     9] loss: 3.975
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[25,    10] loss: 4.001
[25,    11] loss: 3.983
[25,    12] loss: 3.879
[25,    13] loss: 4.002
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[25,    14] loss: 4.027
[25,    15] loss: 3.725
[25,    16] loss: 3.622
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[25,    17] loss: 3.872
[25,    18] loss: 3.831
[25,    19] loss: 3.868
[25,    20] loss: 3.806
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[25,    21] loss: 3.654
[25,    22] loss: 3.910
[25,    23] loss: 3.620
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[25,    24] loss: 3.733
[25,    25] loss: 3.761
[26,     1] loss: 3.814
[26,     2] loss: 3.900
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[26,     3] loss: 3.741
[26,     4] loss: 3.661
[26,     5] loss: 3.843
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[26,     6] loss: 3.751
[26,     7] loss: 3.754
[26,     8] loss: 3.691
[26,     9] loss: 3.738
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[26,    10] loss: 3.675
[26,    11] loss: 3.632
[26,    12] loss: 3.726
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[26,    13] loss: 3.643
[26,    14] loss: 3.792
[26,    15] loss: 3.661
[26,    16] loss: 3.708
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[26,    17] loss: 3.533
[26,    18] loss: 3.496
[26,    19] loss: 3.867
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[26,    20] loss: 3.855
[26,    21] loss: 3.734
[26,    22] loss: 3.584
[26,    23] loss: 3.763
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[26,    24] loss: 3.929
[26,    25] loss: 3.602
[27,     1] loss: 3.744
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[27,     2] loss: 3.491
[27,     3] loss: 3.635
[27,     4] loss: 3.708
[27,     5] loss: 3.527
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[27,     6] loss: 3.645
[27,     7] loss: 3.666
[27,     8] loss: 3.494
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[27,     9] loss: 3.664
[27,    10] loss: 3.781
[27,    11] loss: 3.601
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[27,    12] loss: 3.529
[27,    13] loss: 3.473
[27,    14] loss: 3.359
[27,    15] loss: 3.657
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[27,    16] loss: 3.378
[27,    17] loss: 3.478
[27,    18] loss: 3.608
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[27,    19] loss: 3.439
[27,    20] loss: 3.483
[27,    21] loss: 3.501
[27,    22] loss: 3.604
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[27,    23] loss: 3.598
[27,    24] loss: 3.658
[27,    25] loss: 3.402
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[28,     1] loss: 3.519
[28,     2] loss: 3.287
[28,     3] loss: 3.547
[28,     4] loss: 3.700
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[28,     5] loss: 3.097
[28,     6] loss: 3.654
[28,     7] loss: 3.570
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[28,     8] loss: 3.548
[28,     9] loss: 3.334
[28,    10] loss: 3.328
[28,    11] loss: 3.470
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[28,    12] loss: 3.499
[28,    13] loss: 3.295
[28,    14] loss: 3.433
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[28,    15] loss: 3.372
[28,    16] loss: 3.397
[28,    17] loss: 3.369
[28,    18] loss: 3.241
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[28,    19] loss: 3.365
[28,    20] loss: 3.433
[28,    21] loss: 3.378
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[28,    22] loss: 3.376
[28,    23] loss: 3.459
[28,    24] loss: 3.305
[28,    25] loss: 3.259
[29,     1] loss: 3.246
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[29,     2] loss: 3.170
[29,     3] loss: 3.514
[29,     4] loss: 3.163
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[29,     5] loss: 3.530
[29,     6] loss: 3.229
[29,     7] loss: 3.511
[29,     8] loss: 3.279
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[29,     9] loss: 3.182
[29,    10] loss: 3.059
[29,    11] loss: 3.272
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[29,    12] loss: 3.327
[29,    13] loss: 3.237
[29,    14] loss: 3.396
[29,    15] loss: 3.220
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[29,    16] loss: 3.218
[29,    17] loss: 3.085
[29,    18] loss: 3.272
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[29,    19] loss: 3.219
[29,    20] loss: 3.169
[29,    21] loss: 3.263
[29,    22] loss: 3.146
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[29,    23] loss: 3.274
[29,    24] loss: 3.190
[29,    25] loss: 3.288
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[30,     1] loss: 3.257
[30,     2] loss: 3.279
[30,     3] loss: 3.115
[30,     4] loss: 3.050
[30,     5] loss: 3.229
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[30,     6] loss: 3.205
[30,     7] loss: 3.134
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[30,     8] loss: 3.114
[30,     9] loss: 3.277
[30,    10] loss: 3.172
[30,    11] loss: 3.045
[30,    12] loss: 3.204
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[30,    13] loss: 2.959
[30,    14] loss: 3.199
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[30,    15] loss: 3.273
[30,    16] loss: 3.127
[30,    17] loss: 2.933
[30,    18] loss: 2.920
[30,    19] loss: 2.932
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[30,    20] loss: 3.048
[30,    21] loss: 3.025
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[30,    22] loss: 3.101
[30,    23] loss: 3.224
[30,    24] loss: 2.986
[30,    25] loss: 2.827
[31,     1] loss: 2.936
[31,     2] loss: 3.194
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[31,     3] loss: 2.916
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[31,     4] loss: 3.110
[31,     5] loss: 2.871
[31,     6] loss: 2.972
[31,     7] loss: 3.047
[31,     8] loss: 2.945
[31,     9] loss: 3.013
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[31,    10] loss: 2.848
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[31,    11] loss: 3.038
[31,    12] loss: 2.917
[31,    13] loss: 3.034
[31,    14] loss: 2.939
[31,    15] loss: 2.893
[31,    16] loss: 3.009
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[31,    17] loss: 2.960
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[31,    18] loss: 2.885
[31,    19] loss: 2.993
[31,    20] loss: 3.023
[31,    21] loss: 2.962
[31,    22] loss: 2.816
[31,    23] loss: 2.996
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[31,    24] loss: 2.936
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[31,    25] loss: 2.756
[32,     1] loss: 2.928
[32,     2] loss: 2.894
[32,     3] loss: 2.787
[32,     4] loss: 2.867
[32,     5] loss: 2.815
[32,     6] loss: 2.908
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[32,     7] loss: 2.751
[32,     8] loss: 2.678
[32,     9] loss: 2.817
[32,    10] loss: 2.873
[32,    11] loss: 2.988
[32,    12] loss: 2.697
[32,    13] loss: 2.752
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[32,    14] loss: 2.756
[32,    15] loss: 2.805
[32,    16] loss: 2.956
[32,    17] loss: 2.667
[32,    18] loss: 2.861
[32,    19] loss: 2.791
[32,    20] loss: 2.820
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[32,    21] loss: 2.864
[32,    22] loss: 2.834
[32,    23] loss: 2.788
[32,    24] loss: 2.839
[32,    25] loss: 2.794
[33,     1] loss: 2.699
[33,     2] loss: 2.755
[33,     3] loss: 2.884
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[33,     4] loss: 2.593
[33,     5] loss: 2.799
[33,     6] loss: 2.710
[33,     7] loss: 2.607
[33,     8] loss: 2.782
[33,     9] loss: 2.592
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[33,    10] loss: 2.763
[33,    11] loss: 2.637
[33,    12] loss: 2.793
[33,    13] loss: 2.700
[33,    14] loss: 2.656
[33,    15] loss: 2.658
[33,    16] loss: 2.784
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[33,    17] loss: 2.599
[33,    18] loss: 2.564
[33,    19] loss: 2.550
[33,    20] loss: 2.708
[33,    21] loss: 2.667
[33,    22] loss: 2.654
[33,    23] loss: 2.684
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[33,    24] loss: 2.639
[33,    25] loss: 2.661
[34,     1] loss: 2.596
[34,     2] loss: 2.627
[34,     3] loss: 2.637
[34,     4] loss: 2.562
[34,     5] loss: 2.602
[34,     6] loss: 2.617
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[34,     7] loss: 2.666
[34,     8] loss: 2.340
[34,     9] loss: 2.626
[34,    10] loss: 2.554
[34,    11] loss: 2.761
[34,    12] loss: 2.604
[34,    13] loss: 2.655
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[34,    14] loss: 2.424
[34,    15] loss: 2.542
[34,    16] loss: 2.619
[34,    17] loss: 2.479
[34,    18] loss: 2.595
[34,    19] loss: 2.592
[34,    20] loss: 2.481
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[34,    21] loss: 2.481
[34,    22] loss: 2.426
[34,    23] loss: 2.410
[34,    24] loss: 2.457
[34,    25] loss: 2.543
[35,     1] loss: 2.556
[35,     2] loss: 2.500
[35,     3] loss: 2.553
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[35,     4] loss: 2.436
[35,     5] loss: 2.582
[35,     6] loss: 2.529
[35,     7] loss: 2.321
[35,     8] loss: 2.322
[35,     9] loss: 2.293
[35,    10] loss: 2.383
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[35,    11] loss: 2.217
[35,    12] loss: 2.520
[35,    13] loss: 2.513
[35,    14] loss: 2.436
[35,    15] loss: 2.411
[35,    16] loss: 2.499
[35,    17] loss: 2.491
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[35,    18] loss: 2.368
[35,    19] loss: 2.353
[35,    20] loss: 2.401
[35,    21] loss: 2.517
[35,    22] loss: 2.570
[35,    23] loss: 2.402
[35,    24] loss: 2.339
[35,    25] loss: 2.275
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[36,     1] loss: 2.330
[36,     2] loss: 2.455
[36,     3] loss: 2.432
[36,     4] loss: 2.445
[36,     5] loss: 2.316
[36,     6] loss: 2.260
[36,     7] loss: 2.274
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[36,     8] loss: 2.381
[36,     9] loss: 2.276
[36,    10] loss: 2.240
[36,    11] loss: 2.313
[36,    12] loss: 2.459
[36,    13] loss: 2.314
[36,    14] loss: 2.399
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[36,    15] loss: 2.357
[36,    16] loss: 2.302
[36,    17] loss: 2.252
[36,    18] loss: 2.250
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[36,    19] loss: 2.273
[36,    20] loss: 2.278
[36,    21] loss: 2.426
[36,    22] loss: 2.268
[36,    23] loss: 2.237
[36,    24] loss: 2.174
[36,    25] loss: 2.192
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[37,     1] loss: 2.315
[37,     2] loss: 2.294
[37,     3] loss: 2.279
[37,     4] loss: 2.236
[37,     5] loss: 2.224
[37,     6] loss: 2.158
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[37,     7] loss: 2.280
[37,     8] loss: 2.082
[37,     9] loss: 2.176
[37,    10] loss: 2.219
[37,    11] loss: 2.220
[37,    12] loss: 2.159
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[37,    13] loss: 2.272
[37,    14] loss: 2.439
[37,    15] loss: 2.292
[37,    16] loss: 2.227
[37,    17] loss: 2.113
[37,    18] loss: 2.212
[37,    19] loss: 2.270
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[37,    20] loss: 2.152
[37,    21] loss: 2.163
[37,    22] loss: 2.064
[37,    23] loss: 2.053
[37,    24] loss: 2.153
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[37,    25] loss: 2.166
[38,     1] loss: 2.058
[38,     2] loss: 2.338
[38,     3] loss: 2.125
[38,     4] loss: 2.267
[38,     5] loss: 2.038
[38,     6] loss: 2.030
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[38,     7] loss: 2.182
[38,     8] loss: 2.138
[38,     9] loss: 2.131
[38,    10] loss: 2.049
[38,    11] loss: 2.226
[38,    12] loss: 2.110
[38,    13] loss: 2.040
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[38,    14] loss: 2.069
[38,    15] loss: 2.218
[38,    16] loss: 1.951
[38,    17] loss: 2.044
[38,    18] loss: 2.142
[38,    19] loss: 2.138
[38,    20] loss: 2.024
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[38,    21] loss: 2.021
[38,    22] loss: 2.114
[38,    23] loss: 2.154
[38,    24] loss: 2.001
[38,    25] loss: 2.098
[39,     1] loss: 1.919
[39,     2] loss: 2.119
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[39,     3] loss: 2.094
[39,     4] loss: 2.091
[39,     5] loss: 1.988
[39,     6] loss: 1.923
[39,     7] loss: 1.985
[39,     8] loss: 1.871
[39,     9] loss: 1.966
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[39,    10] loss: 2.112
[39,    11] loss: 1.974
[39,    12] loss: 2.062
[39,    13] loss: 2.060
[39,    14] loss: 1.944
[39,    15] loss: 1.943
[39,    16] loss: 2.129
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[39,    17] loss: 1.877
[39,    18] loss: 2.045
[39,    19] loss: 1.966
[39,    20] loss: 1.921
[39,    21] loss: 2.066
[39,    22] loss: 2.100
[39,    23] loss: 2.104
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[39,    24] loss: 2.070
[39,    25] loss: 2.053
[40,     1] loss: 1.985
[40,     2] loss: 2.018
[40,     3] loss: 1.922
[40,     4] loss: 1.999
[40,     5] loss: 1.948
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[40,     6] loss: 2.023
[40,     7] loss: 1.912
[40,     8] loss: 1.976
[40,     9] loss: 1.979
[40,    10] loss: 1.864
[40,    11] loss: 1.872
[40,    12] loss: 1.953
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[40,    13] loss: 1.982
[40,    14] loss: 1.890
[40,    15] loss: 1.997
[40,    16] loss: 1.984
[40,    17] loss: 1.959
[40,    18] loss: 1.813
[40,    19] loss: 2.043
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[40,    20] loss: 1.779
[40,    21] loss: 1.893
[40,    22] loss: 1.928
[40,    23] loss: 1.737
[40,    24] loss: 1.864
[40,    25] loss: 1.882
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[41,     1] loss: 1.760
[41,     2] loss: 1.998
[41,     3] loss: 1.844
[41,     4] loss: 1.917
[41,     5] loss: 1.831
[41,     6] loss: 1.919
[41,     7] loss: 1.891
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[41,     8] loss: 1.841
[41,     9] loss: 2.022
[41,    10] loss: 1.740
[41,    11] loss: 1.731
[41,    12] loss: 1.809
[41,    13] loss: 1.785
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[41,    14] loss: 1.923
[41,    15] loss: 1.907
[41,    16] loss: 1.877
[41,    17] loss: 1.769
[41,    18] loss: 1.945
[41,    19] loss: 1.886
[41,    20] loss: 1.746
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[41,    21] loss: 1.805
[41,    22] loss: 1.750
[41,    23] loss: 1.791
[41,    24] loss: 2.015
[41,    25] loss: 1.659
[42,     1] loss: 1.872
[42,     2] loss: 1.750
[42,     3] loss: 1.819
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[42,     4] loss: 1.686
[42,     5] loss: 1.745
[42,     6] loss: 1.870
[42,     7] loss: 1.724
[42,     8] loss: 1.691
[42,     9] loss: 1.894
[42,    10] loss: 1.744
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[42,    11] loss: 1.618
[42,    12] loss: 1.921
[42,    13] loss: 1.910
[42,    14] loss: 1.714
[42,    15] loss: 1.787
[42,    16] loss: 1.813
[42,    17] loss: 1.879
[42,    18] loss: 1.543
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[42,    19] loss: 1.713
[42,    20] loss: 1.710
[42,    21] loss: 1.743
[42,    22] loss: 1.855
[42,    23] loss: 1.718
[42,    24] loss: 1.859
[42,    25] loss: 1.786
[43,     1] loss: 1.716
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[43,     2] loss: 1.724
[43,     3] loss: 1.801
[43,     4] loss: 1.705
[43,     5] loss: 1.718
[43,     6] loss: 1.724
[43,     7] loss: 1.737
[43,     8] loss: 1.665
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[43,     9] loss: 1.771
[43,    10] loss: 1.711
[43,    11] loss: 1.727
[43,    12] loss: 1.718
[43,    13] loss: 1.580
[43,    14] loss: 1.708
[43,    15] loss: 1.618
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[43,    16] loss: 1.596
[43,    17] loss: 1.617
[43,    18] loss: 1.801
[43,    19] loss: 1.853
[43,    20] loss: 1.706
[43,    21] loss: 1.796
[43,    22] loss: 1.471
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[43,    23] loss: 1.695
[43,    24] loss: 1.703
[43,    25] loss: 1.822
[44,     1] loss: 1.494
[44,     2] loss: 1.624
[44,     3] loss: 1.569
[44,     4] loss: 1.749
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[44,     5] loss: 1.562
[44,     6] loss: 1.836
[44,     7] loss: 1.536
[44,     8] loss: 1.645
[44,     9] loss: 1.555
[44,    10] loss: 1.637
[44,    11] loss: 1.629
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[44,    12] loss: 1.647
[44,    13] loss: 1.632
[44,    14] loss: 1.776
[44,    15] loss: 1.726
[44,    16] loss: 1.735
[44,    17] loss: 1.686
[44,    18] loss: 1.573
[44,    19] loss: 1.830
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[44,    20] loss: 1.605
[44,    21] loss: 1.603
[44,    22] loss: 1.568
[44,    23] loss: 1.672
[44,    24] loss: 1.632
[44,    25] loss: 1.511
[45,     1] loss: 1.587
[45,     2] loss: 1.596
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[45,     3] loss: 1.594
[45,     4] loss: 1.520
[45,     5] loss: 1.649
[45,     6] loss: 1.602
[45,     7] loss: 1.771
[45,     8] loss: 1.513
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[45,     9] loss: 1.808
[45,    10] loss: 1.550
[45,    11] loss: 1.523
[45,    12] loss: 1.509
[45,    13] loss: 1.592
[45,    14] loss: 1.586
[45,    15] loss: 1.592
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[45,    16] loss: 1.407
[45,    17] loss: 1.403
[45,    18] loss: 1.585
[45,    19] loss: 1.750
[45,    20] loss: 1.601
[45,    21] loss: 1.573
[45,    22] loss: 1.515
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[45,    23] loss: 1.739
[45,    24] loss: 1.409
[45,    25] loss: 1.632
[46,     1] loss: 1.551
[46,     2] loss: 1.603
[46,     3] loss: 1.695
[46,     4] loss: 1.513
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[46,     5] loss: 1.429
[46,     6] loss: 1.571
[46,     7] loss: 1.587
[46,     8] loss: 1.561
[46,     9] loss: 1.562
[46,    10] loss: 1.430
[46,    11] loss: 1.512
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[46,    12] loss: 1.566
[46,    13] loss: 1.558
[46,    14] loss: 1.476
[46,    15] loss: 1.543
[46,    16] loss: 1.666
[46,    17] loss: 1.575
[46,    18] loss: 1.417
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[46,    19] loss: 1.556
[46,    20] loss: 1.481
[46,    21] loss: 1.389
[46,    22] loss: 1.469
[46,    23] loss: 1.543
[46,    24] loss: 1.612
[46,    25] loss: 1.307
[47,     1] loss: 1.455
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[47,     2] loss: 1.423
[47,     3] loss: 1.512
[47,     4] loss: 1.562
[47,     5] loss: 1.390
[47,     6] loss: 1.435
[47,     7] loss: 1.409
[47,     8] loss: 1.539
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[47,     9] loss: 1.603
[47,    10] loss: 1.496
[47,    11] loss: 1.452
[47,    12] loss: 1.541
[47,    13] loss: 1.435
[47,    14] loss: 1.503
[47,    15] loss: 1.357
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[47,    16] loss: 1.523
[47,    17] loss: 1.686
[47,    18] loss: 1.494
[47,    19] loss: 1.509
[47,    20] loss: 1.454
[47,    21] loss: 1.453
[47,    22] loss: 1.485
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[47,    23] loss: 1.369
[47,    24] loss: 1.374
[47,    25] loss: 1.513
[48,     1] loss: 1.478
[48,     2] loss: 1.466
[48,     3] loss: 1.288
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[48,     4] loss: 1.433
[48,     5] loss: 1.306
[48,     6] loss: 1.360
[48,     7] loss: 1.515
[48,     8] loss: 1.469
[48,     9] loss: 1.530
[48,    10] loss: 1.415
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[48,    11] loss: 1.330
[48,    12] loss: 1.386
[48,    13] loss: 1.505
[48,    14] loss: 1.388
[48,    15] loss: 1.434
[48,    16] loss: 1.476
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[48,    17] loss: 1.515
[48,    18] loss: 1.473
[48,    19] loss: 1.461
[48,    20] loss: 1.500
[48,    21] loss: 1.393
[48,    22] loss: 1.464
[48,    23] loss: 1.444
[48,    24] loss: 1.352
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[48,    25] loss: 1.382
[49,     1] loss: 1.392
[49,     2] loss: 1.387
[49,     3] loss: 1.334
[49,     4] loss: 1.530
[49,     5] loss: 1.298
[49,     6] loss: 1.558
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[49,     7] loss: 1.632
[49,     8] loss: 1.177
[49,     9] loss: 1.446
[49,    10] loss: 1.361
[49,    11] loss: 1.470
[49,    12] loss: 1.480
[49,    13] loss: 1.352
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[49,    14] loss: 1.424
[49,    15] loss: 1.400
[49,    16] loss: 1.495
[49,    17] loss: 1.341
[49,    18] loss: 1.146
[49,    19] loss: 1.406
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[49,    20] loss: 1.383
[49,    21] loss: 1.493
[49,    22] loss: 1.117
[49,    23] loss: 1.394
[49,    24] loss: 1.340
[49,    25] loss: 1.289
[50,     1] loss: 1.333
[50,     2] loss: 1.377
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[50,     3] loss: 1.419
[50,     4] loss: 1.271
[50,     5] loss: 1.320
[50,     6] loss: 1.416
[50,     7] loss: 1.306
[50,     8] loss: 1.355
[50,     9] loss: 1.337
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[50,    10] loss: 1.275
[50,    11] loss: 1.371
[50,    12] loss: 1.298
[50,    13] loss: 1.376
[50,    14] loss: 1.342
[50,    15] loss: 1.398
[50,    16] loss: 1.460
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[50,    17] loss: 1.308
[50,    18] loss: 1.362
[50,    19] loss: 1.312
[50,    20] loss: 1.319
[50,    21] loss: 1.346
[50,    22] loss: 1.288
[50,    23] loss: 1.319
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[50,    24] loss: 1.393
[50,    25] loss: 1.331
[51,     1] loss: 1.222
[51,     2] loss: 1.185
[51,     3] loss: 1.344
[51,     4] loss: 1.353
[51,     5] loss: 1.276
[51,     6] loss: 1.324
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[51,     7] loss: 1.472
[51,     8] loss: 1.283
[51,     9] loss: 1.369
[51,    10] loss: 1.383
[51,    11] loss: 1.365
[51,    12] loss: 1.273
[51,    13] loss: 1.326
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[51,    14] loss: 1.319
[51,    15] loss: 1.276
[51,    16] loss: 1.256
[51,    17] loss: 1.417
[51,    18] loss: 1.290
[51,    19] loss: 1.218
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[51,    20] loss: 1.349
[51,    21] loss: 1.138
[51,    22] loss: 1.269
[51,    23] loss: 1.277
[51,    24] loss: 1.363
[51,    25] loss: 1.324
[52,     1] loss: 1.327
[52,     2] loss: 1.289
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[52,     3] loss: 1.278
[52,     4] loss: 1.217
[52,     5] loss: 1.257
[52,     6] loss: 1.277
[52,     7] loss: 1.300
[52,     8] loss: 1.333
[52,     9] loss: 1.344
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[52,    10] loss: 1.296
[52,    11] loss: 1.329
[52,    12] loss: 1.071
[52,    13] loss: 1.376
[52,    14] loss: 1.320
[52,    15] loss: 1.153
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[52,    16] loss: 1.161
[52,    17] loss: 1.182
[52,    18] loss: 1.212
[52,    19] loss: 1.357
[52,    20] loss: 1.241
[52,    21] loss: 1.334
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[52,    22] loss: 1.288
[52,    23] loss: 1.187
[52,    24] loss: 1.354
[52,    25] loss: 1.272
[53,     1] loss: 1.340
[53,     2] loss: 1.176
[53,     3] loss: 1.361
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[53,     4] loss: 1.161
[53,     5] loss: 1.176
[53,     6] loss: 1.231
[53,     7] loss: 1.178
[53,     8] loss: 1.295
[53,     9] loss: 1.243
[53,    10] loss: 1.232
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[53,    11] loss: 1.308
[53,    12] loss: 1.246
[53,    13] loss: 1.219
[53,    14] loss: 1.158
[53,    15] loss: 1.207
[53,    16] loss: 1.164
[53,    17] loss: 1.319
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[53,    18] loss: 1.078
[53,    19] loss: 1.332
[53,    20] loss: 1.202
[53,    21] loss: 1.217
[53,    22] loss: 1.204
[53,    23] loss: 1.323
[53,    24] loss: 1.259
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[53,    25] loss: 1.281
[54,     1] loss: 1.176
[54,     2] loss: 1.256
[54,     3] loss: 1.274
[54,     4] loss: 1.137
[54,     5] loss: 1.270
[54,     6] loss: 1.243
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[54,     7] loss: 1.277
[54,     8] loss: 1.067
[54,     9] loss: 1.224
[54,    10] loss: 1.122
[54,    11] loss: 1.225
[54,    12] loss: 1.220
[54,    13] loss: 1.191
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[54,    14] loss: 1.148
[54,    15] loss: 1.249
[54,    16] loss: 1.278
[54,    17] loss: 1.261
[54,    18] loss: 1.103
[54,    19] loss: 1.230
[54,    20] loss: 1.165
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[54,    21] loss: 1.147
[54,    22] loss: 1.110
[54,    23] loss: 1.059
[54,    24] loss: 1.395
[54,    25] loss: 1.288
[55,     1] loss: 1.228
[55,     2] loss: 1.153
[55,     3] loss: 0.945
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[55,     4] loss: 1.090
[55,     5] loss: 1.184
[55,     6] loss: 1.276
[55,     7] loss: 1.066
[55,     8] loss: 1.233
[55,     9] loss: 1.125
[55,    10] loss: 1.229
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[55,    11] loss: 1.093
[55,    12] loss: 1.302
[55,    13] loss: 1.069
[55,    14] loss: 1.344
[55,    15] loss: 1.261
[55,    16] loss: 1.088
[55,    17] loss: 1.128
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[55,    18] loss: 1.318
[55,    19] loss: 1.181
[55,    20] loss: 1.326
[55,    21] loss: 1.090
[55,    22] loss: 1.126
[55,    23] loss: 1.169
[55,    24] loss: 1.123
[55,    25] loss: 1.186
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[56,     1] loss: 1.061
[56,     2] loss: 1.221
[56,     3] loss: 1.149
[56,     4] loss: 1.154
[56,     5] loss: 1.159
[56,     6] loss: 1.056
[56,     7] loss: 1.095
[56,     8] loss: 1.242
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[56,     9] loss: 1.255
[56,    10] loss: 1.183
[56,    11] loss: 1.275
[56,    12] loss: 1.247
[56,    13] loss: 1.149
[56,    14] loss: 1.166
[56,    15] loss: 1.202
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[56,    16] loss: 1.188
[56,    17] loss: 1.048
[56,    18] loss: 1.081
[56,    19] loss: 1.116
[56,    20] loss: 1.052
[56,    21] loss: 1.088
[56,    22] loss: 1.000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[56,    23] loss: 1.228
[56,    24] loss: 1.040
[56,    25] loss: 1.156
[57,     1] loss: 1.088
[57,     2] loss: 1.059
[57,     3] loss: 1.080
[57,     4] loss: 1.136
[57,     5] loss: 1.185
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[57,     6] loss: 1.012
[57,     7] loss: 1.293
[57,     8] loss: 1.231
[57,     9] loss: 0.979
[57,    10] loss: 1.121
[57,    11] loss: 1.164
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[57,    12] loss: 0.998
[57,    13] loss: 1.236
[57,    14] loss: 1.297
[57,    15] loss: 1.241
[57,    16] loss: 1.166
[57,    17] loss: 1.011
[57,    18] loss: 1.047
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[57,    19] loss: 1.075
[57,    20] loss: 1.081
[57,    21] loss: 1.132
[57,    22] loss: 1.073
[57,    23] loss: 1.006
[57,    24] loss: 1.043
[57,    25] loss: 1.198
[58,     1] loss: 1.066
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[58,     2] loss: 1.137
[58,     3] loss: 1.124
[58,     4] loss: 1.068
[58,     5] loss: 1.126
[58,     6] loss: 1.170
[58,     7] loss: 1.031
[58,     8] loss: 1.128
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[58,     9] loss: 0.929
[58,    10] loss: 0.995
[58,    11] loss: 1.160
[58,    12] loss: 1.196
[58,    13] loss: 0.989
[58,    14] loss: 1.159
[58,    15] loss: 1.072
[58,    16] loss: 1.127
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[58,    17] loss: 0.976
[58,    18] loss: 1.058
[58,    19] loss: 1.155
[58,    20] loss: 1.191
[58,    21] loss: 0.992
[58,    22] loss: 1.087
[58,    23] loss: 1.254
[58,    24] loss: 0.935
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[58,    25] loss: 1.178
[59,     1] loss: 1.300
[59,     2] loss: 1.124
[59,     3] loss: 1.090
[59,     4] loss: 1.016
[59,     5] loss: 1.083
[59,     6] loss: 1.067
[59,     7] loss: 1.109
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[59,     8] loss: 0.976
[59,     9] loss: 0.993
[59,    10] loss: 1.056
[59,    11] loss: 1.024
[59,    12] loss: 1.108
[59,    13] loss: 1.133
[59,    14] loss: 1.155
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[59,    15] loss: 1.102
[59,    16] loss: 1.142
[59,    17] loss: 0.978
[59,    18] loss: 1.025
[59,    19] loss: 1.051
[59,    20] loss: 1.017
[59,    21] loss: 0.916
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[59,    22] loss: 1.073
[59,    23] loss: 1.099
[59,    24] loss: 0.978
[59,    25] loss: 1.048
[60,     1] loss: 1.044
[60,     2] loss: 1.054
[60,     3] loss: 0.969
[60,     4] loss: 1.108
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[60,     5] loss: 1.094
[60,     6] loss: 1.034
[60,     7] loss: 1.181
[60,     8] loss: 1.036
[60,     9] loss: 1.117
[60,    10] loss: 1.031
[60,    11] loss: 1.055
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[60,    12] loss: 0.908
[60,    13] loss: 0.995
[60,    14] loss: 1.041
[60,    15] loss: 0.956
[60,    16] loss: 0.987
[60,    17] loss: 1.075
[60,    18] loss: 1.047
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[60,    19] loss: 1.024
[60,    20] loss: 1.229
[60,    21] loss: 0.930
[60,    22] loss: 1.060
[60,    23] loss: 1.067
[60,    24] loss: 1.005
[60,    25] loss: 1.037
************* Training done! *************
</pre></div>
</div>
<img alt="../_images/4_adversarial_94_325.png" src="../_images/4_adversarial_94_325.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">images</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">generate_adversarial_noise</span><span class="p">((</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">model</span><span class="p">)</span>

<span class="n">plot_images_and_noise</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">noise</span><span class="p">)</span>

<span class="n">prediction</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PrÃ©diction:&#39;</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">noise</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PrÃ©diction avec du bruit:&#39;</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4_adversarial_96_0.png" src="../_images/4_adversarial_96_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PrÃ©diction: 0
PrÃ©diction avec du bruit: 0
</pre></div>
</div>
</div>
</div>
<p>Il se trouve que les modÃ¨les linÃ©aires sont dÃ©jÃ  beaucoup plus robustes aux attaques adversaires que les rÃ©seaux de neurones. Malheureusement, les choses sont plus compliquÃ©es pour ces derniÃ¨res puisque il nâ€™y a dÃ©jÃ  pas de solution analytiqueâ€¦</p>
</div>
</div>
<div class="section" id="en-resume">
<h2>En rÃ©sumÃ©<a class="headerlink" href="#en-resume" title="Permalink to this headline">Â¶</a></h2>
<ul class="simple">
<li><p>Nous avons vu comment formaliser la notion dâ€™attaque adversaire via un problÃ¨me dâ€™optimisation sous contrainte :</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\delta^\star=\text{argmin}_{\delta\in\mathcal{B}_\epsilon}-\ell(h_{\theta}(x+\delta), y),\]</div>
<ul class="simple">
<li><p>Nous avons vu une maniÃ¨re de cibler lâ€™attaque afin de â€œforcerâ€ notre modÃ¨le Ã  prÃ©dire une classe particuliÃ¨re :</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\delta^\star=\text{argmin}_{\delta\in\mathcal{B}_\epsilon}-\ell(h_{\theta}(x+\delta), y)+\ell(h_{\theta}(x+\delta), y_{\text{target}}),\]</div>
<ul class="simple">
<li><p>Nous avons contournÃ© le processus dâ€™optimisation via une heuristique, la mÃ©thode <em>fast-sign</em> :</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\hat{\delta}=-\epsilon\cdot\text{sign}(\nabla_\delta\ell(h_{\theta}(x+\delta), y)),\]</div>
<ul class="simple">
<li><p>Nous avons Ã©galement formalisÃ© le problÃ¨me dâ€™apprentissage robuste aux attaques :</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\theta^\star=\text{argmin}_{\theta\in\mathbb{R}^p}\frac{1}{n}\sum_i \text{max}_{\delta\in\mathcal{B}_\epsilon}\ell(h_\theta(x_i+\delta), y_i),\]</div>
<ul class="simple">
<li><p>Et avons rÃ©solu la maximisation dans le cadre dâ€™un classifieur linÃ©aire :</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\omega^\star=\text{argmin}_{\omega\in\mathbb{R}^d}\frac{1}{n}\sum_i\ell(y_i\langle\omega, x_i\rangle-\epsilon\lVert\omega\rVert_1).\]</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./7_regularization"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="3_multitask.html" title="previous page">Lâ€™apprentissage multi-tÃ¢ches â˜•ï¸â˜•ï¸</a>
    <a class='right-next' id="next-link" href="5_ridge.html" title="next page">Une analyse de la rÃ©gularisation Ridge â˜•ï¸â˜•ï¸â˜•ï¸</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The LMIPR team<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>