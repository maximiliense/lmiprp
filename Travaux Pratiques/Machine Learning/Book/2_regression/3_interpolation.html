
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interpolation ☕️☕️ &#8212; Machine Learning</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Sous-différentiel et le cas du Lasso ☕️☕️☕️" href="4_algo_proximal_lasso.html" />
    <link rel="prev" title="L’optimisation ☕️☕️" href="2_optimization.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-72WWYCKNK6"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-72WWYCKNK6');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Machine Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Introduction
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../0_requisite/rappels_python.html">
   Rappels de Python et Numpy
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../1_what_is_ml/0_propos_liminaire.html">
   <em>
    Machine Learning
   </em>
   , initiation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_what_is_ml/1_introduction_ml.html">
     <em>
      Machine learning
     </em>
     et malédiction de la dimension
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_what_is_ml/2_regression_and_classification_trees.html">
     Les arbres de régression et de classification
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="0_propos_liminaire.html">
   La
   <em>
    régression
   </em>
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="1_linear_regression.html">
     La régression linéaire ☕️
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2_optimization.html">
     L’optimisation ☕️☕️
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Interpolation ☕️☕️
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="4_algo_proximal_lasso.html">
     Sous-différentiel et le cas du Lasso ☕️☕️☕️
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="5_least_square_qr.html">
     Les moindres carrés via une décomposition QR (et plus)☕️
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="6_ridge.html">
     Une analyse de la régularisation Ridge ☕️☕️☕️
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../3_classification/0_propos_liminaire.html">
   La
   <em>
    classification
   </em>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_classification/1_logistic_regression.html">
     La régression logistique ☕️
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_classification/2_fonctions_proxy.html">
     Les fonctions de perte (loss function) ☕️☕️☕️
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_classification/3_bayes_classifier.html">
     Le classifieur de Bayes ☕️
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../3_classification/4_VC_theory.html">
     Un modèle formel de l’apprentissage ☕️☕️☕️☕️ (💆‍♂️)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../4_kernel_methods/0_propos_liminaire.html">
   Les méthodes à noyaux
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../4_kernel_methods/1_svm.html">
     Le SVM ou l’hypothèse max-margin ☕️☕️
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../5_ensembles/0_propos_liminaire.html">
   Les méthodes
   <em>
    ensemblistes
   </em>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../5_ensembles/1_ensembles.html">
     Méthodes ensemblistes ☕️☕️
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../5_ensembles/2_bayesian_linear_regression.html">
     Bayesian linear regression ☕️☕️☕️☕️
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../6_deeplearning/0_propos_liminaire.html">
   <em>
    deep learning
   </em>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../6_deeplearning/1_autodiff.html">
     La différentiation automatique et un début de
     <em>
      deep learning
     </em>
     ☕️
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../6_deeplearning/2_filters_representation.html">
     Filtres et espace de représentation des réseaux de neurones ☕️☕️
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../6_deeplearning/3_probabilities_calibration.html">
     Calibration des probabilités et quelques notions ☕️
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../6_deeplearning/4_regularization_deep.html">
     Régularisation en
     <em>
      deep learning
     </em>
     ☕️☕️
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../6_deeplearning/5_transfer_multitask.html">
     <em>
      Transfer learning
     </em>
     et apprentissage multi-tâches ☕️☕️
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../6_deeplearning/6_adversarial.html">
     Les attaques adversaires ☕️
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../7_unsupervised/0_propos_liminaire.html">
   L’apprentissage non-supervisé
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../7_unsupervised/1_principal_component_analysis.html">
     L’Analyse en Composantes Principales ☕️☕️☕️
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../7_unsupervised/2_em_gaussin_mixture_model.html">
     Modèle de Mélange Gaussien et algorithme
     <em>
      Expectation-Maximization
     </em>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../8_set_prediction/0_propos_liminaire.html">
   Prédiction d’ensembles
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../8_set_prediction/1_well_defined.html">
     Jeu d’apprentissage
     <em>
      set-valued
     </em>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../8_set_prediction/2_ill_defined.html">
     Jeu d’apprentissage uniquement multi-classes ☕️
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../biblio.html">
   Bibliographie
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/2_regression/3_interpolation.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/maximiliense/lmiprp"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/maximiliense/lmiprp/issues/new?title=Issue%20on%20page%20%2F2_regression/3_interpolation.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/maximiliense/lmiprp/blob/master/Travaux Pratiques/Machine Learning/Book/2_regression/3_interpolation.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#i-introduction">
   I. Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ii-quelques-exemples-simples-d-interpolations">
   II. Quelques exemples simples d’interpolations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-interpolation-constante-par-morceau-interpolateur-d-ordre-0">
     A. Interpolation constante par morceau (interpolateur d’ordre
     <span class="math notranslate nohighlight">
      \(0\)
     </span>
     )
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#b-interpolation-lineaire-interpolateur-d-ordre-1">
     B. Interpolation linéaire (interpolateur d’ordre
     <span class="math notranslate nohighlight">
      \(1\)
     </span>
     )
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#iii-interpolation-polynomiale">
   III. Interpolation polynomiale
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-polynome-interpolateur-de-lagrange">
     A. Polynome interpolateur de Lagrange
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#b-interpolation-polynomiale-par-regression-non-lineaire">
     B. Interpolation polynomiale par régression (non) linéaire
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#iv-splines">
   IV. Splines
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-les-splines-cubiques">
     A. Les splines cubiques
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#b-estimation-des-coefficients">
     B. Estimation des coefficients
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#v-de-l-interpollation-vers-l-approximation">
   V. De l’interpollation vers l’approximation
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="interpolation">
<h1>Interpolation ☕️☕️<a class="headerlink" href="#interpolation" title="Permalink to this headline">¶</a></h1>
<div class="admonition-objectifs-de-la-sequence admonition">
<p class="admonition-title">Objectifs de la séquence</p>
<ul class="simple">
<li><p>Être sensibilisé</p>
<ul>
<li><p>À la notion d’interpolation,</p></li>
<li><p>Au fait qu’on fait des maths <strong>sur</strong> un ordinateur avec son lot d’approximations numériques.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="i-introduction">
<h2>I. Introduction<a class="headerlink" href="#i-introduction" title="Permalink to this headline">¶</a></h2>
<p>Ce TP est une ouverture et n’est pas du <em>machine learning</em> à proprement parler. Nous allons cependant mettre en avant un ensemble de phénomènes très pertinents en <em>machine learning</em>. Soit un espace de départ, noté <span class="math notranslate nohighlight">\(\mathcal{X}\subseteq\mathbb{R}^d\)</span>, <span class="math notranslate nohighlight">\(d&gt;0\)</span> et un espace d’arrivée <span class="math notranslate nohighlight">\(\mathcal{Y}\subseteq\mathbb{R}\)</span>. Supposons qu’il existe une fonction <span class="math notranslate nohighlight">\(f^\star:\mathcal{X}\rightarrow\mathcal{Y}\)</span> inconnue mais qu’il soit possible de collecter un jeu de données de la forme <span class="math notranslate nohighlight">\(S_n=\{(x_i, y_i=f^\star(x_i))\}_{i\leq n}\)</span>. L’objectif de l’interpolation va être de trouver une fonction <span class="math notranslate nohighlight">\(\hat{f}:\mathcal{X}\rightarrow\mathcal{Y}\)</span> telle que <span class="math notranslate nohighlight">\(\forall x_i, y_i\in S_n\)</span>, nous ayons <span class="math notranslate nohighlight">\(\hat{f}(x_i)=y_i=f^\star(x_i)\)</span>. De plus, on espère qu’en faisant cela, la fonction <span class="math notranslate nohighlight">\(\hat{f}\)</span> ne soit pas très loin de la fonction <span class="math notranslate nohighlight">\(f^\star\)</span> sur les parties de son domaine entre les points de notre jeu de données.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5001</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3_interpolation_2_0.png" src="../_images/3_interpolation_2_0.png" />
</div>
</div>
<p>Construisons notre jeu de données en échantilonnant quelques points dans <span class="math notranslate nohighlight">\(\mathcal{X}\)</span>.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">X</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">S</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3_interpolation_4_0.png" src="../_images/3_interpolation_4_0.png" />
</div>
</div>
<p>La courbe bleue est la courbe qu’on recherche. Les points bleus sont les seules informations visibles auxquelles nous avons accès. L’objectif est de s’appuyer sur ces informations pour construire les meilleures fonctions possibles. Cela peut se faire de beaucoup de manières différentes et nous allons en étudier quelques unes.</p>
</div>
<div class="section" id="ii-quelques-exemples-simples-d-interpolations">
<h2>II. Quelques exemples simples d’interpolations<a class="headerlink" href="#ii-quelques-exemples-simples-d-interpolations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="a-interpolation-constante-par-morceau-interpolateur-d-ordre-0">
<h3>A. Interpolation constante par morceau (interpolateur d’ordre <span class="math notranslate nohighlight">\(0\)</span>)<a class="headerlink" href="#a-interpolation-constante-par-morceau-interpolateur-d-ordre-0" title="Permalink to this headline">¶</a></h3>
<p>L’idée est de considérer que la valeur de notre fonction est celle du point le plus proche : c’est le 1NN !</p>
<div class="admonition-exercice admonition">
<p class="admonition-title">Exercice</p>
<p>Proposez un code qui retourne pour chaque valeur du vecteur x, le label associé au point le plus proche de notre jeu de données <span class="math notranslate nohighlight">\(S\)</span>.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f_piece_wise_constant</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="c1">####### Complete this part ######## or die ####################    </span>
    <span class="o">...</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="o">...</span>
    <span class="c1">###############################################################</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">S</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_piece_wise_constant</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Étudions visuellement la convergence de cette méthode.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">]):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">X</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">S</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_piece_wise_constant</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Size:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>On voit que les endroits où l’interpolation nous gêne correspondent aux angles de nos palliers. Nous pouvons faire mieux via une interpolation linéaire.</p>
</div>
<div class="section" id="b-interpolation-lineaire-interpolateur-d-ordre-1">
<h3>B. Interpolation linéaire (interpolateur d’ordre <span class="math notranslate nohighlight">\(1\)</span>)<a class="headerlink" href="#b-interpolation-lineaire-interpolateur-d-ordre-1" title="Permalink to this headline">¶</a></h3>
<p>Au lieu de n’exploiter que l’information du point le plus proche, l’idée est d’ici d’interpoler linéairement entre les deux points qui encadrent notre valeur. Notons <span class="math notranslate nohighlight">\((x_l, y_l)\in S_n\)</span> le point qui encadre par la gauche notre nouveau <span class="math notranslate nohighlight">\(x\)</span> et <span class="math notranslate nohighlight">\((x_r, y_r)\in S_n\)</span> celui de droite. Une interpolation linéaire se calcule tout simplement de la manière suivante :</p>
<div class="math notranslate nohighlight">
\[q(x)=y_r+(y_l-y_r)\frac{x-x_r}{x_l-x_r},\ x\in[x_l, x_r].\]</div>
<div class="admonition-exercice admonition">
<p class="admonition-title">Exercice</p>
<p><strong>Proposez un code qui retourne pour chaque valeur du vecteur x, son interpolation linéaire s’il est bien encadré et <span class="math notranslate nohighlight">\(\texttt{None}\)</span> sinon.</strong></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f_linear</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="c1">####### Complete this part ######## or die ####################</span>
    <span class="o">...</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="o">...</span>
    <span class="c1">###############################################################</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">]):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">X</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">S</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_linear</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Size:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="iii-interpolation-polynomiale">
<h2>III. Interpolation polynomiale<a class="headerlink" href="#iii-interpolation-polynomiale" title="Permalink to this headline">¶</a></h2>
<p>L’interpolation linéaire donne de bon résultats sauf qu’en pratique les fonctions qu’on cherche à estimer sont plus “lisses”. L’idée va être de contourner cela par une interpolation polynomiale.</p>
<div class="section" id="a-polynome-interpolateur-de-lagrange">
<h3>A. Polynome interpolateur de Lagrange<a class="headerlink" href="#a-polynome-interpolateur-de-lagrange" title="Permalink to this headline">¶</a></h3>
<p>On souhaite construire un polynome interpolateur d’une fonction dont nous possédons des points de mesure <span class="math notranslate nohighlight">\(\mathcal{S} = \{(x_1, y_1), \dots (x_n, y_n)\}\)</span> et où on suppose les <span class="math notranslate nohighlight">\(x_i\)</span> deux à deux distincts. Pour cela, nous allons construire une solution de ce type :</p>
<div class="math notranslate nohighlight">
\[L(x) = \sum_{j=1}^{N}y_jL_j(x)\]</div>
<p>C’est-à-dire une combinaison de polynomes <span class="math notranslate nohighlight">\(L_j\)</span> dont on souhaitera qu’ils aient la propriété suivante :</p>
<div class="math notranslate nohighlight">
\[\begin{split}L_j(x) = \begin{cases} 
      1 &amp; x = x_j \\
      0 &amp; x \neq x_j, \exists l\leq n, x=x_l
\end{cases}\end{split}\]</div>
<p>Chaque polynome s’annule exactement en tous les points d’interpolation sauf un. La somme passe donc exactement par tous les points. On aura donc <span class="math notranslate nohighlight">\(L(x_i)=y_i\)</span> <span class="math notranslate nohighlight">\(\forall (x_i, y_i) \in \mathcal{S}\)</span>.</p>
<p><strong>Première tentative naive :</strong></p>
<p>On peut définir les <span class="math notranslate nohighlight">\(L_j\)</span>, polynômes intermédiaires dont l’expression est donnée par :</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
    L_j(x) = \prod\limits_{\substack{k=1 \\ k\neq j}}^N x - x_k
\end{equation*}\]</div>
<p>on aurait donc <span class="math notranslate nohighlight">\(\forall i \neq j, L_j(x_i) = 0\)</span>. Nous avons bien <span class="math notranslate nohighlight">\(0\)</span> lorsque <span class="math notranslate nohighlight">\(i\neq j\)</span>, mais nous échouons à obtenir <span class="math notranslate nohighlight">\(1\)</span> lors que <span class="math notranslate nohighlight">\(i=j\)</span> :</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
    L_j(x_j) = \prod\limits_{\substack{k=1 \\ k\neq j}}^N x_j  - x_k \neq 1
\end{equation*}\]</div>
<p>Nous pouvons résoudre cela en normalisant notre première tentative par ce terme pour qu’on obtienne bien ce qu’on veut :</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
    L_j(x) =  \frac{\prod\limits_{\substack{k=1 \\ k\neq j}}^Nx - x_k}{\prod\limits_{\substack{k=1 \\ k\neq j}}^Nx_j - x_k} = \prod\limits_{\substack{k=1 \\ k\neq j}}^N\frac{x - x_k}{x_j - x_k}
\end{equation*}\]</div>
<p>Nous obtenons donc :</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
    L(x) = \sum_{j=1}^{N}y_j\prod\limits_{\substack{k=1 \\ k\neq j}}^N  \frac{x - x_k}{x_j - x_k}
\end{equation*}\]</div>
<div class="admonition-exercice admonition">
<p class="admonition-title">Exercice</p>
<p><strong>Montrez que le polynôme résultant est bien de degré <span class="math notranslate nohighlight">\(N-1\)</span>.</strong></p>
</div>
<div class="admonition-exercice-complementaire admonition">
<p class="admonition-title">Exercice complémentaire</p>
<p><strong>Démontrez que le polynôme est bien un polynôme interpolateur et passe bien par l’ensemble des points de notre jeu de données.</strong></p>
</div>
<div class="admonition-exercice admonition">
<p class="admonition-title">Exercice</p>
<p><strong>Proposez un code qui réalise l’interpolation de Lagrange et retourne pour chacune des valeurs de <span class="math notranslate nohighlight">\(x\)</span> son interpolation.</strong></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f_polynomial</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1">####### Complete this part ######## or die ####################</span>
    <span class="o">...</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="o">...</span>
    <span class="c1">###############################################################</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">]):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">X</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">S</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_polynomial</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Size:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>On remarque que notre polynôme en s’écartant des points de notre jeu de données et notamment sur les bords, devient très instable. Et cela est d’autant plus vrai que nous avons augmenté le nombre de points (ce qui peut sembler contre-intuitif).</p>
</div>
<div class="section" id="b-interpolation-polynomiale-par-regression-non-lineaire">
<h3>B. Interpolation polynomiale par régression (non) linéaire<a class="headerlink" href="#b-interpolation-polynomiale-par-regression-non-lineaire" title="Permalink to this headline">¶</a></h3>
<p>Nous allons voir dans cette section qu’il est aussi possible de produire des fonctions interpolatrices à partir du formalisme des moindres carrés que nous avons vu précédemment. En effet, comme nous l’avons vu dans le TP sur la regression linéaire, il est possible de représenter n’importe quel polynôme de la façon suivante :</p>
<div class="math notranslate nohighlight">
\[L(x)  = \beta_0 + \sum_{i=1}^p \beta_i x^i = \langle \boldsymbol{\beta},  \phi_p(x) \rangle\]</div>
<p>avec :</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}\phi_p(x) =  \begin{bmatrix}
           1 \\
           x\\
           \vdots\\
           x^p
         \end{bmatrix}\end{aligned}\end{split}\]</div>
<p>Après avoir procédé à ce changement de variable sur les tous les échantillons, nous pouvons définir la nouvelle matrice des données comme :</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}\boldsymbol{\Phi}_p(\boldsymbol{X}) = 
\begin{pmatrix} 
1 &amp; x_{1} &amp; x_{1}^2 &amp; \dots &amp; x_1^p \\
. &amp; . &amp; \dots &amp; .\\
1 &amp; x_{j}  &amp; x_{j}^2 &amp; \dots &amp; x_j^p\\
. &amp; . &amp; \dots &amp; .\\
1 &amp; x_{N}  &amp; x_{N}^2 &amp; \dots &amp; x_N^p
\end{pmatrix}\end{aligned}\end{split}\]</div>
<p>Et notre polynôme se construit de la manière suivante :</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}\boldsymbol{L(X)} = \Big[\boldsymbol{\Phi}_p(\boldsymbol{X}) \Big]
\boldsymbol{\beta}  = 
\begin{pmatrix} 
\beta_0 + \beta_1 x_{1} + \beta_2 x_{1}^2 + \dots + \beta_p x_1^p \\
\dots \\
\beta_0 + \beta_1 x_{j} + \beta_2 x_{j}^2 + \dots + \beta_p x_j^p\\
\dots\\
\beta_0 + \beta_1 x_{N}  + \beta_2 x_{N}^2 + \dots + \beta_p x_N^p
\end{pmatrix},\ \boldsymbol{\beta}\in\mathbb{R}^{p+1}\text{ et }\boldsymbol{L(X)}\in\mathbb{R}^N.
\end{aligned}\end{split}\]</div>
<p>Nous avons donc donc un système linéaire de <span class="math notranslate nohighlight">\(p+1\)</span> équations et <span class="math notranslate nohighlight">\(N\)</span> inconnues. Il est ainsi possible d’approximer une fonction non linéaire qui minimise les erreurs au carré entre les valeurs du polynôme évalués avec les vraies valeurs de notre jeu de données. Nous avons transformé noter problème de regression linéaire en un probleme de regression polynômiale (non linéaire).</p>
<div class="admonition-question-1 admonition">
<p class="admonition-title">Question 1</p>
<p><strong>Rappellez l’expression de la solution des equations normales des moindres carrés et adaptez-la à ce changement de variable pour trouver les coefficients du polynôme qui minimise les moindres carrés.</strong></p>
</div>
<div class="admonition-question-2 admonition">
<p class="admonition-title">Question 2</p>
<p><strong>Pour quelle(s) valeur(s) de <span class="math notranslate nohighlight">\(p\)</span> (ordre du polynôme) nous avons une solution interpolatrice de manière garantie ? Rappellez l’origine des difficultés sur la stabilité de la solution obtenues par la méthodes des EQN ?</strong></p>
</div>
<div class="warning admonition">
<p class="admonition-title">Remarque</p>
<p>Il est intéressant de montrer que la solution des EQN obtenue à partir de la matrice  <span class="math notranslate nohighlight">\(\boldsymbol{\Phi_{N-1}(X)}\)</span> (matrice carré <span class="math notranslate nohighlight">\(N=p+1\)</span> aussi appellée la matrice de <em>Vandermonde</em>) correspond en fait exactement aux coefficients du polynôme interpolateur de Lagrange qui en est l’unique solution (si <span class="math notranslate nohighlight">\(x_j\neq x_i\forall j\neq i\)</span>) !</p>
</div>
<div class="admonition-exercice admonition">
<p class="admonition-title">Exercice</p>
<p><strong>Proposez un code qui réalise l’interpolation de Lagrange par la méthode des EQN des moindres carrés et qui retourne pour chacune des valeurs de <span class="math notranslate nohighlight">\(x\)</span> son interpolation. (On pourra reprendre le code du TP sur la regresion linéaire).</strong></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Polynomial</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deg</span> <span class="o">=</span> <span class="n">deg</span>

    <span class="k">def</span> <span class="nf">_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="c1"># here we transform the input into a polynomial</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">X</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deg</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="c1">####### Complete this part ######## or die ####################</span>
        <span class="n">X_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="o">...</span>
        <span class="c1">###############################################################</span>
        
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You must fit the model first&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">(</span><span class="n">prediction</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">errors</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">errors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">]):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">X</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">S</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">S</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;EQN&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_polynomial</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lagrange&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Size:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition-exercice admonition">
<p class="admonition-title">Exercice</p>
<p>Dans votre réponse pour l’exercice précédent, jouez avec <span class="math notranslate nohighlight">\(\texttt{pinv}\)</span> et <span class="math notranslate nohighlight">\(\texttt{inv}\)</span>. Comprenez-vous pourquoi la solution n’est pas identique ?</p>
</div>
</div>
</div>
<div class="section" id="iv-splines">
<h2>IV. Splines<a class="headerlink" href="#iv-splines" title="Permalink to this headline">¶</a></h2>
<p>Comme nous l’avons vu, il existe parfois certains effets pathologiques de l’interpolation polynomiale où la fonction peut avoir des variations arbitrairement hautes entre les points de contrôle. On aimerait d’une certaine manière éviter ces comportements de sorte à ce que la fonction prenne des valeurs raisonnables entre les points. Nous allons voir ici une autre façon de construire une solution interpolatrice de notre jeu de donnée.</p>
<p>L’interpolation par <em>spline</em> consiste à trouver des approximations locales de notre fonction. Plus formellement, il s’agit de trouver pour chaque intervalle <span class="math notranslate nohighlight">\([x_i, x_{i+1}]\)</span> un polynôme <span class="math notranslate nohighlight">\(P_i(x)\)</span> qui satisfait certaines propriétés. On aura ainsi une interpolation <span class="math notranslate nohighlight">\(S(x)\)</span> de la fonction qui nous intéresse par :</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}S(x) =  
\begin{cases} 
P_1(x) &amp; x_1\leq x \leq x_2 \\
P_2(x) &amp; x_2\leq x \leq x_3 \\
\dots \\
P_{N-1}(x) &amp; x_{N-1}\leq x \leq x_N \\
\end{cases}\end{aligned}\end{split}\]</div>
<p>où chaque polynôme intermédiaire <span class="math notranslate nohighlight">\(P_i\)</span> d’ordre <span class="math notranslate nohighlight">\(p\)</span> peut s’écrire de la manière suivante :</p>
<div class="math notranslate nohighlight">
\[P_i(x) = a_i^{(0)} + a_i^{(1)}(x - x_i) + \frac{a_i^{(2)}}{2}(x - x_i)^2 + \ldots + \frac{a_i^{(p)}}{p!}(x - x_i)^p\]</div>
<p>et où l’on note <span class="math notranslate nohighlight">\((k)\)</span> comme un indice et non comme une puissance. Il s’agira donc de determiner <span class="math notranslate nohighlight">\(p+1\)</span> coeficients pour chacun des <span class="math notranslate nohighlight">\(N-1\)</span> intervalles séparant les points de controles successifs.</p>
<div class="warning admonition">
<p class="admonition-title">Remarque</p>
<p>On remarque que les cas ou <span class="math notranslate nohighlight">\(p=0\)</span> et <span class="math notranslate nohighlight">\(p=1\)</span> correspondent respectivement à l’interpolateur constant par morceaux (ordre <span class="math notranslate nohighlight">\(0\)</span>) comme nous avons pu les voir dans les parties précédentes. Les <em>splines</em> sont donc une généralisation des premières approches triviales vues dans la première partie de ce TP. Lorsque <span class="math notranslate nohighlight">\(p=1\)</span>, certaines propriétés souhaitables ne sont plus garanties. On voudrait ainsi que la fonction soit au moins <span class="math notranslate nohighlight">\(\mathcal{C}^2\)</span> partout y compris au niveau des points de contrôles où on constate pour l’ordre 1 par exemple que la fonction n’est pas lisse.</p>
</div>
<div class="section" id="a-les-splines-cubiques">
<h3>A. Les splines cubiques<a class="headerlink" href="#a-les-splines-cubiques" title="Permalink to this headline">¶</a></h3>
<p>Nous allons donc travailler avec un ordre <span class="math notranslate nohighlight">\(p=3\)</span> (les <em>splines</em> cubiques), et les polynômes <span class="math notranslate nohighlight">\(P_i\)</span> sont de la forme :</p>
<div class="math notranslate nohighlight">
\[P_i(x) = a_i^{(0)} + a_i^{(1)}(x - x_i) + \frac{a_i^{(2)}}{2}(x - x_i)^2 + \frac{a_i^{(3)}}{6}(x - x_i)^3,\]</div>
<p>et tenter de construire une fonction interpolatrice <span class="math notranslate nohighlight">\(S\)</span> qui est <span class="math notranslate nohighlight">\(C^2\)</span>, c’est-à-dire continue avec les dérivées et dérivées doubles continues. Pour cela posons un certain nombre de contraintes :</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(P_i(x_{i+1}) = P_{i+1}(x_{i+1}) = y_{i+1}\)</span> : la fonction doit être continue au niveau des points de contrôle,</p></li>
<li><p><span class="math notranslate nohighlight">\(P_i^{'}(x_{i+1}) = P_{i+1}^{'}(x_{i+1})\)</span> : la fonction dérivée doit être continue au niveau des points de contrôle,</p></li>
<li><p><span class="math notranslate nohighlight">\(P_i^{''}(x_{i+1}) = P_{i+1}^{''}(x_{i+1})\)</span> : et les dérivées secondes doivent être continues au niveau des points de contrôle.</p></li>
</ul>
<p>Pour <span class="math notranslate nohighlight">\(N\)</span> points, nous avons <span class="math notranslate nohighlight">\(N-1\)</span> intervalles et donc <span class="math notranslate nohighlight">\(N-1\)</span> polynômes à trouver. Chaque polynôme <span class="math notranslate nohighlight">\(P_i\)</span> possède quatre coefficients <span class="math notranslate nohighlight">\(a_i^{(0)}, a_i^{(1)}, a_i^{(2)}\)</span> et <span class="math notranslate nohighlight">\(a_i^{(3)}\)</span> à trouver. Cela nous donne <span class="math notranslate nohighlight">\(4(N-1)\)</span> coefficients à trouver pour estimer S.</p>
<div class="admonition-question admonition">
<p class="admonition-title">Question</p>
<p><strong>Existe-t-il un ensemble unique de coeficients satisfaisant ces contraintes ? Si non, que rajouter comme contraintes afin de garantir l’unicité de la solution ?</strong></p>
</div>
</div>
<div class="section" id="b-estimation-des-coefficients">
<h3>B. Estimation des coefficients<a class="headerlink" href="#b-estimation-des-coefficients" title="Permalink to this headline">¶</a></h3>
<div class="admonition-question-1 admonition">
<p class="admonition-title">Question 1</p>
<p><strong>Montrez à partir de la contrainte 1 par identification qu’on peut trouver très facilement que <span class="math notranslate nohighlight">\(a_i^{(0)} = y_i\)</span></strong></p>
</div>
<p>Nous allons exprimer les <span class="math notranslate nohighlight">\(a_i^{(1)}, a_i^{(2)}\)</span> et <span class="math notranslate nohighlight">\(a_i^{(3)}\)</span> en fonction des dérivée et dérivée doubles de nos polynômes <span class="math notranslate nohighlight">\(P_i^\prime\)</span> et <span class="math notranslate nohighlight">\(P_i^{\prime\prime}\)</span> :</p>
<div class="math notranslate nohighlight">
\[P_i^{'}(x) = a_i^{(1)} + a_i^{(2)}(x - x_i) + \frac{a_i^{(3)}}{2}(x - x_i)^2\]</div>
<div class="math notranslate nohighlight">
\[P_i^{''}(x) = a_i^{(2)}+ a_i^{(3)}(x - x_i)\]</div>
<div class="admonition-question-2 admonition">
<p class="admonition-title">Question 2</p>
<p><strong>Montrez à partir de la contrainte 4 qu’on obtient <span class="math notranslate nohighlight">\( a_i^{(3)} = \frac{a_{i+1}^{(2)} -  a_i^{(2)}}{\Delta x_i}\)</span> en notant <span class="math notranslate nohighlight">\(\Delta x_i = x_{i+1}-x_i, \forall i\)</span></strong></p>
</div>
<div class="admonition-question-3 admonition">
<p class="admonition-title">Question 3</p>
<p><strong>Montrez à partir de <span class="math notranslate nohighlight">\(P_i(x_{i+1})=y_{i+1}\)</span> que <span class="math notranslate nohighlight">\(a_i^{(1)} = \frac{\Delta y_i}{\Delta x_i} - \frac{a_i^{(2)}}{3}\Delta x_i  -\frac{a_{i+1}^{(2)}}{6} \Delta x_i\)</span> en notant <span class="math notranslate nohighlight">\(\Delta y_i = y_{i+1} - y_i\)</span></strong></p>
</div>
<div class="admonition-question-4 admonition">
<p class="admonition-title">Question 4</p>
<p><strong>Finalement, montrez à partir de la contrainte 3 et en injectant les expression de <span class="math notranslate nohighlight">\(a_i^{(1)}\)</span>, <span class="math notranslate nohighlight">\(a_{i+1}^{(1)}\)</span> et <span class="math notranslate nohighlight">\(a_i^{(3)}\)</span> à partir de la formule précédente que nous obtenons bien :</strong></p>
<div class="math notranslate nohighlight">
\[\Delta x_i a_i^{(2)} + 2\big[ \Delta x_i + \Delta x_{i+1}\big]a_{i+1}^{(2)} + \Delta x_{i+1}a_{i+2}^{(2)} = 6 \big[F_{i+1} -  F_i\big],\]</div>
<p>où <span class="math notranslate nohighlight">\(F_i=\frac{\Delta y_i}{\Delta x_i}=\frac{y_{i+1}-y_i}{\Delta x_i}\)</span>.</p>
</div>
<p>On a donc un système de <span class="math notranslate nohighlight">\(N-2\)</span> équations et <span class="math notranslate nohighlight">\(N-2\)</span> inconnues (les <span class="math notranslate nohighlight">\(a_i^{(2)}\)</span> sans <span class="math notranslate nohighlight">\(a_1^{(2)}\)</span> et <span class="math notranslate nohighlight">\(a_{N}^{(2)}\)</span> qu’on à fixé à 0).</p>
<div class="warning admonition">
<p class="admonition-title">Remarque</p>
<p>On peut écrire l’équation précédente sous une forme matricielle :</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{pmatrix} 
2[\Delta x_1 + \Delta x_2] &amp; \Delta x_2 &amp; \dots &amp; 0\\
\Delta x_2 &amp; 2[\Delta x_2 + \Delta x_3] &amp; \Delta x_3 &amp; \dots\\
\vdots &amp;   \vdots  &amp;  \vdots  &amp; \vdots \\
0 &amp; 0 &amp; \dots &amp; 0\\
0 &amp; \dots &amp; \Delta x_{N-2}  &amp; 2[\Delta x_{N-2}+\Delta x_{N-1}]\\
\end{pmatrix} \begin{pmatrix} 
a_2^{(2)} \\
.\\
a_i^{(2)}\\
.\\
a_{N-1}^{(2)}
\end{pmatrix}  = \begin{pmatrix} 
\Delta F_1 \\
.\\
\Delta F_i\\
.\\
\Delta F_{N-1}
\end{pmatrix}\end{split}\]</div>
<p>en notant <span class="math notranslate nohighlight">\(\Delta F_i = 6 \big[F_{i+1} -  F_i\big]\)</span>. On remarque que cette matrice est creuse, l’inversion d’une telle matrice sera donc efficace numériquement:</p>
<div class="math notranslate nohighlight">
\[\Big[D\Big]\boldsymbol{a}^{(2)}  = \boldsymbol{\Delta F} \Leftrightarrow  \boldsymbol{a}^{(2)}  = \Big[D\Big]^{-1}\boldsymbol{\Delta F}\]</div>
</div>
<p>La suite consiste à trouver les autres coefficients qu’on a déjà exprimés en fonction de ceux que l’on vient de trouver. Il ne nous reste plus qu’à appliquer les relations décrites par les équations :</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(a_i^{(0)} = y_i\)</span> <span class="math notranslate nohighlight">\(\forall i\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\boldsymbol{a}^{(2)}  = \Big[D\Big]^{-1}\boldsymbol{\Delta F}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(a_i^{(1)} = F_i - \frac{1}{3}\Big[a_i^{(2)}  + \frac{a_{i+1}^{(2)}}{2}\Big] \Delta x_i\)</span> <span class="math notranslate nohighlight">\(\forall i\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(a_i^{(3)} = \frac{a_{i+1}^{(2)} -  a_i^{(2)}}{\Delta x_i}\)</span> <span class="math notranslate nohighlight">\(\forall i\)</span>.</p></li>
</ul>
<p>Et le tour est joué, nous avons determiné totalement les paramètres de notre spline <span class="math notranslate nohighlight">\(S\)</span>.</p>
<div class="admonition-exercice admonition">
<p class="admonition-title">Exercice</p>
<p><strong>Proposez un code qui réalise le calcul d’une spline cubique</strong></p>
</div>
<hr class="docutils" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CubicSpline</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> 
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
            
            <span class="c1"># Fit Intermediate variables</span>
            <span class="c1">#  Complete Code  here ######## or die ##</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="o">...</span>
            <span class="n">F</span>  <span class="o">=</span> <span class="o">...</span>
            <span class="n">dF</span> <span class="o">=</span> <span class="o">...</span>
            <span class="n">D</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="o">...</span>
            <span class="c1">#########################################</span>
            
            <span class="c1"># Fit Spline coefficients</span>
            <span class="c1">#  Complete Code  here ######## or die ##</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
            <span class="c1">#########################################</span>
            
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">v</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
                <span class="n">left</span><span class="p">[</span><span class="n">left</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
                <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
                <span class="n">right</span><span class="p">[</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
                <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>

                <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
                <span class="n">i_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">left</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="n">i_</span><span class="p">]):</span>
                    <span class="n">i</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="c1">#  Complete Code  here ######## or die ##</span>
                <span class="o">...</span>
                <span class="c1">#########################################</span>
            <span class="k">return</span> <span class="n">y</span>
        
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">]):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">X</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">S</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">spline</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">S</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">spline</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Size:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Nous pouvons aussi utiliser l’outil <span class="math notranslate nohighlight">\(\texttt{CubicSpline}\)</span> de <span class="math notranslate nohighlight">\(\texttt{scipy}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">CubicSpline</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">]):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">X</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">S</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">spline</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">S</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">spline</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Size:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3_interpolation_46_0.png" src="../_images/3_interpolation_46_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="v-de-l-interpollation-vers-l-approximation">
<h2>V. De l’interpollation vers l’approximation<a class="headerlink" href="#v-de-l-interpollation-vers-l-approximation" title="Permalink to this headline">¶</a></h2>
<p>Nous allons voir ici une autre manière de contrôler un peu les fluctuations entre les points de contrôle qui va consister à trouver une fonction qui ne passe plus nécessairement exactement sur chaque point mais qui reste tout de même proche de la solution d’interpolation. Plus formellement, au lieu d’avoir <span class="math notranslate nohighlight">\(\forall x_i \in \mathcal{S}, \tilde{f}(x_i) = f^{\star}(x_i)\)</span>, nous aurons plutôt <span class="math notranslate nohighlight">\(\forall x_i \in \mathcal{S}, \tilde{f}(x_i) \approx f^{\star}(x_i)\)</span>. On parlera plutôt d’approximation de la fonction.</p>
<p>Comme nous l’avons vu, il est possible d’avoir des comportements non souhaitables via la solution des EQN quand la matrice <span class="math notranslate nohighlight">\(X^TX\)</span> est mal conditionnée. Ce comportement apparaît notamment, si ses valeurs propres sont très petites voir nulles, on parle de matrice presque singulière dont l’inverse possède alors une norme forte. Le problème est alors <em>mal posé</em> car la solution devient très sensible aux fluctuations du bruit dans les données.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p><strong>Problème bien posé :</strong>
On parle d’un problème <span class="math notranslate nohighlight">\(\mathcal{P}\)</span> <em>bien posé</em> lorsque la formalisation de ce dernier sous la forme d’un problème d’optimisation conduit à une solution qui possède les propriétés suivantes :</p>
<ol class="simple">
<li><p>Elle existe.</p></li>
<li><p>Elle est unique.</p></li>
<li><p>Elle est stable (<em>i.e.</em> elle dépend continuement des données, <span class="math notranslate nohighlight">\(\lVert\hat{\beta} - \hat{\beta}_0\rVert &lt; K \lVert X - X_0 \rVert\)</span> avec <span class="math notranslate nohighlight">\(K\)</span> pas trop grand, <em>i.e.</em> la variation de la solution est bornée par une certaine quantité proportionelle à la variation dans les données).</p></li>
</ol>
<p>Par définition on dira qu’un problème est mal posé si l’une des conditions précédentes n’est pas respectée.</p>
</div>
<p>Nous allons donc ici considérer une formulation dite régularisée de notre problème de régression polynomiale afin de mieux contrôler les fluctuations de ce dernier. Plus formellement, cela correspond à transformer notre problème <em>mal posé</em> <span class="math notranslate nohighlight">\(\mathcal{P}\)</span> en une suite de problèmes <em>bien posés</em> <span class="math notranslate nohighlight">\(\mathcal{P}_\lambda, \lambda \in \mathbb{R}^{+}\)</span>, tel que <span class="math notranslate nohighlight">\( \lim\limits_{\lambda \rightarrow 0}\hat{\beta}_{\lambda} = \hat{\beta}\)</span>. Avec <span class="math notranslate nohighlight">\(\hat{\beta}\)</span> et <span class="math notranslate nohighlight">\(\hat{\beta}_{\lambda}\)</span> les solutions respectives des problèmes <span class="math notranslate nohighlight">\(\mathcal{P}\)</span> et <span class="math notranslate nohighlight">\(\mathcal{P}_\lambda\)</span>. La formulation régularisée d’un problème d’optimisation s’écrit de la façon suivante :</p>
<div class="math notranslate nohighlight">
\[J^{\mathcal{D}}_{\lambda}(\beta) =  J_{\mathcal{D}}(\beta) + \lambda  \mathcal{\Omega}(\beta)\]</div>
<p>où :</p>
<ol class="simple">
<li><p><span class="math notranslate nohighlight">\(J_{\mathcal{D}}(\beta)\)</span> correspond à l’expression de la fonction objectif du problème original,</p></li>
<li><p><span class="math notranslate nohighlight">\( \mathcal{\Omega}(\beta)\)</span> correspond au terme de régularisation sur le vecteur des paramètres. Ce dernier terme correspond à une contrainte que l’on souhaiterait optimiser conjointement sur le vecteur des paramètres avec plus ou moins d’importance par rapport à la fonction objectif d’origine,</p></li>
<li><p>On réglera <span class="math notranslate nohighlight">\(\lambda\)</span> en fonction de l’importance relative de la contrainte sur le vecteur des paramètres (et nous verrons pus tard que cela est équivalent à un problème d’optimisation sous contrainte ou \lambda joue le rôle du multiplicateur de Lagrange).</p></li>
</ol>
<p>Pour limiter l’amplitude des fluctuations du polynôme entre les points nous pouvons donc construire une version régularisée de la fonction objectif des moindres carrés suivante pour trouver une solution dont les coeficients sont les plus petits possibles :</p>
<div class="math notranslate nohighlight">
\[J_{\lambda}^{\mathcal{D}}(\beta) = ||\boldsymbol{y} - \boldsymbol{X}\boldsymbol{\beta}||_2^2 + \lambda||\boldsymbol{\beta}||_2^2\]</div>
<div class="warning admonition">
<p class="admonition-title">Remarque</p>
<p>Quand <span class="math notranslate nohighlight">\(\lambda \rightarrow 0\)</span>, <span class="math notranslate nohighlight">\(J_{\lambda}(\beta)^{\mathcal{D}} \rightarrow J(\beta)\)</span>. Quand <span class="math notranslate nohighlight">\(\lambda \rightarrow +\infty\)</span>, <span class="math notranslate nohighlight">\(J_{\lambda}(\beta)^{\mathcal{D}} \approx \lambda ||\boldsymbol{\beta}||_2^2 = \sum_{d=0}^p\beta_d^2\)</span> et la solution optimal <span class="math notranslate nohighlight">\(\hat{\boldsymbol{\beta}}_{\lambda} \rightarrow \boldsymbol{0}\)</span>, <em>i.e.</em> la pénalité “domine” et la solution est indépendante des données.</p>
</div>
<hr class="docutils" />
<p>Chercher à trouver le minimum de la fonction revient à trouver les <span class="math notranslate nohighlight">\(\beta\)</span> tels que le gradient s’annule.</p>
<div class="admonition-question admonition">
<p class="admonition-title">Question</p>
<p><strong>Calculer la nouvelle valeur de <span class="math notranslate nohighlight">\(\boldsymbol{\beta}\)</span> qui annule le gradient de cette nouvelle fonction objectif.</strong></p>
</div>
<div class="admonition-question admonition">
<p class="admonition-title">Question</p>
<p><strong>Peut on trouver une solution interpolatrice avec cette version régularisée des moindres carrés ?</strong></p>
</div>
<hr class="docutils" />
<div class="admonition-exercice admonition">
<p class="admonition-title">Exercice</p>
<p><strong>Proposez une implémentation d’approximation du polynome interpolateur basé sur cette version régularisée des moindres carrés. On pourra reprendre le code déjà effectué dans le TP regression linéaire.</strong></p>
</div>
<hr class="docutils" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Polynomial_reg</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deg</span> <span class="o">=</span> <span class="n">deg</span>

    <span class="k">def</span> <span class="nf">_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="c1"># here we transform the input into a polynomial</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">X</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deg</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="c1">####### Complete this part ######## or die ####################</span>
        <span class="n">X_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="o">...</span>
        <span class="c1">###############################################################</span>
        
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You must fit the model first&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">(</span><span class="n">prediction</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">errors</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">errors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">X</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,))</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">S</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">k</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="c1">#[2:2+3]</span>
<span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

<span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">alphas</span><span class="p">):</span><span class="c1">#[0, 1e-06, 1e-01]):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Polynomial_reg</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;regularity:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="warning admonition">
<p class="admonition-title">Remarques</p>
<ul class="simple">
<li><p>La solution <span class="math notranslate nohighlight">\(\hat{\boldsymbol{\beta}}_{\lambda}\)</span> augmente en “compléxité” quand <span class="math notranslate nohighlight">\(\lambda \rightarrow 0\)</span> et converge vers la solution interpolatrice <span class="math notranslate nohighlight">\(\hat{\boldsymbol{\beta}}\)</span>.</p></li>
<li><p>En régularisant, on paye le prix de s’éloigner des valeurs <span class="math notranslate nohighlight">\({(x_i, y_i})\)</span> au profit d’être plus “raisonable” entre elles. Il est d’autant plus raisonable de ne pas passer exactement sur les données que les fluctuations de <span class="math notranslate nohighlight">\(y\)</span> dues au bruit sont importantes.</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathcal{P}_{\lambda}^{\mathcal{D}}\)</span> pour <span class="math notranslate nohighlight">\(( \lambda, \mathcal{D})\)</span> donnés est unique (même si le problème non régularisé ne l’est pas), on peut définir un <em>chemin de régularisation</em> unique en faisant varier <span class="math notranslate nohighlight">\(\lambda\)</span>, c’est à dire une unique séquence de solutions régularisées <span class="math notranslate nohighlight">\(\hat{\boldsymbol{\beta}}_{\lambda}\)</span> convergeant vers la solution interpolatrice à mesure que <span class="math notranslate nohighlight">\(\lambda \rightarrow 0\)</span>.</p></li>
<li><p>Ainsi, on peut voir l’approximation d’une fonction comme un <em>arrêt prématuré</em> (<em>early stopping</em> en anglais) le long de ce chemin de régularisation.</p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./2_regression"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="2_optimization.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">L’optimisation ☕️☕️</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="4_algo_proximal_lasso.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Sous-différentiel et le cas du Lasso ☕️☕️☕️</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Servajean, Leveau & Chailan<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>